<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Accessing cross-account resources using AWS IoT rules - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="accessing-cross-account-resources-using-rules" />
      <meta name="default_state" content="accessing-cross-account-resources-using-rules" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/accessing-cross-account-resources-using-rules.html" />
      <meta name="description" content="Learn how to configure AWS IoT rules to enable cross-account access to AWS resources." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Accessing cross-account resources using AWS IoT rules - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#accessing-cross-account-resources-using-rules" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/accessing-cross-account-resources-using-rules.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/accessing-cross-account-resources-using-rules.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/accessing-cross-account-resources-using-rules.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/accessing-cross-account-resources-using-rules.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#accessing-cross-account-resources-using-rules" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/accessing-cross-account-resources-using-rules.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#cross-account-prerequisites">Prerequisites</a><a href="#cross-account-sqs">Cross-account setup for Amazon SQS</a><a href="#cross-account-sns">Cross-account setup for Amazon SNS</a><a href="#cross-account-s3">Cross-account setup for Amazon S3</a><a href="#cross-account-lambda">Cross-account setup for AWS Lambda</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="accessing-cross-account-resources-using-rules">Accessing cross-account resources using AWS IoT rules</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>You can configure AWS IoT rules for cross-account access so that data ingested on
                                    MQTT
                                    topics of one account can be routed into the AWS services, such as Amazon SQS and
                                    Lambda, of
                                    another account. The following explains how to set up AWS IoT rules for cross-account
                                    data
                                    ingestion, from an MQTT topic in one account, to a destination in another account.
                                    
                                 </p>
                                 <p>Cross-account rules can be configured using <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_controlling.html#TypesPermissions">resource-based permissions</a> on the destination resource. Therefore, only
                                    destinations that support resource-based permissions can be enabled for the
                                    cross-account access with AWS IoT rules. The supported destinations include Amazon
                                    SQS, Amazon SNS, Amazon S3, and AWS Lambda. 
                                 </p>
                                 
                                 <h2 id="cross-account-prerequisites">Prerequisites</h2>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>Familiarity with <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-rules.html">AWS IoT rules</a></p>                    
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>An understanding of IAM <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/introduction_identity-management.html">users</a>, <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html">roles</a>, and <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/access_permissions.html#TypesPermissions">resource-based permission</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Having <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html">AWS CLI</a> installed
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                  
                                 
                                 <h2 id="cross-account-sqs">Cross-account setup for Amazon SQS</h2>
                                 
                                 <p>Scenario: Account A sends data from an MQTT message to account B's Amazon SQS
                                    queue.
                                 </p>
                                 
                                 <div class="table-container">
                                    <div class="table-contents">
                                       <table id="w332aac27c27b9b5">
                                          <thead>
                                             
                                             <tr>
                                                
                                                <th>AWS account</th>
                                                
                                                <th>Account referred to as </th>
                                                
                                                <th>Description</th>
                                                
                                             </tr>
                                             
                                          </thead>
                                          
                                          <tr>
                                             
                                             <td><code class="code"><code class="replaceable">1111-1111-1111</code></code></td>
                                             
                                             <td>Account A</td>
                                             
                                             <td>Rule action: <code class="code">sqs:SendMessage</code></td>
                                             
                                          </tr>
                                          
                                          <tr>
                                             
                                             <td><code class="code"><code class="replaceable">2222-2222-2222</code></code></td>
                                             
                                             <td>Account B</td>
                                             
                                             <td>Amazon SQS queue
                                                
                                                <div class="itemizedlist">
                                                    
                                                    
                                                   
                                                   <ul class="itemizedlist" type="disc">
                                                      <li class="listitem">
                                                         <p>ARN: <code class="code"><code class="replaceable">arn:aws:sqs:region:2222-2222-2222:ExampleQueue</code></code></p>
                                                      </li>
                                                      <li class="listitem">
                                                         <p>URL: <code class="code"><code class="replaceable">https://sqs.region.amazonaws.com/2222-2222-2222/ExampleQueue</code></code></p>
                                                      </li>
                                                   </ul>
                                                </div>
                                                
                                             </td>
                                             
                                          </tr>
                                          
                                       </table>
                                    </div>
                                 </div>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>Do the Account A tasks</b></p>
                                    <div class="awsdocs-note">
                                       <div class="awsdocs-note-title">
                                          <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                       <div class="awsdocs-note-text">
                                          <p>To run the following commands, your IAM user should have permissions
                                             to <code class="code">iot:CreateTopicRule</code> with the rule's Amazon Resource Name
                                             (ARN) as a resource, and permissions to <code class="code">iam:PassRole</code> action
                                             with a resource as the role's ARN.
                                          </p>
                                       </div>
                                    </div>
                                    <ol>
                                       <li>
                                          
                                          <p><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html">Configure AWS CLI</a> using account A’s IAM user. 
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Create an IAM role that trusts AWS IoT rules engine, and attaches a policy
                                             that allows access to account B's Amazon SQS queue. See example commands and
                                             policy documents in <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-create-role.html">Granting AWS IoT the required access</a>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>To create a rule that is attached to a topic, run the <a href="https://docs.aws.amazon.com/cli/latest/reference/iot/create-topic-rule.html">create-topic-rule command</a>.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws iot create-topic-rule --rule-name <code class="replaceable">myRule</code> --topic-rule-payload file://./<code class="replaceable">my-rule.json</code></code></code></pre>
                                          <p>The following is an example payload file with a rule that inserts all
                                             messages sent to the <code class="code">iot/test</code> topic into the specified Amazon SQS
                                             queue. The SQL statement filters the messages and the role ARN grants AWS IoT
                                             permissions to add the message to the Amazon SQS queue.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
	"sql": "SELECT * FROM 'iot/test'",
	"ruleDisabled": false,
	"actions": [
		<span>{</span>
			"sqs": <span>{</span>
				"queueUrl": "https://sqs.region.amazonaws.com/2222-2222-2222/ExampleQueue",
				"roleArn": "arn:aws:iam::1111-1111-1111:role/my-iot-role",
				"useBase64": false
			}
		}
	]
}</code></pre>
                                          <p>For more information about how to define an Amazon SQS action in an AWS IoT rule,
                                             see
                                             <a href="https://docs.aws.amazon.com/iot/latest/developerguide/sqs-rule-action.html">AWS IoT rule actions - Amazon SQS</a>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>Do the Account B tasks</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html">Configure AWS CLI</a> using account B’s IAM user. 
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>To give permissions for the Amazon SQS queue resource to account A, run the
                                             <a href="https://docs.aws.amazon.com/cli/latest/reference/sqs/add-permission.html">add-permission command</a>.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws sqs add-permission --queue-url <code class="replaceable">https://sqs.region.amazonaws.com/2222-2222-2222/ExampleQueue</code> --label <code class="replaceable">SendMessagesToMyQueue</code> --aws-account-ids <code class="replaceable">1111-1111-1111</code> --actions SendMessage<code class="userinput"></code></code></pre>
                                          </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <h2 id="cross-account-sns">Cross-account setup for Amazon SNS</h2>
                                 
                                 <p>Scenario: Account A sends data from an MQTT message to an Amazon SNS topic of account
                                    B.
                                 </p>
                                 
                                 <div class="table-container">
                                    <div class="table-contents">
                                       <table id="w332aac27c27c11b5">
                                          <thead>
                                             
                                             <tr>
                                                
                                                <th>AWS account</th>
                                                
                                                <th>Account referred to as </th>
                                                
                                                <th>Description</th>
                                                
                                             </tr>
                                             
                                          </thead>
                                          
                                          <tr>
                                             
                                             <td><code class="code"><code class="replaceable">1111-1111-1111</code></code></td>
                                             
                                             <td>Account A</td>
                                             
                                             <td>Rule action: <code class="code">sns:Publish</code></td>
                                             
                                          </tr>
                                          
                                          <tr>
                                             
                                             <td><code class="code"><code class="replaceable">2222-2222-2222</code></code></td>
                                             
                                             <td>Account B</td>
                                             
                                             <td>Amazon SNS topic ARN: <code class="code"><code class="replaceable">arn:aws:sns:region:2222-2222-2222:ExampleTopic</code></code>
                                                
                                             </td>
                                             
                                          </tr>
                                          
                                       </table>
                                    </div>
                                 </div>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>Do the Account A tasks</b></p>
                                    <div class="awsdocs-note">
                                       <div class="awsdocs-note-title">
                                          <awsui-icon name="status-info" variant="link"></awsui-icon><span>Notes</span></div>
                                       <div class="awsdocs-note-text">
                                          <p> To run the following commands, your IAM user should have permissions to
                                             <code class="code">iot:CreateTopicRule</code> with rule ARN as a resource and
                                             permissions to the <code class="code">iam:PassRole</code> action with a resource as role
                                             ARN.
                                          </p>
                                       </div>
                                    </div>
                                    <ol>
                                       <li>
                                          
                                          <p><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html">Configure AWS CLI</a> using account A’s IAM user. 
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Create an IAM role that trusts AWS IoT rules engine, and attaches a policy
                                             that allows access to account B's Amazon SNS topic. For example commands and
                                             policy documents, see <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-create-role.html">Granting AWS IoT the required access</a>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>To create a rule that is attached to a topic, run the <a href="https://docs.aws.amazon.com/cli/latest/reference/iot/create-topic-rule.html">create-topic-rule command</a>.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws iot create-topic-rule --rule-name <code class="replaceable">myRule</code> --topic-rule-payload file://./<code class="replaceable">my-rule.json</code></code></code></pre>
                                          <p>The following is an example payload file with a rule that inserts all
                                             messages sent to the <code class="code">iot/test</code> topic into the specified Amazon SNS
                                             topic. The SQL statement filters the
                                             messages, and the role ARN grants AWS IoT permissions to send the message to the Amazon
                                             SNS
                                             topic.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
	"sql": "SELECT * FROM 'iot/test'",
	"ruleDisabled": false,
	"actions": [
		<span>{</span>
			"sns": <span>{</span>
				"targetArn": "arn:aws:sns:region:2222-2222-2222:ExampleTopic",
				"roleArn": "arn:aws:iam::1111-1111-1111:role/my-iot-role"
			}
		}
	]
}</code></pre>
                                          <p>For more information about how to define an Amazon SNS action in an AWS IoT rule,
                                             see <a href="https://docs.aws.amazon.com/iot/latest/developerguide/sns-rule-action.html">AWS IoT rule actions - Amazon SNS</a>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>Do the Account B tasks</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html">Configure AWS CLI</a> using account B’s IAM user. 
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>To give permission on the Amazon SNS topic resource to account A, run the
                                             <a href="https://docs.aws.amazon.com/cli/latest/reference/sns/add-permission.html">add-permission command</a>.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws sns add-permission --topic-arn <code class="replaceable">arn:aws:sns:region:2222-2222-2222:ExampleTopic</code> --label <code class="replaceable">Publish-Permission</code> --aws-account-id <code class="replaceable">1111-1111-1111</code> --action-name Publish<code class="userinput"></code></code></pre>
                                          </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <h2 id="cross-account-s3">Cross-account setup for Amazon S3</h2>
                                 
                                 <p>Scenario: Account A sends data from an MQTT message to an Amazon S3 bucket of account
                                    B.
                                 </p>
                                 
                                 <div class="table-container">
                                    <div class="table-contents">
                                       <table id="w332aac27c27c13b5">
                                          <thead>
                                             
                                             <tr>
                                                
                                                <th>AWS account</th>
                                                
                                                <th>Account referred to as </th>
                                                
                                                <th>Description</th>
                                                
                                             </tr>
                                             
                                          </thead>
                                          
                                          <tr>
                                             
                                             <td><code class="code"><code class="replaceable">1111-1111-1111</code></code></td>
                                             
                                             <td>Account A</td>
                                             
                                             <td>Rule action: <code class="code">s3:PutObject</code></td>
                                             
                                          </tr>
                                          
                                          <tr>
                                             
                                             <td><code class="code"><code class="replaceable">2222-2222-2222</code></code></td>
                                             
                                             <td>Account B</td>
                                             
                                             <td>Amazon S3 bucket ARN: <code class="code"><code class="replaceable">arn:aws:s3:::ExampleBucket</code></code>
                                                
                                             </td>
                                             
                                          </tr>
                                          
                                       </table>
                                    </div>
                                 </div>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>Do the Account A tasks</b></p>
                                    <div class="awsdocs-note">
                                       <div class="awsdocs-note-title">
                                          <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                       <div class="awsdocs-note-text">
                                          <p>To run the following commands, your IAM user should have permissions to
                                             <code class="code">iot:CreateTopicRule</code> with the rule ARN as a resource and
                                             permissions to <code class="code">iam:PassRole</code> action with a resource as role
                                             ARN.
                                          </p>
                                       </div>
                                    </div>
                                    <ol>
                                       <li>
                                          
                                          <p><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html">Configure AWS CLI</a> using account A’s IAM user. 
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Create an IAM role that trusts AWS IoT rules engine and attaches a policy
                                             that allows access to account B's Amazon S3 bucket. For example commands and
                                             policy documents, see <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-create-role.html">Granting AWS IoT the required access</a>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>To create a rule that is attached to your target S3 bucket, run the <a href="https://docs.aws.amazon.com/cli/latest/reference/iot/create-topic-rule.html">create-topic-rule command</a>.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws iot create-topic-rule --rule-name <code class="replaceable">my-rule</code> --topic-rule-payload file://./<code class="replaceable">my-rule.json</code></code></code></pre>
                                          <p>The following is an example payload file with a rule that inserts all
                                             messages sent to the <code class="code">iot/test</code> topic into the specified Amazon S3
                                             bucket. The SQL statement filters the messages, and the role ARN grants
                                             AWS IoT permissions to add the message to the Amazon S3 bucket.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
	"sql": "SELECT * FROM 'iot/test'",
	"ruleDisabled": false,
	"actions": [
		<span>{</span>
			"s3": <span>{</span>
				"bucketName": "ExampleBucket",
				"key": "$<span>{</span>topic()}/$<span>{</span>timestamp()}",
				"roleArn": "arn:aws:iam::1111-1111-1111:role/my-iot-role"
			}
		}
	]
}</code></pre>
                                          <p>For more information about how to define an Amazon S3 action in an AWS IoT rule, see
                                             <a href="https://docs.aws.amazon.com/iot/latest/developerguide/s3-rule-action.html">AWS IoT rule actions - Amazon S3</a>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>Do the Account B tasks</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html">Configure AWS CLI</a> using account B’s IAM user. 
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Create a bucket policy that trusts account A's principal.</p>
                                          
                                          <p>The following is an example payload file that defines a bucket policy that
                                             trusts the principal of another account.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
	"Version": "2012-10-17",
	"Statement": [
		<span>{</span>
			"Sid": "AddCannedAcl",
			"Effect": "Allow",
			"Principal": <span>{</span>
				"AWS": [
					"arn:aws:iam::1111-1111-1111:root"
				]
			},
			"Action": "s3:PutObject",
			"Resource": "arn:aws:s3:::ExampleBucket/*"
		}
	]
}</code></pre>
                                          <p>For more information, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/example-bucket-policies.html#example-bucket-policies-use-case-1">bucket policy examples</a>.
                                          </p>      
                                          
                                       </li>
                                       <li>
                                          
                                          <p>To attach the bucket policy to the specified bucket, run the <a href="https://docs.aws.amazon.com/cli/latest/reference/s3api/put-bucket-policy.html">put-bucket-policy command</a>.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws s3api put-bucket-policy --bucket ExampleBucket --policy file://./<code class="replaceable">my-bucket-policy.json</code></code></code></pre>
                                          </li>
                                       <li>
                                          
                                          <p>To make the cross-account access work, make sure you have the correct
                                             <b>Block all public access</b> settings. For
                                             more information, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html">Security Best Practices for Amazon S3</a>.
                                          </p>              
                                          
                                       </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <h2 id="cross-account-lambda">Cross-account setup for AWS Lambda</h2>
                                 
                                 <p>Scenario: Account A invokes an AWS Lambda function of account B, passing in an MQTT
                                    message.
                                 </p>
                                 
                                 <div class="table-container">
                                    <div class="table-contents">
                                       <table id="w332aac27c27c15b5">
                                          <thead>
                                             
                                             <tr>
                                                
                                                <th>AWS account</th>
                                                
                                                <th>Account referred to as </th>
                                                
                                                <th>Description</th>
                                                
                                             </tr>
                                             
                                          </thead>
                                          
                                          <tr>
                                             
                                             <td><code class="code"><code class="replaceable">1111-1111-1111</code></code></td>
                                             
                                             <td>Account A</td>
                                             
                                             <td>Rule action: <code class="code">lambda:InvokeFunction</code></td>
                                             
                                          </tr>
                                          
                                          <tr>
                                             
                                             <td><code class="code"><code class="replaceable">2222-2222-2222</code></code></td>
                                             
                                             <td>Account B</td>
                                             
                                             <td>Lambda function ARN: <code class="code"><code class="replaceable"> arn:aws:lambda:region:2222-2222-2222:function:example-function</code></code>
                                                
                                             </td>
                                             
                                          </tr>
                                          
                                       </table>
                                    </div>
                                 </div>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>Do the Account A tasks</b></p>
                                    <div class="awsdocs-note">
                                       <div class="awsdocs-note-title">
                                          <awsui-icon name="status-info" variant="link"></awsui-icon><span>Notes</span></div>
                                       <div class="awsdocs-note-text">
                                          <p> To run the following commands, your IAM user should have permissions to
                                             <code class="code">iot:CreateTopicRule</code> with rule ARN as a resource, and
                                             permissions to <code class="code">iam:PassRole</code> action with resource as role
                                             ARN.
                                          </p>
                                       </div>
                                    </div>
                                    <ol>
                                       <li>
                                          
                                          <p><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html">Configure AWS CLI</a> using account A’s IAM user. 
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Run the <a href="https://docs.aws.amazon.com/cli/latest/reference/iot/create-topic-rule.html">create-topic-rule command
                                                </a>to create a rule that defines cross-account access to account B's Lambda function.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws iot create-topic-rule --rule-name <code class="replaceable">my-rule</code> --topic-rule-payload file://./<code class="replaceable">my-rule.json</code></code></code></pre>
                                          <p>The following is an example payload file with a rule that inserts all messages sent
                                             to the <code class="code">iot/test</code> topic into the specified Lambda function. 
                                             The SQL statement filters the messages and the role ARN grants AWS IoT permission
                                             to pass in the data to the Lambda function.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
	"sql": "SELECT * FROM 'iot/test'",
	"ruleDisabled": false,
	"actions": [
		<span>{</span>
			"lambda": <span>{</span>
				"functionArn": "arn:aws:lambda:region:1111-1111-1111:function:example-function"
			}
		}
	]
}</code></pre>
                                          <p>For more information about how to define an AWS Lambda action in an AWS IoT rule,
                                             read <a href="https://docs.aws.amazon.com/iot/latest/developerguide/lambda-rule-action.html">AWS IoT rule actions - Lambda</a>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>Do the Account B tasks</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html">Configure AWS CLI</a> using account B’s IAM user. 
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Run <a href="https://docs.aws.amazon.com/cli/latest/reference/lambda/add-permission.html">Lambda's add-permission command</a>
                                             to give AWS IoT rules permission to trigger the Lambda function. To run the following
                                             command, your IAM user 
                                             should have permission to <code class="code">lambda:AddPermission</code> action.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws lambda add-permission --function-name <code class="replaceable">example-function</code> --region <code class="replaceable">us-east-1</code> --principal iot.amazonaws.com --source-arn <code class="replaceable">arn:aws:iot:region:1111-1111-1111:rule/example-rule</code> --source-account <code class="replaceable">1111-1111-1111</code> --statement-id <code class="replaceable">"unique_id"</code> --action "lambda:InvokeFunction"<code class="userinput"></code></code></pre>
                                          <p><b>Options:</b></p>
                                          
                                          <p><b>--principal</b></p>
                                          
                                          <p> This field gives permission to AWS IoT (represented by <code class="code">iot.amazonaws.com</code>)
                                             to call the Lambda function.
                                          </p>
                                          
                                          <p><b>--source-arn</b></p> 
                                          
                                          <p>This field ensures that
                                             only <code class="code">arn:aws:iot:region:1111-1111-1111:rule/example-rule</code> in AWS IoT triggers
                                             this Lambda function and no other rule in the same or different account can
                                             trigger this Lambda function.
                                          </p>
                                          
                                          <p><b>--source-account</b></p> 
                                          
                                          <p>This field ensures that
                                             AWS IoT triggers this Lambda function only on behalf of the <code class="code">1111-1111-1111</code>
                                             account.
                                          </p>
                                          
                                          <div class="awsdocs-note">
                                             <div class="awsdocs-note-title">
                                                <awsui-icon name="status-info" variant="link"></awsui-icon><span>Notes</span></div>
                                             <div class="awsdocs-note-text">
                                                <p>If you see an error message "The rule could not be found" from your
                                                   AWS Lambda function’s console under <b>Configuration</b>, ignore the error message and proceed to
                                                   test the connection.
                                                </p>
                                             </div>
                                          </div>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./vpc-rule-action.html">VPC</div>
                                    <div id="next" class="next-link" accesskey="n" href="./rule-error-handling.html">Error handling (error action)</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/accessing-cross-account-resources-using-rules.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/accessing-cross-account-resources-using-rules.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>