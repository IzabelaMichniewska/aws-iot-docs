<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Creating an AWS IoT rule - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="iot-create-rule" />
      <meta name="default_state" content="iot-create-rule" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-create-rule.html" />
      <meta name="description" content="Create an AWS IoT rule so that you can route data from your connected things." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Creating an AWS IoT rule - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#iot-create-rule" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/iot-create-rule.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-create-rule.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-create-rule.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-create-rule.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#iot-create-rule" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/iot-create-rule.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="iot-create-rule">Creating an AWS IoT rule</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>You configure rules to route data from your connected things. Rules consist of the
                                    following:
                                 </p>
                                 <div class="variablelist">
                                     
                                     
                                     
                                     
                                     
                                     
                                    
                                    <dl>
                                       
                                       <dt><span class="term">Rule name</span></dt>
                                       
                                       <dd>
                                          
                                          <p>The name of the rule.</p>
                                          
                                          <div class="awsdocs-note">
                                             <div class="awsdocs-note-title">
                                                <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                             <div class="awsdocs-note-text">
                                                <p>We do not recommend the use of personally identifiable information in
                                                   your rule names.
                                                </p>
                                             </div>
                                          </div>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">Optional description</span></dt>
                                       
                                       <dd>
                                          
                                          <p>A textual description of the rule.</p>
                                          
                                          <div class="awsdocs-note">
                                             <div class="awsdocs-note-title">
                                                <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                             <div class="awsdocs-note-text">
                                                <p>We do not recommend the use of personally identifiable information in
                                                   your rule descriptions.
                                                </p>
                                             </div>
                                          </div>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">SQL statement</span></dt>
                                       
                                       <dd>
                                          
                                          <p>A simplified SQL syntax to filter messages received on an MQTT topic and
                                             push the data elsewhere. For more information, see <a href="./iot-sql-reference.html">AWS IoT SQL reference</a>.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">SQL version</span></dt>
                                       
                                       <dd>
                                          
                                          <p>The version of the SQL rules engine to use when evaluating the rule.
                                             Although this property is optional, we strongly recommend that you specify
                                             the SQL version. If this property is not set, the default,
                                             <code class="code">2015-10-08</code>, is used. For more information, see <a href="./iot-rule-sql-version.html">SQL versions</a>.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">One or more actions</span></dt>
                                       
                                       <dd>
                                          
                                          <p>The actions AWS IoT performs when executing the rule. For example, you can
                                             insert data into a DynamoDB table, write data to an Amazon S3 bucket, publish to an
                                             Amazon SNS topic, or invoke a Lambda function.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">An error action</span></dt>
                                       
                                       <dd>
                                          
                                          <p>The action AWS IoT performs when it is unable to perform a rule's
                                             action.
                                          </p>
                                          
                                       </dd>
                                       
                                    </dl>
                                 </div>
                                 <p>When you create a rule, be aware of how much data you are publishing on topics. If
                                    you
                                    create rules that include a wildcard topic pattern, they might match a large percentage
                                    of your messages, and you might need to increase the capacity of the AWS resources
                                    used by the target actions. Also, if you create a republish rule that includes a
                                    wildcard topic pattern, you can end up with a circular rule that causes an infinite
                                    loop.
                                 </p>
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>Creating and updating rules are administrator-level actions. Any user who has
                                          permission to create or update rules is able to access data processed by the
                                          rules.
                                       </p>
                                    </div>
                                 </div>
                                 
                                 <p class="title"><b>To create a rule (AWS CLI)</b></p>
                                 
                                 <p>Use the <a href="https://docs.aws.amazon.com/cli/latest/reference/iot/create-topic-rule.html">create-topic-rule</a> command to create a rule:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws iot create-topic-rule --rule-name <code class="replaceable">myrule</code> --topic-rule-payload file://<code class="replaceable">myrule</code>.json</code></code></pre><p>The following is an example payload file with a rule that inserts all messages sent
                                    to
                                    the <code class="code">iot/test</code> topic into the specified DynamoDB table. The SQL statement
                                    filters the messages and the role ARN grants AWS IoT permission to write to the DynamoDB
                                    table.
                                 </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "sql": "SELECT * FROM 'iot/test'",
  "ruleDisabled": false,
  "awsIotSqlVersion": "2016-03-23",
  "actions": [<span>{</span>
      "dynamoDB": <span>{</span>
          "tableName": "my-dynamodb-table",
          "roleArn": "arn:aws:iam::123456789012:role/my-iot-role",
          "hashKeyField": "topic",
          "hashKeyValue": "$<span>{</span>topic(2)}",
          "rangeKeyField": "timestamp",
          "rangeKeyValue": "$<span>{</span>timestamp()}"
      }
  }]
}</code></pre><p>The following is an example payload file with a rule that inserts all messages sent
                                    to
                                    the <code class="code">iot/test</code> topic into the specified S3 bucket. The SQL statement filters
                                    the messages, and the role ARN grants AWS IoT permission to write to the Amazon S3
                                    bucket.
                                 </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "awsIotSqlVersion": "2016-03-23",
  "sql": "SELECT * FROM 'iot/test'",
  "ruleDisabled": false,
  "actions": [
    <span>{</span>
      "s3": <span>{</span>
        "roleArn": "arn:aws:iam::123456789012:role/aws_iot_s3",
        "bucketName": "my-bucket",
        "key": "myS3Key"
      }
    }
  ]
} </code></pre><p>The following is an example payload file with a rule that pushes data to
                                    Amazon Elasticsearch Service:
                                 </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "sql":"SELECT *, timestamp() as timestamp FROM 'iot/test'",
  "ruleDisabled":false,
  "awsIotSqlVersion": "2016-03-23",
  "actions":[
    <span>{</span>
      "elasticsearch":<span>{</span>
        "roleArn":"arn:aws:iam::123456789012:role/aws_iot_es",
        "endpoint":"https://my-endpoint",
        "index":"my-index",
        "type":"my-type",
        "id":"$<span>{</span>newuuid()}"
      }
    }
  ]
}</code></pre><p>The following is an example payload file with a rule that invokes a Lambda
                                    function:
                                 </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "sql": "<em>expression</em>",
  "ruleDisabled": false,
  "awsIotSqlVersion": "2016-03-23",
  "actions": [<span>{</span>
      "lambda": <span>{</span>
          "functionArn": "arn:aws:lambda:us-west-2:123456789012:function:my-lambda-function"
      }
  }]
}</code></pre><p>The following is an example payload file with a rule that publishes to an Amazon SNS
                                    topic:
                                 </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "sql": "<em>expression</em>",
  "ruleDisabled": false,
  "awsIotSqlVersion": "2016-03-23",
  "actions": [<span>{</span>
      "sns": <span>{</span>
          "targetArn": "arn:aws:sns:us-west-2:123456789012:my-sns-topic",
          "roleArn": "arn:aws:iam::123456789012:role/my-iot-role"
      }
  }]
}</code></pre><p>The following is an example payload file with a rule that republishes on a different
                                    MQTT topic:
                                 </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "sql": "<em>expression</em>",
  "ruleDisabled": false,
  "awsIotSqlVersion": "2016-03-23",
  "actions": [<span>{</span>
      "republish": <span>{</span>
          "topic": "my-mqtt-topic",
          "roleArn": "arn:aws:iam::123456789012:role/my-iot-role"
      }
  }]
}</code></pre><p>The following is an example payload file with a rule that pushes data to an Amazon
                                    Kinesis Data Firehose
                                    stream:
                                 </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "sql": "SELECT * FROM 'my-topic'",
  "ruleDisabled": false,
  "awsIotSqlVersion": "2016-03-23",
  "actions": [<span>{</span>
      "firehose": <span>{</span>
          "roleArn": ""arn:aws:iam::123456789012:role/my-iot-role",
          "deliveryStreamName": "my-stream-name"
      }
  }]
}</code></pre><p>The following is an example payload file with a rule that uses the Amazon Machine
                                    Learning
                                    <code class="code">machinelearning_predict</code> function to republish to a topic if the data in
                                    the MQTT payload is classified as a 1.
                                 </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "sql": "SELECT * FROM 'iot/test' where machinelearning_predict('my-model', 'arn:aws:iam::123456789012:role/my-iot-aml-role', *).predictedLabel=1",
  "ruleDisabled": false,
  "awsIotSqlVersion": "2016-03-23",
  "actions": [<span>{</span>
    "republish": <span>{</span>
        "roleArn": "arn:aws:iam::123456789012:role/my-iot-role",
        "topic": "my-mqtt-topic"
    }
  }]
}</code></pre><p>The following is an example payload file with a rule that publishes messages to a
                                    Salesforce IoT Cloud input stream.
                                 </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "sql": "<em>expression</em>",
  "ruleDisabled": false,
  "awsIotSqlVersion": "2016-03-23",
  "actions": [<span>{</span>
      "salesforce": <span>{</span>
          "token": "ABCDEFGHI123456789abcdefghi123456789",
          "url": "https://ingestion-cluster-id.my-env.sfdcnow.com/streams/stream-id/connection-id/my-event"
      }
  }]
}</code></pre><p>The following is an example payload file with a rule that starts an execution of a
                                    Step Functions state machine.
                                 </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "sql": "<em>expression</em>",
  "ruleDisabled": false,
  "awsIotSqlVersion": "2016-03-23",
  "actions": [<span>{</span>
      "stepFunctions": <span>{</span>
          "stateMachineName": "myCoolStateMachine",
          "executionNamePrefix": "coolRunning",
          "roleArn": "arn:aws:iam::123456789012:role/my-iot-role"
      }
  }]
}</code></pre><awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./pass-role.html">Pass role permissions</div>
                                    <div id="next" class="next-link" accesskey="n" href="./iot-view-rules.html">Viewing your rules</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-create-rule.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-create-rule.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>