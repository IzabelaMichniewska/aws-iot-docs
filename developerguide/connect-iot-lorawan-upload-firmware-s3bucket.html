<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Upload the firmware file to an S3 bucket and add an IAM role - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="connect-iot-lorawan-upload-firmware-s3bucket" />
      <meta name="default_state" content="connect-iot-lorawan-upload-firmware-s3bucket" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/connect-iot-lorawan-upload-firmware-s3bucket.html" />
      <meta name="description" content="You can use Amazon S3 to create a bucket , which is a container that can store your firmware update file. You can upload your file to the S3 bucket and add an IAM role that allows the CUPS server to read your update file from the bucket. For more information about Amazon S3, see" />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Upload the firmware file to an S3 bucket and add an IAM role - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#connect-iot-lorawan-upload-firmware-s3bucket" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/connect-iot-lorawan-upload-firmware-s3bucket.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-upload-firmware-s3bucket.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-upload-firmware-s3bucket.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-upload-firmware-s3bucket.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#connect-iot-lorawan-upload-firmware-s3bucket" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/connect-iot-lorawan-upload-firmware-s3bucket.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#connect-iot-lorawan-create-s3-bucket">Create an Amazon S3
                                 bucket and upload the update file</a><a href="#connect-iot-lorawan-s3-iam-permissions">Create an 
                                 IAM role with permissions to read the S3 bucket</a><a href="#connect-iot-lorawan-s3iam-next-steps">Review the next steps</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="connect-iot-lorawan-upload-firmware-s3bucket">Upload the
                                    firmware file to an S3 bucket and add an IAM role
                                 </h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>You can use Amazon S3 to create a <em>bucket</em>, which is a
                                    container that can store your firmware update file. You can upload your file to
                                    the S3 bucket and add an IAM role that allows the CUPS server to read your
                                    update file from the bucket. For more information about Amazon S3, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/GetStartedWithS3.html">
                                       Getting started with Amazon S3</a>.
                                    
                                 </p>
                                 <p>The firmware update file that you want to upload depends on the gateway
                                    you're using. If you followed a procedure similar to the one described in <a href="./connect-iot-lorawan-script-fwupdate-sigkey.html">Generate the
                                       firmware update file and signature</a>, you'll upload
                                    the <code class="code">fwstation</code> file generated by running the scripts.
                                 </p>
                                 <p>This procedure takes about 20 minutes to complete.</p>
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>To upload your firmware file:</strong></p>
                                    <ul>
                                       <li><a href="#connect-iot-lorawan-create-s3-bucket">Create an Amazon S3
                                             bucket and upload the update file</a></li>
                                       <li><a href="#connect-iot-lorawan-s3-iam-permissions">Create an 
                                             IAM role with permissions to read the S3 bucket</a></li>
                                       <li><a href="#connect-iot-lorawan-s3iam-next-steps">Review the next steps</a></li>
                                    </ul>
                                 </div>
                                 
                                 <h2 id="connect-iot-lorawan-create-s3-bucket">Create an Amazon S3
                                    bucket and upload the update file
                                 </h2>
                                 
                                 <p>You'll create an Amazon S3 bucket by using the AWS Management Console and then upload
                                    your firmware update file into the bucket.
                                 </p>
                                  
                                 
                                 <p class="title"><b>Create an S3 bucket</b></p>
                                 
                                 <p>To create an S3 bucket, open the <a href="https://console.aws.amazon.com/s3/home#" rel="noopener noreferrer" target="_blank"><span>Amazon S3 console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. Sign
                                    in if you haven't already and then perform the following steps:
                                 </p>
                                  
                                 
                                 <div class="procedure">
                                    <ol>
                                       <li>
                                          <p>Choose <b>Create bucket</b>.
                                          </p>
                                       </li>
                                       <li>
                                          
                                          <p>Enter a unique and meaningful name for the <b>Bucket
                                                name</b>, (for example,
                                             <code class="code">iotwirelessfwupdate</code>). For recommended naming convention
                                             for your bucket, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html">https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html</a>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Make sure you selected the AWS Region selected as the one you used
                                             to create your LoRaWAN gateway and device, and the <b>Block all 
                                                public access</b> setting is selected so that your bucket uses the
                                             default permissions.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Enable</b> for <b>Bucket versioning</b> 
                                             which will help you keep multiple versions of the firmware update file in
                                             the same bucket.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Confirm <b>Server-side encryption</b> is set to
                                             <b>Disable</b> and choose <b>Create
                                                bucket</b>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <p class="title"><b>Upload your firmware update file</b></p>
                                 
                                 <p>You can now see your bucket in the list of Buckets displayed in the AWS Management
                                    Console. 
                                    Choose your bucket and complete the following steps to upload your file.
                                 </p>
                                  
                                 
                                 <div class="procedure">
                                    <ol>
                                       <li>
                                          
                                          <p>Choose your bucket and then choose <b>Upload</b>. 
                                             
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Add file</b> and then upload the
                                             firmware update file. If you followed the procedure described in
                                             <a href="./connect-iot-lorawan-script-fwupdate-sigkey.html">Generate the
                                                firmware update file and signature</a>,
                                             you'll upload the <code class="code">fwstation</code> file, otherwise upload the
                                             file provided by your gateway manufacturer.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Make sure all settings are set to their default. Make sure
                                             that <b>Predefined ACLs</b> is set to
                                             <b>private</b> and choose
                                             <b>Upload</b> to upload your file.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Copy the S3 URI of the file you uploaded. Choose your bucket
                                             and you'll see the file you uploaded displayed in the list of
                                             <b>Objects</b>. Choose your file and then choose
                                             <b>Copy S3 URI</b>. The URI will be something
                                             like: <code class="code">s3://iotwirelessfwupdate/fwstation</code> if you named
                                             your bucket similar to the example described previously
                                             (<code class="code">fwstation</code>). You'll use the S3 URI when creating
                                             the IAM role.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <h2 id="connect-iot-lorawan-s3-iam-permissions">Create an 
                                    IAM role with permissions to read the S3 bucket
                                 </h2>
                                 
                                 <p>You'll now create an IAM role and policy that will give CUPS the 
                                    permission to read your firmware update file from the S3 bucket.
                                 </p>
                                  
                                 
                                 <p class="title"><b>Create an IAM policy for your role</b></p>
                                 
                                 <p>To create an IAM policy for your AWS IoT Core for LoRaWAN destination role, 
                                    open the <a href="https://console.aws.amazon.com/iam/home#/policies" rel="noopener noreferrer" target="_blank"><span>
                                          Policies hub of the IAM console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> and then complete the 
                                    following steps:
                                 </p>
                                  
                                 
                                 <div class="procedure">
                                    <ol>
                                       <li>
                                          
                                          <p>Choose <b>Create policy</b>, and choose the
                                             <b>JSON</b> tab.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Delete any content from the editor and paste this
                                             policy document. The policy provides permissions to access 
                                             the <code class="code">iotwireless</code> bucket and the firmware update file,
                                             <code class="code">fwstation</code>, stored inside an object.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": [
                "s3:ListBucketVersions",
                "s3:ListBucket",
                "s3:GetObject"
            ],
            "Resource": [
                "arn:aws:s3:::iotwirelessfwupdate/fwstation",
                "arn:aws:s3:::iotwirelessfwupdate"
            ]
        }
    ]
}</code></pre>
                                          </li>
                                       <li>
                                          
                                          <p>Choose <b>Review policy</b>, and in
                                             <b>Name</b>, enter a name for this policy (for example, 
                                             <code class="code">IoTWirelessFwUpdatePolicy</code>). You'll need
                                             this name to use in the next procedure.
                                          </p>                                
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Create policy</b>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <p class="title"><b>Create an IAM role with the attached policy</b></p>
                                 
                                 <p>You'll now create an IAM role and attach the policy created
                                    previously for accessing the S3 bucket. Open the <a href="https://console.aws.amazon.com/iam/home#/roles" rel="noopener noreferrer" target="_blank"><span> Roles hub of the
                                          IAM console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> and complete the following steps:
                                 </p>
                                  
                                 
                                 <div class="procedure">
                                    <ol>
                                       <li>
                                          
                                          <p>Choose <b>Create role</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>In <b>Select type of trusted entity</b>, choose
                                             <b>Another AWS account</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>In <b>Account ID</b>, enter your AWS account ID, and
                                             then choose <b>Next: Permissions</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>In the search box, enter the name of the IAM policy that you created
                                             in the previous procedure. Check the IAM policy (for example, 
                                             <code class="code">IoTWirelessFwUpdatePolicy</code>) you created earlier in the search 
                                             results and choose it.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Next: Tags</b>, and then choose
                                             <b>Next: Review</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>In <b>Role name</b>, enter the name of this role (for example, 
                                             <code class="code">IoTWirelessFwUpdateRole</code>), and then choose 
                                             <b>Create role</b>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <p class="title"><b>Edit trust relationship of the IAM role</b></p>
                                 
                                 <p>In the confirmation message displayed after you ran the previous step, 
                                    choose the name of the role you created to edit it. You'll edit the role to 
                                    add the following trust relationship.
                                 </p>
                                  
                                 
                                 <div class="procedure">
                                    <ol>
                                       <li>
                                          
                                          <p>In the <b>Summary</b> section of the role you created, 
                                             choose the <b>Trust relationships</b> tab, and then
                                             choose <b>Edit trust relationship</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>In <b>Policy Document</b>, change the
                                             <code class="code">Principal</code> property to look like this example.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Principal": <span>{</span> 
    "Service": "iotwireless.amazonaws.com" 
},</code></pre>
                                          <p>After you change the <code class="code">Principal</code> property, the complete
                                             policy document should look like this example.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Principal": <span>{</span>
        "Service": "iotwireless.amazonaws.com"
      },
      "Action": "sts:AssumeRole",
      "Condition": <span>{</span>}
    }
  ]
}</code></pre>
                                          </li>
                                       <li>
                                          
                                          <p>To save your changes and exit, choose <b>Update Trust
                                                Policy</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Obtain the ARN for your role. Choose your IAM role and in
                                             the Summary section, you'll see a <b>Role ARN</b>,
                                             such as
                                             <code class="code">arn:aws:iam::123456789012:role/IoTWirelessFwUpdateRole</code>.
                                             Copy this <b>Role ARN</b>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>                       
                                  
                                 
                                 <h2 id="connect-iot-lorawan-s3iam-next-steps">Review the next steps</h2>
                                 
                                 <p>Now that you have created the S3 bucket and an IAM role that allows
                                    the CUPS server to read the S3 bucket, go to the next topic to schedule and
                                    run the firmware update. Keep the <b>S3 URI</b> and
                                    <b>Role ARN</b> that you copied previously so that you can
                                    enter them to create a task definition that will be run to perform the
                                    firmware update.
                                 </p>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./connect-iot-lorawan-script-fwupdate-sigkey.html">Generate the
                                       firmware update file and signature
                                    </div>
                                    <div id="next" class="next-link" accesskey="n" href="./connect-iot-lorawan-schedule-firmware-update.html">Schedule and
                                       run the firmware update by using a task definition
                                    </div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-upload-firmware-s3bucket.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-upload-firmware-s3bucket.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>