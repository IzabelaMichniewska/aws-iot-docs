<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Security best practices for device agents - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="device-defender-DetectMetricsMessagesBestPract" />
      <meta name="default_state" content="device-defender-DetectMetricsMessagesBestPract" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/device-defender-DetectMetricsMessagesBestPract.html" />
      <meta name="description" content="The agent process should be granted only the minimum permissions required to perform its duties. Agent should be run as non-root user. Agent should run as a dedicated user, in its own group. User/groups should be granted read-only permissions on the resources required to gather and transmit metrics." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Security best practices for device agents - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#device-defender-DetectMetricsMessagesBestPract" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/device-defender-DetectMetricsMessagesBestPract.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/device-defender-DetectMetricsMessagesBestPract.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/device-defender-DetectMetricsMessagesBestPract.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/device-defender-DetectMetricsMessagesBestPract.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#device-defender-DetectMetricsMessagesBestPract" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/device-defender-DetectMetricsMessagesBestPract.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="device-defender-DetectMetricsMessagesBestPract"> Security best practices for
                                    device agents
                                 </h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <div class="variablelist">
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                    
                                    <dl>
                                       
                                       <dt><span class="term">Least Privilege</span></dt>
                                       
                                       <dd>
                                          
                                          <p>The agent process should be granted only the minimum permissions required to perform
                                             its duties.
                                          </p>
                                          
                                          <div class="itemizedlist">
                                             
                                             <p class="title"><b>Basic mechanisms</b></p>
                                              
                                              
                                              
                                              
                                              
                                             
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   
                                                   <p>Agent should be run as non-root user.</p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p>Agent should run as a dedicated user, in its own group.</p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p>User/groups should be granted read-only permissions on the resources required to
                                                      gather and transmit metrics.
                                                   </p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p>Example: read-only on /proc /sys for the sample agent.</p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p>For an example of how to set up a process to run with reduced permissions, see
                                                      the setup instructions that are included with the Python sample agent.
                                                   </p>
                                                   
                                                </li>
                                             </ul>
                                          </div>
                                          
                                          <p>There are a number of well-known Linux mechanisms that can help you further restrict
                                             or isolate your agent process:
                                          </p>
                                          
                                          <div class="itemizedlist">
                                             
                                             <p class="title"><b>Advanced mechanisms</b></p>
                                              
                                              
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   
                                                   <p><a href="https://en.wikipedia.org/wiki/Cgroups" rel="noopener noreferrer" target="_blank"><span>CGroups</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p><a href="https://en.wikipedia.org/wiki/Security-Enhanced_Linux" rel="noopener noreferrer" target="_blank"><span>SELinux</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p><a href="https://en.wikipedia.org/wiki/Chroot" rel="noopener noreferrer" target="_blank"><span>Chroot</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p><a href="https://en.wikipedia.org/wiki/Linux_namespaces" rel="noopener noreferrer" target="_blank"><span>Linux
                                                            Namespaces</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                                                   
                                                </li>
                                             </ul>
                                          </div>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">Operational Resiliency</span></dt>
                                       
                                       <dd>
                                          
                                          <p>An agent process must be resilient to unexpected operational errors and exceptions
                                             and must not crash or exit permanently. The code needs to gracefully handle exceptions
                                             and, as a precaution, it must be configured to automatically restart in case of
                                             unexpected termination (for example, due to system restarts or uncaught
                                             exceptions).
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">Least Dependencies</span></dt>
                                       
                                       <dd>
                                          
                                          <p>An agent must use the least possible number of dependencies (that is, third-party
                                             libraries) in its implementation. If use of a library is justified due to the complexity
                                             of a task (for example, transport layer security), use only well-maintained dependencies
                                             and establish a mechanism to keep them up to date. If the added dependencies contain
                                             functionality not used by the agent and active by default (for example, opening ports,
                                             domain sockets), disable them in your code or by means of the library's configuration
                                             files.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">Process Isolation</span></dt>
                                       
                                       <dd>
                                          
                                          <p>An agent process must only contain functionality required for performing device
                                             metric gathering and transmission. It must not piggyback on other system processes
                                             as a
                                             container or implement functionality for other out of scope use cases. In addition,
                                             the
                                             agent process must refrain from creating inbound communication channels such as domain
                                             socket and network service ports that would allow local or remote processes to interfere
                                             with its operation and impact its integrity and isolation.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">Stealthiness</span></dt>
                                       
                                       <dd>
                                          
                                          <p>An agent process must not be named with keywords such as security, monitoring, or
                                             audit indicating its purpose and security value. Generic code names or random and
                                             unique-per-device process names are preferred. The same principle must be followed
                                             in
                                             naming the directory in which the agent's binaries reside and any names and values
                                             of
                                             process arguments.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">Least Information Shared</span></dt>
                                       
                                       <dd>
                                          
                                          <p>Any agent artifacts deployed to devices must not contain sensitive information such
                                             as privileged credentials, debugging and dead code, or inline comments or documentation
                                             files that reveal details about server-side processing of agent-gathered metrics or
                                             other details about backend systems.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">Transport Layer Security</span></dt>
                                       
                                       <dd>
                                          
                                          <p>To establish TLS secure channels for data transmission, an agent process must
                                             enforce all client-side validations, such as certificate chain and domain name
                                             validation, at the application level, if not enabled by default. Furthermore, an agent
                                             must use a root certificate store that contains trusted authorities and does not contain
                                             certificates belonging to compromised certificate issuers. 
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">Secure Deployment</span></dt>
                                       
                                       <dd>
                                          
                                          <p>Any agent deployment mechanism, such as code push or sync and repositories
                                             containing its binaries, source code and any configuration files (including trusted
                                             root
                                             certificates), must be access-controlled to prevent unauthorized code injection or
                                             tampering. If the deployment mechanism relies on network communication, then use
                                             cryptographic methods to protect the integrity of deployment artifacts in
                                             transit.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">Further Reading</span></dt>
                                       
                                       <dd>
                                          
                                          <div class="itemizedlist">
                                              
                                              
                                              
                                              
                                              
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   
                                                   <p><a href="./security.html">Security in AWS IoT</a></p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p><a href="https://aws.amazon.com/blogs/iot/understanding-the-aws-iot-security-model/" rel="noopener noreferrer" target="_blank"><span>
                                                            Understanding the AWS IoT Security Model</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p><a href="https://access.redhat.com/blogs/766093/posts/2592591" rel="noopener noreferrer" target="_blank"><span> Redhat: A
                                                            Bite of Python</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p><a href="https://hackernoon.com/10-common-security-gotchas-in-python-and-how-to-avoid-them-e19fbe265e03" rel="noopener noreferrer" target="_blank"><span> 10 common security gotchas in Python and how to avoid them</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p><a href="https://www.beyondtrust.com/blog/what-is-least-privilege/" rel="noopener noreferrer" target="_blank"><span> What Is
                                                            Least Privilege &amp; Why Do You Need It?</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p><a href="https://www.owasp.org/index.php/OWASP_Embedded_Application_Security#tab=Embedded_Top_10_Best_Practices" rel="noopener noreferrer" target="_blank"><span> OWASP Embedded Security Top 10</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p><a href="https://www.owasp.org/index.php/OWASP_Internet_of_Things_Project#tab=Main" rel="noopener noreferrer" target="_blank"><span>
                                                            OWASP IoT Project</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                                                   
                                                </li>
                                             </ul>
                                          </div>
                                          
                                       </dd>
                                       
                                    </dl>
                                 </div>
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./device-defender-DetectMetricsGreengrassIntegration.html"> Device agent integration
                                       with AWS IoT Greengrass
                                    </div>
                                    <div id="next" class="next-link" accesskey="n" href="./device-advisor.html">Device Advisor</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/device-defender-DetectMetricsMessagesBestPract.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/device-defender-DetectMetricsMessagesBestPract.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>