<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Diagnosing connectivity issues - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="diagnosing-connectivity-issues" />
      <meta name="default_state" content="diagnosing-connectivity-issues" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/diagnosing-connectivity-issues.html" />
      <meta name="description" content="A successful connection to AWS IoT requires:" />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Diagnosing connectivity issues - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#diagnosing-connectivity-issues" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/diagnosing-connectivity-issues.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/diagnosing-connectivity-issues.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/diagnosing-connectivity-issues.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/diagnosing-connectivity-issues.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#diagnosing-connectivity-issues" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/diagnosing-connectivity-issues.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#troubleshooting-connect">Connection</a><a href="#troubleshooting-authentication">Authentication</a><a href="#troubleshooting-authorization">Authorization</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="diagnosing-connectivity-issues">Diagnosing connectivity issues</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>A successful connection to AWS IoT requires:</p>
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>A valid connection</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>A valid and active certificate</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>A policy that allows the desired connection and operation</p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <h2 id="troubleshooting-connect">Connection</h2>
                                 
                                 <div class="variablelist">
                                     
                                     
                                    
                                    <dl>
                                       
                                       <dt><span class="term">How do I find the correct endpoint?</span></dt>
                                       
                                       <dd>
                                          
                                          <div class="itemizedlist">
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   
                                                   <p>The <code class="code">endpointAddress</code> returned by <code class="code">aws iot <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iot/describe-endpoint.html" rel="noopener noreferrer" target="_blank"><span>describe-endpoint</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> --endpoint-type iot:Data-ATS</code></p>
                                                   
                                                   <p>or</p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p>The <code class="code">domainName</code> returned by <code class="code">aws iot <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iot/describe-domain-configuration.html" rel="noopener noreferrer" target="_blank"><span>describe-domain-configuration</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> –-domain-configuration-name
                                                         "<code class="replaceable">domain_configuration_name</code>"</code></p>
                                                   
                                                </li>
                                             </ul>
                                          </div>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">How do I find the correct Server Name Indication (SNI) value?</span></dt>
                                       
                                       <dd>
                                          
                                          <p>The correct SNI value is the <code class="code">endpointAddress</code> returned by the
                                             <b><a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iot/describe-endpoint.html" rel="noopener noreferrer" target="_blank"><span>describe-endpoint</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></b> or <b><a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iot/describe-domain-configuration.html" rel="noopener noreferrer" target="_blank"><span>describe-domain-configuration</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></b> commands. It's the same address
                                             as the endpoint in the previous step.
                                          </p>
                                          
                                       </dd>
                                       
                                    </dl>
                                 </div>
                                  
                                 
                                 <h2 id="troubleshooting-authentication">Authentication</h2>
                                 
                                 <p>Devices must be <a href="./client-authentication.html">authenticated</a> to connect to
                                    AWS IoT endpoints. For devices that use <a href="./x509-client-certs.html">X.509 client certificates</a> for authentication, the certificates must be
                                    registered with AWS IoT and be active.
                                 </p>
                                 
                                 <div class="variablelist">
                                     
                                     
                                     
                                     
                                    
                                    <dl>
                                       
                                       <dt><span class="term">How do my devices authenticate AWS IoT endpoints?</span></dt>
                                       
                                       <dd>
                                          
                                          <p>Add the AWS IoT CA certificate to your client's trust store. Refer to the
                                             documentation on <a href="x509-client-certs.html#server-authentication" rel="noopener noreferrer" target="_blank">Server
                                                Authentication in AWS IoT Core</a> and then follow the links to download the
                                             appropriate CA certificate.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">What is checked when a device connects to AWS IoT?</span></dt>
                                       
                                       <dd>
                                          
                                          <p>When a device attempts to connect to AWS IoT:</p>
                                          
                                          <div class="orderedlist">
                                              
                                              
                                              
                                             
                                             <ol>
                                                <li>
                                                   
                                                   <p>AWS IoT checks for a valid certificate and Server Name Indication (SNI)
                                                      value.
                                                   </p>
                                                   
                                                </li>
                                                <li>
                                                   
                                                   <p>AWS IoT checks to see that the certificate used is registered with the AWS IoT
                                                      Account and that it has been activated.
                                                   </p>
                                                   
                                                </li>
                                                <li>
                                                   
                                                   <p>When a device attempts to perform any action in AWS IoT, such as to subscribe to
                                                      or publish a message, the policy attached to the certificate it used to connect is
                                                      checked to confirm that the device is authorized to perform that action.
                                                   </p>
                                                   
                                                </li>
                                             </ol>
                                          </div>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">How can I validate a correctly configured certificate?</span></dt>
                                       
                                       <dd>
                                          
                                          <p>Use the OpenSSL <code class="code">s_client</code> command to test a connection to the AWS IoT
                                             endpoint:
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">openssl s_client -connect <code class="replaceable">custom_endpoint</code>.iot.<code class="replaceable">aws-region</code>.amazonaws.com:8443 -CAfile <code class="replaceable">CA.pem</code> -cert <code class="replaceable">cert.pem</code> -key <code class="replaceable">privateKey.pem</code></code></pre>
                                          <p>For more information about using <code class="code">openssl s_client</code>, see <a href="https://www.openssl.org/docs/man1.0.2/man1/openssl-s_client.html" rel="noopener noreferrer" target="_blank"><span>OpenSSL
                                                   s_client documentation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">How do I check the status of a certificate?</span></dt>
                                       
                                       <dd>
                                          
                                          <div class="itemizedlist">
                                              
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                    
                                                   
                                                   <p class="title"><b>List the certificates</b></p>
                                                   
                                                   <p>If you don't know the certificate ID, you can see the status of all your
                                                      certificates by using the <code class="code">aws iot <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iot/list-certificates.html" rel="noopener noreferrer" target="_blank"><span>list-certificates</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></code> command.
                                                   </p>
                                                    
                                                   
                                                </li>
                                                <li class="listitem">
                                                    
                                                   
                                                   <p class="title"><b>Show a certificate's details</b></p>
                                                   
                                                   <p>If you know the certificate's ID, this command shows you more detailed
                                                      information about the certificate.
                                                   </p>
                                                    
                                                   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws iot <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iot/describe-certificate.html" rel="noopener noreferrer" target="_blank"><span>describe-certificate</span></a> --certificate-id "<code class="replaceable">certificateId</code>"</code></pre>
                                                   </li>
                                                <li class="listitem">
                                                    
                                                   
                                                   <p class="title"><b>Review the certificate in the AWS IoT Console</b></p>
                                                   
                                                   <p>In the <a href="https://console.aws.amazon.com/iot/home" rel="noopener noreferrer" target="_blank"><span>AWS IoT console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>,
                                                      in the left menu, choose <b>Secure</b>, and then choose
                                                      <b>Certificates</b>.
                                                   </p>
                                                    
                                                   
                                                   <p>Choose the certificate that you are using to connect from the list to open its
                                                      detail page.
                                                   </p>
                                                   
                                                   <p>In the certificate's detail page, you can see its current status.</p>
                                                   
                                                   <p>The certificate's status can be changed by using the
                                                      <b>Actions</b> menu in the upper-right corner of the details
                                                      page.
                                                   </p>
                                                   
                                                </li>
                                             </ul>
                                          </div>
                                          
                                       </dd>
                                       
                                    </dl>
                                 </div>
                                  
                                 
                                 <h2 id="troubleshooting-authorization">Authorization</h2>
                                 
                                 <p>AWS IoT resources use <a href="./iot-policies.html">AWS IoT Core policies</a> to
                                    authorize those resources to perform <a href="./iot-policy-actions.html">actions</a>. For
                                    an action to be authorized, the specified AWS IoT resources must have a policy document
                                    attached to it that grants permission to perform that action.
                                 </p>
                                 
                                 <div class="variablelist">
                                     
                                     
                                     
                                    
                                    <dl>
                                       
                                       <dt><span class="term">I received a <code class="code">PUBNACK</code> or <code class="code">SUBNACK</code> response from the broker.
                                             What do I do?</span></dt>
                                       
                                       <dd>
                                          
                                          <p>Make sure that there is a policy attached to the certificate you are using to call
                                             AWS IoT. All publish/subscribe operations are denied by default.
                                          </p>
                                          
                                          <p>Make sure the attached policy authorizes the <a href="./iot-policy-actions.html">actions</a> you are trying to perform.
                                          </p>
                                          
                                          <p>Make sure the attached policy authorizes the <a href="./iot-action-resources.html">resources</a> that are trying to perform the authorized actions.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">I have an <em>AUTHORIZATION_FAILURE</em> entry in my logs.</span></dt>
                                       
                                       <dd>
                                          
                                          <p>Make sure that there is a policy attached to the certificate you are using to call
                                             AWS IoT. All publish/subscribe operations are denied by default.
                                          </p>
                                          
                                          <p>Make sure the attached policy authorizes the <a href="./iot-policy-actions.html">actions</a> you are trying to perform.
                                          </p>
                                          
                                          <p>Make sure the attached policy authorizes the <a href="./iot-action-resources.html">resources</a> that are trying to perform the authorized actions.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">How do I check what the policy authorizes?</span></dt>
                                       
                                       <dd>
                                          
                                          <p>In the <a href="https://console.aws.amazon.com/iot/home" rel="noopener noreferrer" target="_blank"><span>AWS IoT console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>, in
                                             the left menu, choose <b>Secure</b>, and then choose
                                             <b>Certificates</b>.
                                          </p>
                                          
                                          <p>Choose the certificate that you are using to connect from the list to open its
                                             detail page.
                                          </p>
                                          
                                          <p>In the certificate's detail page, you can see its current status.</p>
                                          
                                          <p>In the left menu of the certificate's detail page, choose
                                             <b>Policies</b> to see the policies attached to the
                                             certificate.
                                          </p>
                                          
                                          <p>Choose the desired policy to see its details page.</p>
                                          
                                          <p>In the policy's details page, review the policy's <b>Policy
                                                document</b> to see what it authorizes.
                                          </p>
                                          
                                          <p>Choose <b>Edit policy document</b> to make changes to the policy
                                             document.
                                          </p>
                                          
                                       </dd>
                                       
                                    </dl>
                                 </div>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./iot_troubleshooting.html">Troubleshooting</div>
                                    <div id="next" class="next-link" accesskey="n" href="./diagnosing-rules.html">Diagnosing rules issues</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/diagnosing-connectivity-issues.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/diagnosing-connectivity-issues.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>