<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Configure local proxy for devices that use web proxy - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="configure-local-proxy-web-proxy" />
      <meta name="default_state" content="configure-local-proxy-web-proxy" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/configure-local-proxy-web-proxy.html" />
      <meta name="description" content="You can use local proxy on AWS IoT devices to communicate with AWS IoT secure tunneling service APIs. The local proxy transmits data sent by the device application through the secure tunneling service over a WebSocket secure connection. The local proxy can work in" />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Configure local proxy for devices that use web proxy - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#configure-local-proxy-web-proxy" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/configure-local-proxy-web-proxy.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/configure-local-proxy-web-proxy.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/configure-local-proxy-web-proxy.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/configure-local-proxy-web-proxy.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#configure-local-proxy-web-proxy" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/configure-local-proxy-web-proxy.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#build-local-proxy">Build the local proxy</a><a href="#configure-web-proxy">Configure your web proxy</a><a href="#configure-start-local-proxy">Configure and start the 
                                 				local proxy</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="configure-local-proxy-web-proxy">Configure local proxy for devices 
                                    				that use web proxy
                                 </h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>You can use local proxy on AWS IoT devices to communicate with AWS IoT secure tunneling
                                    service
                                    			APIs. The local proxy transmits data sent by the device application through the
                                    secure
                                    			tunneling service over a WebSocket secure connection. The local proxy can work
                                    in
                                    				<code class="code">source</code> or <code class="code">destination</code> mode. In <code class="code">source</code> mode,
                                    			it runs on the same device or network that initiates the TCP connection. In
                                    				<code class="code">destination</code> mode, the local proxy runs on the remote device, along with
                                    			the destination application. For more information, see <a href="./local-proxy.html">Local proxy</a>.
                                 </p>
                                 <p>The local proxy needs to connect directly to the internet to use AWS IoT secure tunneling.
                                    For
                                    			a long-lived TCP connection with the secure tunneling service, the local proxy
                                    upgrades
                                    			the HTTPS request to establish a WebSockets connection to one of the <a href="https://docs.aws.amazon.com/general/latest/gr/iot_device_management.html">secure
                                       				tunneling device connection endpoints</a>.
                                 </p>
                                 <p>If your devices are in a network
                                    			that
                                    			use a web proxy, the web proxy can
                                    			intercept the connections before forwarding them to the internet. To establish
                                    a
                                    			long-lived connection to the secure tunneling device connection endpoints, configure
                                    			your local proxy to use the web proxy as described in the <a href="https://tools.ietf.org/html/rfc6455#section-4.1" rel="noopener noreferrer" target="_blank"><span>websocket
                                          				specification</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                                 </p>
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>The <a href="./iot-sdks.html#iot-sdk-device-client">AWS IoT Device Client</a> doesn't
                                          				support devices that use a web proxy. To work with the web proxy, you'll need
                                          to use
                                          				a local proxy and configure it to work with a web proxy as described below.
                                       </p>
                                    </div>
                                 </div>
                                 <p>The following steps show how the local proxy works with a web proxy.</p>
                                 <div class="orderedlist">
                                    			 
                                    			 
                                    			 
                                    		
                                    <ol>
                                       <li>
                                          				
                                          <p>The local proxy sends an HTTP <code class="code">CONNECT</code> request to the web proxy that contains
                                             					the remote address of the secure tunneling service, along with the web proxy
                                             					authentication information.
                                          </p>
                                          			
                                       </li>
                                       <li>
                                          				
                                          <p>The web proxy will then create a long-lived connection to the remote secure tunneling
                                             					endpoints.
                                          </p>
                                          			
                                       </li>
                                       <li>
                                          				
                                          <p>The TCP connection is established and the local proxy will now work in both source
                                             and
                                             					destination modes for data transmission.
                                          </p>
                                          			
                                       </li>
                                    </ol>
                                 </div>
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>To complete this procedure, perform the following steps.</strong></p>
                                    <ul>
                                       <li><a href="#build-local-proxy">Build the local proxy</a></li>
                                       <li><a href="#configure-web-proxy">Configure your web proxy</a></li>
                                       <li><a href="#configure-start-local-proxy">Configure and start the 
                                             				local proxy</a></li>
                                    </ul>
                                 </div>
                                 			
                                 <h2 id="build-local-proxy">Build the local proxy</h2>
                                 			
                                 <p>Open the <a href="https://github.com/aws-samples/aws-iot-securetunneling-localproxy" rel="noopener noreferrer" target="_blank"><span>local proxy source code</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 
                                    				in the GitHub repository and follow the instructions for
                                    				building and installing the local proxy.
                                 </p>
                                 		 
                                 			
                                 <h2 id="configure-web-proxy">Configure your web proxy</h2>
                                 			
                                 <p>The local proxy relies on the HTTP tunneling mechanism described by the <a href="https://tools.ietf.org/html/rfc7231#section-4.3.6" rel="noopener noreferrer" target="_blank"><span>HTTP/1.1
                                          					specification</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. To comply with the specifications, your web proxy must
                                    				allow devices to use the <code class="code">CONNECT</code> method.
                                 </p>
                                 			
                                 <p>How you configure your web proxy depends on the web proxy you're using and the web
                                    proxy
                                    				version. To make sure you configure the web proxy correctly, check your web proxy's
                                    				documentation.
                                 </p>
                                 			
                                 <p>To configure your web proxy, first identify your web proxy URL and confirm whether
                                    your web
                                    				proxy supports HTTP tunneling. The web proxy URL will be used later when you
                                    				configure and start the local proxy.
                                 </p>
                                 			
                                 <div class="orderedlist">
                                    				 
                                    				 
                                    			
                                    <ol>
                                       <li>
                                          					 
                                          						
                                          <p class="title"><b>Identify your web proxy URL</b></p>
                                          						
                                          <p>Your web proxy URL will be in the following format.</p>				
                                          					 	
                                          					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="replaceable">protocol</code>://<code class="replaceable">web_proxy_host_domain</code>:<code class="replaceable">web_proxy_port</code></code></pre>
                                          					<p>AWS IoT secure tunneling supports only basic authentication for web proxy. To use
                                             basic
                                             						authentication, you must specify the <code class="userinput">username</code> and
                                             							<code class="userinput">password</code> as part of the web proxy URL. The web
                                             						proxy URL will be in the following format.
                                          </p>			
                                          					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="replaceable">protocol</code>://<code class="userinput">username</code>:<code class="userinput">password</code>@<code class="replaceable">web_proxy_host_domain</code>:<code class="replaceable">web_proxy_port</code></code></pre>
                                          					<div class="itemizedlist">
                                             						 
                                             						 
                                             						 
                                             						 
                                             					
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   							
                                                   <p><code class="replaceable">protocol</code> can be <code class="code">http</code> or
                                                      								<code class="code">https</code>. We recommend that you use <code class="code">https</code>.
                                                   </p>
                                                   						
                                                </li>
                                                <li class="listitem">
                                                   							
                                                   <p><code class="replaceable">web_proxy_host_domain</code> is the IP address of your web proxy or a
                                                      								DNS name that resolves to the IP address of your web proxy.
                                                   </p>
                                                   						
                                                </li>
                                                <li class="listitem">
                                                   							
                                                   <p><code class="replaceable">web_proxy_port</code> is the port on which the web proxy is
                                                      								listening.
                                                   </p>
                                                   						
                                                </li>
                                                <li class="listitem">
                                                   							
                                                   <p>The web proxy uses this <code class="userinput">username</code> and
                                                      									<code class="userinput">password</code> to authenticate the
                                                      								request.
                                                   </p>
                                                   						
                                                </li>
                                             </ul>
                                          </div>
                                          				
                                       </li>
                                       <li>
                                          					 
                                          						
                                          <p class="title"><b>Test your web proxy URL</b></p>
                                          						
                                          <p>To confirm whether your web proxy supports TCP tunneling, use a 
                                             							<code class="code">curl</code> command and make sure that you get a <code class="code">2xx</code> or 
                                             							a <code class="code">3xx</code> response.
                                          </p>				
                                          					 	
                                          					
                                          <p>For example, if your web proxy URL is <code class="code">https://server.com:1235</code>, use a
                                             							<code class="code">proxy-insecure</code> flag with the <code class="code">curl</code> command
                                             						because the web proxy might rely on a self-signed certificate.
                                          </p>
                                          					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">export HTTPS_PROXY=https:<code class="replaceable">//server.com:1235</code>
curl -I https://aws.amazon.com --proxy-insecure</code></pre>
                                          					<p>If your web proxy URL has a <code class="code">http</code> port (for example,
                                             							<code class="code">http://server.com:1234</code>), you don't have to use the
                                             							<code class="code">proxy-insecure</code> flag.
                                          </p>
                                          					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">export HTTPS_PROXY=http:<code class="replaceable">//server.com:1234</code>
curl -I https://aws.amazon.com</code></pre>
                                          				</li>
                                    </ol>
                                 </div>
                                 		 
                                 			
                                 <h2 id="configure-start-local-proxy">Configure and start the 
                                    				local proxy
                                 </h2>
                                 			
                                 <p>To configure the local proxy to use a web proxy, you must configure the
                                    					<code class="code">HTTPS_PROXY</code> environment variable with either the DNS domain names
                                    				or the IP addresses and port numbers that your web proxy uses.
                                 </p>
                                 			
                                 <p>After you've configured the local proxy, you can use the local proxy as explained
                                    
                                    				in this <a href="https://github.com/aws-samples/aws-iot-securetunneling-localproxy#readme" rel="noopener noreferrer" target="_blank"><span>README</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 
                                    				document.
                                 </p>
                                 			
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>Your environment variable declaration is case sensitive. We recommend that you define
                                          each
                                          					variable once using either all uppercase or all lowercase letters. The following
                                          					examples show the environment variable declared in uppercase letters. If the
                                          					same variable is specified using both uppercase and lowercase letters, the
                                          					variable specified using lowercase letters takes precedence. 
                                       </p>
                                    </div>
                                 </div>			
                                 			
                                 <p>The following commands show how to configure the local proxy that is running on your
                                    				destination to use the web proxy and start the local proxy.
                                 </p>
                                 			
                                 <div class="itemizedlist">
                                    				 
                                    				 							
                                    			
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          					
                                          <p><code class="code">AWSIOT_TUNNEL_ACCESS_TOKEN</code>: This variable holds the client access token (CAT) 
                                             					for the destination.
                                          </p>
                                          				
                                       </li>
                                       <li class="listitem">
                                          					
                                          <p><code class="code">HTTPS_PROXY</code>: This variable holds the web proxy URL or the IP address for 
                                             						configuring the local proxy.
                                          </p>
                                          				
                                       </li>
                                    </ul>
                                 </div>
                                 			
                                 <p>The commands shown in the following examples depend on the operating system that you
                                    use
                                    				and whether the web proxy is listening on an HTTP or an HTTPS port.
                                 </p>
                                 			 
                                 				
                                 <h3 id="configure-start-local-proxy-http">Web proxy listening on an HTTP port</h3>
                                 				
                                 <p>If your web proxy is listening on an HTTP port, you can provide the web proxy URL
                                    or IP
                                    					address for the <code class="code">HTTPS_PROXY</code> variable.
                                 </p>
                                 				
                                 <awsdocs-tabs>
                                    <dl style="display: none">
                                       					
                                       <dt>Linux/macOS</dt>
                                       <dd tab-id="linux/macos">
                                          							
                                          <p>In Linux or macOS, run the following commands in the terminal to configure and start
                                             								the local proxy on your destination to use a web proxy listening to
                                             								an HTTP port.
                                          </p>						
                                          							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">export AWSIOT_TUNNEL_ACCESS_TOKEN=<code class="replaceable">$<span>{</span>access_token}</code>
export HTTPS_PROXY=<code class="replaceable">http:proxy.example.com:1234</code>
./localproxy -r us-east-1 -d 22</code></pre>      
                                          							<p>If you have to authenticate with the proxy, you must specify a
                                             									<code class="userinput">username</code> and
                                             									<code class="userinput">password</code> as part of the
                                             									<code class="code">HTTPS_PROXY</code> variable.
                                          </p>
                                          							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">export AWSIOT_TUNNEL_ACCESS_TOKEN=<code class="replaceable">$<span>{</span>access_token}</code>
export HTTPS_PROXY=http://<code class="userinput">username</code>:<code class="userinput">password</code>@<code class="replaceable">proxy.example.com:1234</code>
./localproxy -r us-east-1 -d 22</code></pre> 
                                          						</dd>
                                       					
                                       <dt>Windows</dt>
                                       <dd tab-id="windows">
                                          							
                                          <p>In Windows, you configure the local proxy similar to how you do for Linux or macOS,
                                             but
                                             								how you define the environment variables is different from the other
                                             								platforms. Run the following commands in the <code class="code">cmd</code> window
                                             								to configure and start the local proxy on your destination to use a
                                             								web proxy listening to an HTTP port.
                                          </p>
                                          							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="bash ">set AWSIOT_TUNNEL_ACCESS_TOKEN=<code class="replaceable">$<span>{</span>access_token}</code>
set HTTPS_PROXY=http://<code class="replaceable">proxy.example.com:1234</code>
.\localproxy -r us-east-1 -d 22</code></pre> 
                                          							<p>If you have to authenticate with the proxy, you must specify a
                                             									<code class="userinput">username</code> and
                                             									<code class="userinput">password</code> as part of the
                                             									<code class="code">HTTPS_PROXY</code> variable.
                                          </p>
                                          							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">set AWSIOT_TUNNEL_ACCESS_TOKEN=<code class="replaceable">$<span>{</span>access_token}</code>
set HTTPS_PROXY=http://<code class="userinput">username</code>:<code class="userinput">password</code>@<code class="replaceable">10.15.20.25:1234</code>
.\localproxy -r us-east-1 -d 22</code></pre>
                                          						</dd>
                                       				
                                    </dl>
                                 </awsdocs-tabs>
                                 			 
                                 			 
                                 				
                                 <h3 id="configure-start-local-proxy-https">Web proxy listening on an HTTPS
                                    						port
                                 </h3>
                                 				
                                 <p>Run the following commands if your web proxy is listening on an HTTPS port. </p>
                                 				
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>If you're using a self-signed certificate for the web proxy or if you're running the
                                          local
                                          						proxy on an OS that doesn't have native OpenSSL support and default
                                          						configurations, you'll have to set up your web proxy certificates as
                                          						described in the <a href="https://github.com/aws-samples/aws-iot-securetunneling-localproxy#certificate-setup" rel="noopener noreferrer" target="_blank"><span>Certificate setup</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> section in the GitHub repository. 
                                       </p>
                                    </div>
                                 </div>
                                 				
                                 <p>The following commands will look similar to how you configured your web proxy for
                                    an HTTP
                                    					proxy, with the exception that you'll also specify the path to the certificate
                                    					files that you installed as described previously.
                                 </p>
                                 				
                                 <awsdocs-tabs>
                                    <dl style="display: none">
                                       					
                                       <dt>Linux/macOS</dt>
                                       <dd tab-id="linux/macos">
                                          							
                                          <p>In Linux or macOS, run the following commands in the terminal to configure the local
                                             								proxy running on your destination to use a web proxy listening to an
                                             								HTTPS port.
                                          </p>						
                                          							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">export AWSIOT_TUNNEL_ACCESS_TOKEN=<code class="replaceable">$<span>{</span>access_token}</code>
export HTTPS_PROXY=<code class="replaceable">http:proxy.example.com:1234</code>
./localproxy -r us-east-1 -d 22 -c <code class="replaceable">/path/to/certs</code></code></pre>      
                                          							<p>If you have to authenticate with the proxy, you must specify a
                                             									<code class="userinput">username</code> and
                                             									<code class="userinput">password</code> as part of the
                                             									<code class="code">HTTPS_PROXY</code> variable.
                                          </p>
                                          							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">export AWSIOT_TUNNEL_ACCESS_TOKEN=<code class="replaceable">$<span>{</span>access_token}</code>
export HTTPS_PROXY=http://<code class="userinput">username</code>:<code class="userinput">password</code>@<code class="replaceable">proxy.example.com:1234</code>
./localproxy -r us-east-1 -d 22 -c <code class="replaceable">/path/to/certs</code></code></pre> 
                                          						</dd>
                                       					
                                       <dt>Windows</dt>
                                       <dd tab-id="windows">
                                          							
                                          <p>In Windows, run the following commands in the <code class="code">cmd</code> window to configure and
                                             								start the local proxy running on your destination to use a web proxy
                                             								listening to an HTTP port.
                                          </p>
                                          							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="bash ">set AWSIOT_TUNNEL_ACCESS_TOKEN=<code class="replaceable">$<span>{</span>access_token}</code>
set HTTPS_PROXY=http://<code class="replaceable">proxy.example.com:1234</code>
.\localproxy -r us-east-1 -d 22 -c <code class="replaceable">\path\to\certs</code></code></pre> 
                                          							<p>If you have to authenticate with the proxy, you must specify a
                                             									<code class="userinput">username</code> and
                                             									<code class="userinput">password</code> as part of the
                                             									<code class="code">HTTPS_PROXY</code> variable.
                                          </p>
                                          							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">set AWSIOT_TUNNEL_ACCESS_TOKEN=<code class="replaceable">$<span>{</span>access_token}</code>
set HTTPS_PROXY=http://<code class="userinput">username</code>:<code class="userinput">password</code>@<code class="replaceable">10.15.20.25:1234</code>
.\localproxy -r us-east-1 -d 22 -c <code class="replaceable">\path\to\certs</code></code></pre>
                                          						</dd>
                                       				
                                    </dl>
                                 </awsdocs-tabs>
                                 			 
                                 			 
                                 				
                                 <h3 id="example-cmd-output-localproxy-webproxy">Example command and output</h3>				
                                 				
                                 <p>The following shows an example of a command that you run on a Linux OS and the
                                    					corresponding output. The example shows a web proxy that's listening on an HTTP
                                    					port and how the local proxy can be configured to use the web proxy in both
                                    						<code class="code">source</code> and <code class="code">destination</code> modes. Before you can run
                                    					these commands, you must have already opened a tunnel and obtained the client
                                    					access tokens for the source and destination. You must have also built the local
                                    					proxy and configured your web proxy as described previously.
                                 </p>
                                 				
                                 <p>Here's an overview of the steps after you start the local proxy. The local proxy:</p>
                                 				
                                 <div class="itemizedlist">
                                    					 
                                    					 
                                    					 
                                    					 
                                    					 
                                    				
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          						
                                          <p>Identifies the web proxy URL so that it can use the URL to connect to the proxy
                                             							server.
                                          </p>
                                          					
                                       </li>
                                       <li class="listitem">
                                          						
                                          <p>Establishes a TCP connection with the web proxy.</p>
                                          					
                                       </li>
                                       <li class="listitem">
                                          						
                                          <p>Sends an HTTP <code class="code">CONNECT</code> request to the web proxy and waits for the
                                             								<code class="code">HTTP/1.1 200</code> response, which indicates that connection
                                             							has been established.
                                          </p>
                                          					
                                       </li>
                                       <li class="listitem">
                                          						
                                          <p>Upgrades the HTTPS protocol to WebSockets to establish a long-lived connection.</p>
                                          					
                                       </li>
                                       <li class="listitem">
                                          						
                                          <p>Starts transmitting data through the connection to the secure tunneling device
                                             							endpoints. 
                                          </p>
                                          					
                                       </li>
                                    </ul>
                                 </div>
                                 				
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>The following commands used in the examples use the <code class="code">verbosity</code> flag to
                                          						illustrate an overview of the different steps described previously after you
                                          						run the local proxy. We recommend that you use this flag only for testing
                                          						purposes.
                                       </p>
                                    </div>
                                 </div>
                                 				 
                                 					
                                 <p class="title"><b>Running local proxy in source mode</b></p>
                                 					
                                 <p>The following commands show how to run the local proxy in source mode.</p>
                                 				 
                                 				<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">export AWSIOT_TUNNEL_ACCESS_TOKEN=<code class="replaceable">$<span>{</span>access_token}</code>
export HTTPS_PROXY=http:<code class="userinput">username</code>:<code class="userinput">password</code>@<code class="replaceable">10.15.10.25:1234</code>
./localproxy -s 5555 -v 5 -r us-west-2</code></pre> 
                                 				<p>The following shows a sample output of running the local proxy in <code class="code">source</code> mode.
                                 </p> 
                                 				<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">...

Parsed basic auth credentials for the URL
<b>Found Web proxy information in the environment variables, will use it to connect via the proxy.</b>

...

<b>Starting proxy in source mode</b>
Attempting to establish web socket connection with endpoint wss://data.tunneling.iot.us-west-2.amazonaws.com:443
Resolved Web proxy IP: 10.10.0.11
<b>Connected successfully with Web Proxy
Successfully sent HTTP CONNECT to the Web proxy</b>
Full response from the Web proxy:
<b>HTTP/1.1 200 Connection established</b>
TCP tunnel established successfully
<b>Connected successfully with proxy server</b>
<b>Successfully completed SSL handshake with proxy server</b>
Web socket session ID: 0a109afffee745f5-00001341-000b8138-cc6c878d80e8adb0-f186064b
Web socket subprotocol selected: aws.iot.securetunneling-2.0
<b>Successfully established websocket connection with proxy server: wss://data.tunneling.iot.us-west-2.amazonaws.com:443</b>
Seting up web socket pings for every 5000 milliseconds
Scheduled next read:

...

Starting web socket read loop continue reading...
Resolved bind IP: 127.0.0.1
Listening for new connection on port 5555</code></pre> 	
                                 				 
                                 					<p class="title"><b>Running local proxy in destination mode</b></p>
                                 					
                                 <p>The following commands show how to run the local proxy in destination mode.</p>
                                 				 				
                                 				<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">export AWSIOT_TUNNEL_ACCESS_TOKEN=<code class="replaceable">$<span>{</span>access_token}</code>
export HTTPS_PROXY=http:<code class="userinput">username</code>:<code class="userinput">password</code>@<code class="replaceable">10.15.10.25:1234</code>
./localproxy -d 22 -v 5 -r us-west-2</code></pre> 
                                 				<p>The following shows a sample output of running the local proxy in <code class="code">destination</code>
                                    					mode.
                                 </p> 
                                 				<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">...

Parsed basic auth credentials for the URL
<b>Found Web proxy information in the environment variables, will use it to connect via the proxy.</b>

...

<b>Starting proxy in destination mode</b>
Attempting to establish web socket connection with endpoint wss://data.tunneling.iot.us-west-2.amazonaws.com:443
Resolved Web proxy IP: 10.10.0.1
<b>Connected successfully with Web Proxy
Successfully sent HTTP CONNECT to the Web proxy</b>
Full response from the Web proxy:
<b>HTTP/1.1 200 Connection established</b>
TCP tunnel established successfully
<b>Connected successfully with proxy server
Successfully completed SSL handshake with proxy server</b>
Web socket session ID: 06717bfffed3fd05-00001355-000b8315-da3109a85da804dd-24c3d10d
Web socket subprotocol selected: aws.iot.securetunneling-2.0
<b>Successfully established websocket connection with proxy server: wss://data.tunneling.iot.us-west-2.amazonaws.com:443</b>
Seting up web socket pings for every 5000 milliseconds
Scheduled next read:

...

Starting web socket read loop continue reading...</code></pre> 			
                                 			 	   	
                                 	    <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./local-proxy.html">Local proxy</div>
                                    <div id="next" class="next-link" accesskey="n" href="./multiplexing.html">Multiplex data streams in a secure tunnel</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/configure-local-proxy-web-proxy.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/configure-local-proxy-web-proxy.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>