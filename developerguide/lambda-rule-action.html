<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Lambda - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="lambda-rule-action" />
      <meta name="default_state" content="lambda-rule-action" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/lambda-rule-action.html" />
      <meta name="description" content="Use the Lambda rule action to send an MQTT message from AWS IoT to an AWS Lambda function." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Lambda - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#lambda-rule-action" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/lambda-rule-action.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/lambda-rule-action.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/lambda-rule-action.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/lambda-rule-action.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#lambda-rule-action" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/lambda-rule-action.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#lambda-rule-action-requirements">Requirements</a><a href="#lambda-rule-action-parameters">Parameters</a><a href="#lambda-rule-action-examples">Examples</a><a href="#lambda-rule-action-see-also">See also</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="lambda-rule-action">Lambda</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>A Lambda (<code class="code">lambda</code>) action invokes an AWS Lambda function, passing in an
                                    MQTT message. AWS IoT invokes Lambda functions asynchronously.
                                 </p>
                                 <p>You can follow a tutorial that shows you how to create and test a rule with a
                                    Lambda action. For more information, see <a href="./iot-lambda-rule.html">Format a notification by using an AWS Lambda function</a>.
                                 </p>
                                 
                                 <h2 id="lambda-rule-action-requirements">Requirements</h2>
                                 
                                 
                                 <p>This rule action has the following requirements:</p>
                                 
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>For AWS IoT to invoke a Lambda function, you must configure a policy that
                                             grants the <code class="code">lambda:InvokeFunction</code> permission to AWS IoT. You
                                             can only invoke a Lambda function defined in the same AWS Region where
                                             your Lambda policy exists. Lambda functions use resource-based policies,
                                             so you must attach the policy to the Lambda function itself. 
                                          </p>
                                          
                                          <p>Use the following AWS CLI command to attach a policy that grants the
                                             <code class="code">lambda:InvokeFunction</code> permission.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="bash ">aws lambda add-permission --function-name <code class="replaceable">function_name</code> --region <code class="replaceable">region</code> --principal iot.amazonaws.com --source-arn arn:aws:iot:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:rule/<code class="replaceable">rule_name</code> --source-account <code class="replaceable">account-id</code> --statement-id <code class="replaceable">unique_id</code> --action "lambda:InvokeFunction"</code></pre>
                                          <p>The <code class="code">add-permission</code> command expects the following
                                             parameters:
                                          </p>
                                          
                                          <div class="variablelist">
                                              
                                              
                                              
                                              
                                              
                                              
                                              
                                             
                                             <dl>
                                                
                                                <dt><span class="term"><code class="code">--function-name</code></span></dt>
                                                
                                                <dd>
                                                   
                                                   <p>Name of the Lambda function. You add a new permission to
                                                      update the function's resource policy.
                                                   </p>
                                                   
                                                </dd>
                                                 
                                                
                                                <dt><span class="term"><code class="code">--region</code></span></dt>
                                                
                                                <dd>
                                                   
                                                   <p>The AWS Region of the function.</p>
                                                   
                                                </dd>
                                                 
                                                
                                                <dt><span class="term"><code class="code">--principal</code></span></dt>
                                                
                                                <dd>
                                                   
                                                   <p>The principal that gets the permission. This should be
                                                      <code class="code">iot.amazonaws.com</code> to allow AWS IoT permission
                                                      to call the Lambda function.
                                                   </p>
                                                   
                                                </dd>
                                                 
                                                
                                                <dt><span class="term"><code class="code">--source-arn</code></span></dt>
                                                
                                                <dd>
                                                   
                                                   <p>The ARN of the rule. You can use the
                                                      <code class="code">get-topic-rule</code> AWS CLI command to get the ARN
                                                      of a rule.
                                                   </p>
                                                   
                                                </dd>
                                                 
                                                
                                                <dt><span class="term"><code class="code">--source-account</code></span></dt>
                                                
                                                <dd>
                                                   
                                                   <p>The AWS account where the rule is defined.</p>
                                                   
                                                </dd>
                                                 
                                                
                                                <dt><span class="term"><code class="code">--statement-id</code></span></dt>
                                                
                                                <dd>
                                                   
                                                   <p>A unique statement identifier.</p>
                                                   
                                                </dd>
                                                 
                                                
                                                <dt><span class="term"><code class="code">--action</code></span></dt>
                                                
                                                <dd>
                                                   
                                                   <p>The Lambda action you want to allow in this statement. To
                                                      allow AWS IoT to invoke a Lambda function, specify
                                                      <code class="code">lambda:InvokeFunction</code>.
                                                   </p>
                                                   
                                                </dd>
                                                
                                             </dl>
                                          </div>
                                          
                                          <div class="awsdocs-note awsdocs-important">
                                             <div class="awsdocs-note-title">
                                                <awsui-icon name="status-warning" variant="error"></awsui-icon><span>Important</span></div>
                                             <div class="awsdocs-note-text">
                                                <p>If you add a permission for an AWS IoT principal without providing
                                                   the source ARN, any AWS account that creates a rule with your
                                                   Lambda action can trigger rules to invoke your Lambda function from
                                                   AWS IoT.
                                                </p>
                                             </div>
                                          </div>
                                          
                                          <p>For more information, see <a href="https://docs.aws.amazon.com/lambda/latest/dg/intro-permission-model.html">AWS Lambda
                                                permissions</a>.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>If you use an AWS Key Management Service (AWS KMS) customer managed key (CMK) to encrypt
                                             data at rest in Lambda, the service must have permission to use the CMK
                                             on the caller's behalf. For more information, see <a href="https://docs.aws.amazon.com/lambda/latest/dg/security-dataprotection.html#security-privacy-atrest">Encryption at rest</a> in the <em>AWS Lambda Developer
                                                Guide</em>.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                  
                                 
                                 <h2 id="lambda-rule-action-parameters">Parameters</h2>
                                 
                                 
                                 <p>When you create an AWS IoT rule with this action, you must specify the following information:</p>
                                 
                                 
                                 <div class="variablelist">
                                     
                                    
                                    <dl>
                                       
                                       <dt><span class="term"><code class="code">functionArn</code></span></dt>
                                       
                                       <dd>
                                          
                                          <p>The ARN of the Lambda function to invoke. AWS IoT must have
                                             permission to invoke the function. For more information, see <a href="#lambda-rule-action-requirements">Requirements</a>.
                                          </p>
                                          
                                          <p>If you don't specify a version or alias for your Lambda function,
                                             the most recent version of the function is executed. You can specify
                                             a version or alias if you want to execute a specific version of your
                                             Lambda function. To specify a version or alias, append the version or
                                             alias to the ARN of the Lambda function.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">arn:aws:lambda:us-east-2:123456789012:function:myLambdaFunction:someAlias</code></pre>
                                          <p>For more information about versioning and aliases see <a href="https://docs.aws.amazon.com/lambda/latest/dg/versioning-aliases.html">AWS Lambda function versioning and aliases</a>.
                                          </p>
                                          
                                          <p>Supports <a href="./iot-substitution-templates.html">substitution templates</a>: API and AWS CLI only
                                          </p>
                                          
                                       </dd>
                                       
                                    </dl>
                                 </div>
                                  
                                 
                                 <h2 id="lambda-rule-action-examples">Examples</h2>
                                 
                                 
                                 <p>The following JSON example defines a Lambda action in an AWS IoT rule.</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
    "topicRulePayload": <span>{</span>
        "sql": "SELECT * FROM 'some/topic'", 
        "ruleDisabled": false, 
        "awsIotSqlVersion": "2016-03-23",
        "actions": [
            <span>{</span>
                "lambda": <span>{</span>
                    "functionArn": "arn:aws:lambda:us-east-2:123456789012:function:myLambdaFunction"
                 }
            }
        ]
    }
}
</code></pre>
                                 <p>The following JSON example defines a Lambda action with substitution templates
                                    in an AWS IoT rule.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "topicRulePayload": <span>{</span>
        "sql": "SELECT * FROM 'some/topic'",
        "ruleDisabled": false,
        "awsIotSqlVersion": "2016-03-23",
        "actions": [
            <span>{</span>
                "lambda": <span>{</span>
                    "functionArn": "arn:aws:lambda:us-east-1:123456789012:function:$<span>{</span>topic()}"
                }
            }
        ]
    }
}</code></pre>
                                  
                                 <h2 id="lambda-rule-action-see-also">See also</h2>
                                 
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><a href="https://docs.aws.amazon.com/lambda/latest/dg/">What is AWS Lambda?</a> in the
                                             <em>AWS Lambda Developer Guide</em></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="./iot-lambda-rule.html">Format a notification by using an AWS Lambda function</a></p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./kinesis-rule-action.html">Kinesis Data Streams</div>
                                    <div id="next" class="next-link" accesskey="n" href="./republish-rule-action.html">Republish</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/lambda-rule-action.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/lambda-rule-action.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>