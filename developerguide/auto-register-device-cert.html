<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Register a client certificate when the client connects to AWS IoT (just-in-time registration) - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="auto-register-device-cert" />
      <meta name="default_state" content="auto-register-device-cert" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/auto-register-device-cert.html" />
      <meta name="description" content="You can configure a CA certificate to enable client certificates it has signed to register with AWS IoT automatically the first time the client connects to AWS IoT." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Register a client certificate when the client connects to AWS IoT (just-in-time registration) - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#auto-register-device-cert" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/auto-register-device-cert.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/auto-register-device-cert.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/auto-register-device-cert.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/auto-register-device-cert.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#auto-register-device-cert" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/auto-register-device-cert.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#enable-auto-registration-console">Configure a CA
                                 certificate to support automatic registration (console)</a><a href="#enable-auto-registration-cli">Configure a CA
                                 certificate to support automatic registration (CLI)</a><a href="#configure-auto-reg-first-connect">Configure the first
                                 connection by a client for automatic registration</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="auto-register-device-cert">Register a client certificate
                                    when the client connects to AWS IoT (just-in-time registration)
                                 </h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>You can configure a CA certificate to enable client certificates it has
                                    signed to register with AWS IoT automatically the first time the client
                                    connects to AWS IoT.
                                 </p>
                                 <p>To register client certificates when a client connects to AWS IoT for the
                                    first time, you must enable the CA certificate for automatic registration
                                    and configure the first connection by the client to provide the required
                                    certificates.
                                 </p>
                                 
                                 <h2 id="enable-auto-registration-console">Configure a CA
                                    certificate to support automatic registration (console)
                                 </h2>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To configure a CA certificate to support automatic client
                                          certificate registration using the AWS IoT console</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p>Sign in to the AWS Management Console and open the <a href="https://console.aws.amazon.com/iot/home" rel="noopener noreferrer" target="_blank"><span>AWS IoT
                                                   console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>In the left navigation pane, choose
                                             <b>Secure</b>, choose
                                             <b>CAs</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>In the list of certificate authorities, find the one for
                                             which you want to enable automatic registration, and open
                                             the option menu by using the ellipsis icon.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>On the option menu, choose <b>Enable
                                                auto-registration</b>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>The auto-registration status is not shown in the list of
                                          certificate authorities. To see the auto-registration status of
                                          a certificate authority, you must open the
                                          <b>Details</b> page of the certificate
                                          authority.
                                       </p>
                                    </div>
                                 </div>
                                  
                                 
                                 <h2 id="enable-auto-registration-cli">Configure a CA
                                    certificate to support automatic registration (CLI)
                                 </h2>
                                 
                                 <p>If you have already registered your CA certificate with AWS IoT, use
                                    the <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iot/update-ca-certificate.html" rel="noopener noreferrer" target="_blank"><span><b>update-ca-certificate</b></span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> command to
                                    set <code class="code">autoRegistrationStatus</code> of the CA certificate to
                                    <code class="code">ENABLE</code>.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws iot update-ca-certificate \
--certificate-id <code class="replaceable">caCertificateId</code> \
--new-auto-registration-status ENABLE</code></pre>
                                 <p>If you want to enable <code class="code">autoRegistrationStatus</code> when you
                                    register the CA certificate, use the <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iot/register-ca-certificate.html" rel="noopener noreferrer" target="_blank"><span><b>register-ca-certificate</b></span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>
                                    command.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws iot register-ca-certificate \
--allow-auto-registration  \
--ca-certificate file://<code class="replaceable">root_CA_pem_filename</code> \
--verification-cert file://<code class="replaceable">verification_cert_pem_filename</code></code></pre>
                                 <p>Use the <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iot/describe-ca-certificate.html" rel="noopener noreferrer" target="_blank"><span><b>describe-ca-certificate</b></span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> command
                                    to see the status of the CA certificate.
                                 </p>
                                  
                                 
                                 <h2 id="configure-auto-reg-first-connect">Configure the first
                                    connection by a client for automatic registration
                                 </h2>
                                 
                                 <p>When a client attempts to connect to AWS IoT for the first time, it must
                                    present a file that contains both your registered CA certificate and the
                                    client certificate signed by your CA certificate as part of the TLS
                                    handshake. You can combine the two files using a command, such as the
                                    following:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">cat <code class="replaceable">device_cert_filename</code> <code class="replaceable">ca_certificate_pem_filename</code> &gt; <code class="replaceable">combined_filename</code></code></pre>
                                 <p>When the client connects to AWS IoT, use the
                                    <code class="replaceable">combined_filename</code> file as the
                                    certificate file. AWS IoT recognizes the CA certificate as a registered CA
                                    certificate, registers the client certificate, and sets its status to
                                    <code class="code">PENDING_ACTIVATION</code>. This means that the client
                                    certificate was automatically registered and is awaiting activation. The
                                    client certificate's state must be <code class="code">ACTIVE</code> before it can be
                                    used to connect to AWS IoT.
                                 </p>
                                 
                                 <p>When AWS IoT automatically registers a certificate or when a client
                                    presents a certificate in the <code class="code">PENDING_ACTIVATION</code> status,
                                    AWS IoT publishes a message to the following MQTT topic:
                                 </p>
                                 
                                 <p><code class="code">$aws/events/certificates/registered/<code class="replaceable">caCertificateId</code></code></p>
                                 
                                 <p>Where <code class="code"><code class="replaceable">caCertificateId</code></code>
                                    is the ID of the CA certificate that issued the client
                                    certificate.
                                 </p>
                                 
                                 <p>The message published to this topic has the following
                                    structure:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
        "certificateId": "<code class="replaceable">certificateId</code>",
        "caCertificateId": "<code class="replaceable">caCertificateId</code>",
        "timestamp": <code class="replaceable">timestamp</code>,
        "certificateStatus": "PENDING_ACTIVATION",
        "awsAccountId": "<code class="replaceable">awsAccountId</code>",
        "certificateRegistrationTimestamp": "<code class="replaceable">certificateRegistrationTimestamp</code>"
}</code></pre>
                                 <p>You can create a rule that listens on this topic and performs some
                                    actions. We recommend that you create a Lambda rule that verifies the
                                    client certificate is not on a certificate revocation list (CRL),
                                    activates the certificate, and creates and attaches a policy to the
                                    certificate. The policy determines which resources the client can
                                    access. For more information about how to create a Lambda rule that
                                    listens on the
                                    <code class="code">$aws/events/certificates/registered/<code class="replaceable">caCertificateID</code></code>
                                    topic and performs these actions, see <a href="https://aws.amazon.com/blogs/iot/just-in-time-registration-of-device-certificates-on-aws-iot/" rel="noopener noreferrer" target="_blank"><span>Just-in-Time Registration of Client Certificates on AWS IoT</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                                 </p>
                                 
                                 <p>If any error or exception occurs during the auto-registration of the
                                    client certificates, AWS IoT sends events or messages to your logs in
                                    CloudWatch Logs. For more information about setting up the logs for your account,
                                    see the <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/">Amazon CloudWatch documentation</a>.
                                    
                                 </p>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./manual-cert-registration.html">Register a client certificate
                                       manually
                                    </div>
                                    <div id="next" class="next-link" accesskey="n" href="./activate-or-deactivate-device-cert.html">Activate or deactivate a
                                       client certificate
                                    </div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/auto-register-device-cert.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/auto-register-device-cert.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>