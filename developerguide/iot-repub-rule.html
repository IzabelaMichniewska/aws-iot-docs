<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Republish an MQTT message - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="iot-repub-rule" />
      <meta name="default_state" content="iot-repub-rule" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-repub-rule.html" />
      <meta name="description" content="This tutorial demonstrates how to create an AWS IoT rule that publishes an MQTT message when a specified MQTT message is received. The incoming message payload can be modified by the rule before it's published, making it possible to create messages that are tailored to specific applications without the need to alter your device or its firmware. You can also use the filtering aspect of a rule to publish messages only when a specific condition is met." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Republish an MQTT message - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#iot-repub-rule" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/iot-repub-rule.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-repub-rule.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-repub-rule.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-repub-rule.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#iot-repub-rule" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/iot-repub-rule.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#iot-repub-rule-mqtt">Review MQTT topics and AWS IoT rules</a><a href="#iot-repub-rule-define">Create an AWS IoT rule to republish an MQTT
                                 message</a><a href="#iot-repub-rule-test">Test your new rule</a><a href="#iot-repub-rule-review">Review the results and next steps</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="iot-repub-rule">Republish an MQTT message</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>This tutorial demonstrates how to create an AWS IoT rule that publishes an MQTT message
                                    when
                                    a specified MQTT message is received. The incoming message payload can be modified
                                    by the rule
                                    before it's published, making it possible to create messages that are tailored to
                                    specific
                                    applications without the need to alter your device or its firmware. You can also use
                                    the
                                    filtering aspect of a rule to publish messages only when a specific condition is met.
                                 </p>
                                 <p>The messages republished by a rule act like messages sent by any other AWS IoT device
                                    or
                                    client. Devices can subscribe to the republished messages just as they can subscribe
                                    to any
                                    other MQTT message topic.
                                 </p>
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>What you'll learn in this tutorial:</b></p>
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>How to use simple SQL queries and functions in a rule query statement</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>How to use the MQTT client to test an AWS IoT rule</p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 <p>This tutorial takes about 30 minutes to complete.</p>
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>In this tutorial, you'll:</strong></p>
                                    <ul>
                                       <li><a href="#iot-repub-rule-mqtt">Review MQTT topics and AWS IoT rules</a></li>
                                       <li><a href="#iot-repub-rule-define">Create an AWS IoT rule to republish an MQTT
                                             message</a></li>
                                       <li><a href="#iot-repub-rule-test">Test your new rule</a></li>
                                       <li><a href="#iot-repub-rule-review">Review the results and next steps</a></li>
                                    </ul>
                                 </div>
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Before you start this tutorial, make sure that you have:</b></p>
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                           
                                          
                                          <p class="title"><b><a href="./setting-up.html">Set up your AWS account</a></b></p>
                                          
                                          <p>You'll need your AWS account and AWS IoT console to complete this tutorial.</p>
                                           
                                          
                                       </li>
                                       <li class="listitem">
                                           
                                          
                                          <p class="title"><b>Reviewed <a href="./view-mqtt-messages.html">View MQTT messages with the AWS IoT MQTT
                                                   client</a></b></p>
                                          
                                          <p>Be sure you can use the MQTT client to subscribe and publish to a topic. You'll use
                                             the MQTT client to test your new rule in this procedure.
                                          </p>
                                           
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <h2 id="iot-repub-rule-mqtt">Review MQTT topics and AWS IoT rules</h2>
                                 
                                 <p>Before talking about AWS IoT rules, it helps to understand the MQTT protocol. In IoT
                                    solutions, the MQTT protocol offers some advantages over other network communication
                                    protocols, such as HTTP, which makes it a popular choice for use by IoT devices. This
                                    section reviews the key aspects of MQTT as they apply to this tutorial. For information
                                    about how MQTT compares to HTTP, see <a href="./protocols.html#protocol-selection">Choosing a protocol for your device
                                       communication</a>.
                                 </p>
                                  
                                 
                                 <p class="title"><b>MQTT protocol</b></p>
                                 
                                 <p>The MQTT protocol uses a publish/subscribe communication model with its host. To send
                                    data, devices publish messages that are identified by topics to the AWS IoT message
                                    broker.
                                    To receive messages from the message broker, devices subscribe to the topics they
                                    will
                                    receive by sending topic filters in subscription requests to the message broker. The
                                    AWS IoT
                                    rules engine receives MQTT messages from the message broker.
                                 </p>
                                  
                                  
                                 
                                 <p class="title"><b>AWS IoT rules</b></p>
                                 
                                 <p>AWS IoT rules consist of a rule query statement and one or more rule actions. When
                                    the
                                    AWS IoT rules engine receives an MQTT message, these elements act on the message as
                                    follows.
                                 </p>
                                  
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                           
                                          
                                          <p class="title"><b>Rule query statement</b></p>
                                          
                                          <p>The rule's query statement describes the MQTT topics to use, interprets the data
                                             from the message payload, and formats the data as described by a SQL statement that
                                             is
                                             similar to statements used by popular SQL databases. The result of the query statement
                                             is the data that is sent to the rule's actions.
                                          </p>
                                           
                                          
                                       </li>
                                       <li class="listitem">
                                           
                                          
                                          <p class="title"><b>Rule action</b></p>
                                          
                                          <p>Each rule action in a rule acts on the data that results from the rule's query
                                             statement. AWS IoT supports <a href="./iot-rule-actions.html">many rule actions</a>.
                                             In this tutorial, however, you'll concentrate on the <a href="./republish-rule-action.html">Republish</a> rule action,
                                             which publishes the result of the query statement as an MQTT message with a specific
                                             topic.
                                          </p>
                                           
                                          
                                       </li>
                                    </ul>
                                 </div>
                                  
                                 
                                 <h2 id="iot-repub-rule-define">Create an AWS IoT rule to republish an MQTT
                                    message
                                 </h2>
                                 
                                 <p>The AWS IoT rule that you'll create in this tutorial subscribes to the
                                    <code class="code">device/<code class="replaceable">device_id</code>/data</code> MQTT topics where
                                    <code class="replaceable">device_id</code> is the ID of the device that sent the message. These
                                    topics are described by a <a href="./topics.html#topicfilters">topic filter</a> as
                                    <code class="code">device/+/data</code>, where the <code class="code">+</code> is a wildcard character that matches
                                    any string between the two forward slash characters.
                                 </p>
                                 
                                 <p>When the rule receives a message from a matching topic, it takes out the
                                    <code class="code">device_id</code> and <code class="code">temperature</code> values and republishes them as a new
                                    MQTT message with the <code class="code">device/data/temp</code> topic. 
                                 </p>
                                 
                                 <p>For example, the payload of an MQTT message with the <code class="code">device/22/data</code> topic
                                    looks like this:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "temperature": 28,
  "humidity": 80,
  "barometer": 1013,
  "wind": <span>{</span>
    "velocity": 22,
    "bearing": 255
  }
}</code></pre>
                                 <p>The rule takes the <code class="code">temperature</code> value from the message payload and the
                                    <code class="code">device_id</code> from the topic and republishes them as an MQTT message with the
                                    <code class="code">device/data/temp</code> topic and a message payload that looks like this:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "device_id": "22",
  "temperature": 28
}</code></pre>
                                 <p>With this rule, devices that only need the device's ID and the temperature data
                                    subscribe to the <code class="code">device/data/temp</code> topic to receive only that
                                    information.
                                 </p>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To create a rule that republishes an MQTT message</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p>Open <a href="https://console.aws.amazon.com/iot/home#/rulehub" rel="noopener noreferrer" target="_blank"><span>the <b>Rules</b>
                                                   hub of the AWS IoT console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>In <b>Rules</b>, choose <b>Create</b> and start
                                             creating your new rule.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>In the top part of <b>Create a rule</b>:
                                          </p>
                                          
                                          <ol>
                                             <li>
                                                
                                                <p>In <b>Name</b>, enter the rule's name. For this tutorial, name it
                                                   <code class="userinput">republish_temp</code>.
                                                </p>
                                                
                                                <p>Remember that a rule name must be unique within your Account and Region, and it
                                                   can't have any spaces. We've used an underscore character in this name to separate
                                                   the two words in the rule's name.
                                                </p>
                                                
                                             </li>
                                             <li>
                                                
                                                <p> In <b>Description</b>, describe the rule. 
                                                </p>
                                                
                                                <p>A meaningful description makes it easier to remember what this rule does and why
                                                   you created it. The description can be as long as needed, so be as detailed as
                                                   possible. 
                                                </p>
                                                
                                             </li>
                                          </ol>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>In <b>Rule query statement</b> of <b>Create a
                                                rule</b>:
                                          </p>
                                          
                                          <ol>
                                             <li>
                                                
                                                <p> In <b>Using SQL version</b>, select
                                                   <code class="userinput">2016-03-23</code>. 
                                                </p>
                                                
                                             </li>
                                             <li>
                                                
                                                <p>In the <b>Rule query statement</b> edit box, enter the statement: 
                                                </p>
                                                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT topic(2) as device_id, temperature FROM 'device/+/data'</code></pre>
                                                <p>This statement:</p>
                                                
                                                <div class="itemizedlist">
                                                    
                                                    
                                                    
                                                   
                                                   <ul class="itemizedlist" type="disc">
                                                      <li class="listitem">
                                                         
                                                         <p>Listens for MQTT messages with a topic that matches the
                                                            <code class="code">device/+/data</code> topic filter.
                                                         </p>
                                                         
                                                      </li>
                                                      <li class="listitem">
                                                         
                                                         <p>Selects the second element from the topic string and assigns it to the
                                                            <code class="code">device_id</code> field.
                                                         </p>
                                                         
                                                      </li>
                                                      <li class="listitem">
                                                         
                                                         <p>Selects the value <code class="code">temperature</code> field from the message payload
                                                            and assigns it to the <code class="code">temperature</code> field.
                                                         </p>
                                                         
                                                      </li>
                                                   </ul>
                                                </div>
                                                
                                             </li>
                                          </ol>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>In <b>Set one or more actions</b>:
                                          </p>
                                          
                                          <ol>
                                             <li>
                                                
                                                <p>To open up the list of rule actions for this rule, choose <b>Add
                                                      action</b>.
                                                </p>
                                                
                                             </li>
                                             <li>
                                                
                                                <p>In <b>Select an action</b>, choose <b>Republish a message
                                                      to an AWS IoT topic</b>.
                                                </p>
                                                
                                             </li>
                                             <li>
                                                
                                                <p>At the bottom of the action list, choose <b>Configure action</b>
                                                   to open the selected action's configuration page.
                                                </p>
                                                
                                             </li>
                                          </ol>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>In <b>Configure action</b>:
                                          </p>
                                          
                                          <ol>
                                             <li>
                                                
                                                <p> In <b>Topic</b>, enter <code class="userinput">device/data/temp</code>.
                                                   This is the MQTT topic of the message that this rule will publish. 
                                                </p>
                                                
                                             </li>
                                             <li>
                                                
                                                <p> In <b>Quality of Service</b>, choose <b>0 - The message is
                                                      delivered zero or more times</b>. 
                                                </p>
                                                
                                             </li>
                                             <li>
                                                
                                                <p> In <b>Choose or create a role to grant AWS IoT access to perform this
                                                      action</b>:
                                                </p>
                                                
                                                <ol>
                                                   <li>
                                                      
                                                      <p> Choose <b>Create Role</b>. The <b>Create a new
                                                            role</b> dialog box opens. 
                                                      </p>
                                                      
                                                   </li>
                                                   <li>
                                                      
                                                      <p>Enter a name that describes the new role. In this tutorial, use
                                                         <code class="userinput">republish_role</code>. 
                                                      </p>
                                                      
                                                      <p>When you create a new role, the correct policies to perform the rule action
                                                         are created and attached to the new role. If you change the topic of this rule
                                                         action or use this role in another rule action, you must update the policy for
                                                         that role to authorize the new topic or action. To update an existing role,
                                                         choose <b>Update role</b> in this section.
                                                      </p>
                                                      
                                                   </li>
                                                   <li>
                                                      
                                                      <p>Choose <b>Create Role</b> to create the role and close the
                                                         dialog box. 
                                                      </p>
                                                      
                                                   </li>
                                                </ol>
                                                
                                             </li>
                                             <li>
                                                
                                                <p>Choose <b>Add action</b> to add the action to the rule and
                                                   return to the <b>Create a rule</b> page. 
                                                </p>
                                                
                                             </li>
                                          </ol>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>The <b>Republish a message to an AWS IoT topic</b> action is now
                                             listed in <b>Set one or more actions</b>.
                                          </p>
                                          
                                          <p>In the new action's tile, below <b>Republish a message to an AWS IoT
                                                topic</b>, you can see the topic to which your republish action will
                                             publish.
                                          </p>
                                          
                                          <p>This is the only rule action you'll add to this rule.</p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>In <b>Create a rule</b>, scroll down to the bottom and choose
                                             <b>Create rule</b> to create the rule and complete this step.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <h2 id="iot-repub-rule-test">Test your new rule</h2>
                                 
                                 <p>To test your new rule, you'll use the MQTT client to publish and subscribe to the
                                    MQTT
                                    messages used by this rule.
                                 </p>
                                 
                                 <p>Open the <a href="https://console.aws.amazon.com/iot/home#/test" rel="noopener noreferrer" target="_blank"><span>MQTT client in the AWS IoT
                                          console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in a new window. This will let you edit the rule without losing the
                                    configuration of your MQTT client. The MQTT client does not retain any subscriptions
                                    or
                                    message logs if you leave it to go to another page in the console.
                                 </p>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To use the MQTT client to test your rule</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p>In the <a href="https://console.aws.amazon.com/iot/home#/test" rel="noopener noreferrer" target="_blank"><span>MQTT client in the AWS IoT
                                                   console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>, subscribe to the input topics, in this case,
                                             <code class="code">device/+/data</code>.
                                          </p>
                                          
                                          <ol>
                                             <li>
                                                
                                                <p>In the MQTT client, under <b>Subscriptions</b>, choose
                                                   <b>Subscribe to a topic</b>.
                                                </p>
                                                
                                             </li>
                                             <li>
                                                
                                                <p>In <b>Subscription topic</b>, enter the topic of the input topic
                                                   filter, <code class="userinput">device/+/data</code>.
                                                </p>
                                                
                                             </li>
                                             <li>
                                                
                                                <p>Keep the rest of the fields at their default settings.</p>
                                                
                                             </li>
                                             <li>
                                                
                                                <p>Choose <b>Subscribe to topic</b>.
                                                </p>
                                                
                                                <p>In the <b>Subscriptions</b> column, under <b>Publish to a
                                                      topic</b>, <code class="userinput">device/+/data</code> appears. 
                                                </p>
                                                
                                             </li>
                                          </ol>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Subscribe to the topic that your rule will publish:
                                             <code class="code">device/data/temp</code>.
                                          </p>
                                          
                                          <ol>
                                             <li>
                                                
                                                <p>Under <b>Subscriptions</b>, choose <b>Subscribe to a
                                                      topic</b> again, and in <b>Subscription topic</b>, enter the
                                                   topic of the republished message, <code class="userinput">device/data/temp</code>.
                                                </p>
                                                
                                             </li>
                                             <li>
                                                
                                                <p>Keep the rest of the fields at their default settings.</p>
                                                
                                             </li>
                                             <li>
                                                
                                                <p>Choose <b>Subscribe to topic</b>.
                                                </p>
                                                
                                                <p>In the <b>Subscriptions</b> column, under
                                                   <b>device/+/data</b>, <code class="userinput">device/data/temp</code> appears.
                                                   
                                                </p>
                                                
                                             </li>
                                          </ol>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Publish a message to the input topic with a specific device ID,
                                             <code class="userinput">device/22/data</code>. You can't publish to MQTT topics that contain
                                             wildcard characters.
                                          </p>
                                          
                                          <ol>
                                             <li>
                                                
                                                <p>In the MQTT client, under <b>Subscriptions</b>, choose
                                                   <b>Publish to topic</b>.
                                                </p>
                                                
                                             </li>
                                             <li>
                                                
                                                <p>In the <b>Publish</b> field, enter the input topic name,
                                                   <code class="userinput">device/22/data</code>.
                                                </p>
                                                
                                             </li>
                                             <li>
                                                
                                                <p>Copy the sample data shown here and, in the edit box below the topic name, paste
                                                   the sample data.
                                                </p>
                                                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "temperature": 28,
  "humidity": 80,
  "barometer": 1013,
  "wind": <span>{</span>
    "velocity": 22,
    "bearing": 255
  }
}</code></pre>
                                                </li>
                                             <li>
                                                
                                                <p>To send your MQTT message, choose <b>Publish to
                                                      topic</b>.
                                                </p>
                                                
                                             </li>
                                          </ol>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Review the messages that were sent.</p>
                                          
                                          <ol>
                                             <li>
                                                
                                                <p>In the MQTT client, under <b>Subscriptions</b>, there is a green
                                                   dot next to the two topics to which you subscribed earlier.
                                                </p>
                                                
                                                <p>The green dots indicate that one or more new messages have been received since
                                                   the last time you looked at them.
                                                </p>
                                                
                                             </li>
                                             <li>
                                                
                                                <p>Under <b>Subscriptions</b>, choose
                                                   <b>device/+/data</b> to check that the message payload matches what
                                                   you just published and looks like this:
                                                </p>
                                                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "temperature": 28,
  "humidity": 80,
  "barometer": 1013,
  "wind": <span>{</span>
    "velocity": 22,
    "bearing": 255
  }
}</code></pre>
                                                </li>
                                             <li>
                                                
                                                <p>Under <b>Subscriptions</b>, choose
                                                   <b>device/data/temp</b> to check that your republished message
                                                   payload looks like this:
                                                </p>
                                                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "device_id": "22",  
  "temperature": 28
}</code></pre>
                                                <p>Notice that the <code class="code">device_id</code> value is a quoted string and the
                                                   <code class="code">temperature</code> value is numeric. This is because the <a href="./.html#">topic()</a> function extracted the string
                                                   from the input message's topic name while the <code class="code">temperature</code> value uses
                                                   the numeric value from the input message's payload.
                                                </p>
                                                
                                                <p>If you want to make the <code class="code">device_id</code> value a numeric value, replace
                                                   <code class="code">topic(2)</code> in the rule query statement with:
                                                </p>
                                                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">cast(topic(2) AS DECIMAL)</code></pre>
                                                <p>Note that casting the <code class="code">topic(2)</code> value to a numeric value will only
                                                   work if that part of the topic contains only numeric characters.
                                                </p>
                                                
                                             </li>
                                          </ol>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>If you see that the correct message was published to the
                                             <b>device/data/temp</b> topic, then your rule worked. See what more you
                                             can learn about the Republish rule action in the next section.
                                          </p>
                                          
                                          <p>If you don't see that the correct message was published to either the
                                             <b>device/+/data</b> or <b>device/data/temp</b> topics,
                                             check the troubleshooting tips.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <h3 id="iot-repub-rule-trouble">Troubleshooting your Republish message
                                    rule
                                 </h3>
                                 
                                 <p>Here are some things to check in case you're not seeing the results you expect.</p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                           
                                          
                                          <p class="title"><b>You got an error banner</b></p>
                                          
                                          <p>If an error appeared when you published the input message, correct that error
                                             first. The following steps might help you correct that error.
                                          </p>
                                           
                                          
                                       </li>
                                       <li class="listitem">
                                           
                                          
                                          <p class="title"><b>You don't see the input message in the MQTT client</b></p>
                                          
                                          <p>Every time you publish your input message to the <code class="code">device/22/data</code>
                                             topic, that message should appear in the MQTT client if you subscribed to the
                                             <code class="code">device/+/data</code> topic filter as described in the procedure.
                                          </p>
                                           
                                          
                                          <div class="itemizedlist">
                                             
                                             <p class="title"><b>Things to check</b></p>
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                    
                                                   
                                                   <p class="title"><b>Check the topic filter you subscribed to</b></p>
                                                   
                                                   <p>If you subscribed to the input message topic as described in the procedure,
                                                      you should see a copy of the input message every time you publish it.
                                                   </p>
                                                    
                                                   
                                                   <p>If you don't see the message, check the topic name you subscribed to and
                                                      compare it to the topic to which you published. Topic names are case sensitive and
                                                      the topic to which you subscribed must be identical to the topic to which you
                                                      published the message payload.
                                                   </p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                    
                                                   
                                                   <p class="title"><b>Check the message publish function</b></p>
                                                   
                                                   <p>In the MQTT client, under <b>Subscriptions</b>, choose
                                                      <b>device/+/data</b>, check the topic of the publish message, and
                                                      then choose <b>Publish to topic</b>. You should see the message
                                                      payload from the edit box below the topic appear in the message list. 
                                                   </p>
                                                    
                                                   
                                                </li>
                                             </ul>
                                          </div>
                                          
                                       </li>
                                       <li class="listitem">
                                           
                                          
                                          <p class="title"><b>You don't see your republished message in the MQTT client</b></p>
                                          
                                          <p>For your rule to work, it must have the correct policy that authorizes it to
                                             receive and republish a message and it must receive the message.
                                          </p>
                                           
                                          
                                          <div class="itemizedlist">
                                             
                                             <p class="title"><b>Things to check</b></p>
                                              
                                              
                                              
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                    
                                                   
                                                   <p class="title"><b>Check the AWS Region of your MQTT client and the rule that you
                                                         created</b></p>
                                                   
                                                   <p>The console in which you're running the MQTT client must be in the same AWS
                                                      Region as the rule you created. 
                                                   </p>
                                                    
                                                   
                                                </li>
                                                <li class="listitem">
                                                    
                                                   
                                                   <p class="title"><b>Check the input message topic in the rule query statement</b></p>
                                                   
                                                   <p>For the rule to work, it must receive a message with the topic name that
                                                      matches the topic filter in the FROM clause of the rule query statement.
                                                   </p>
                                                    
                                                   
                                                   <p>Check the spelling of the topic filter in the rule query statement with that
                                                      of the topic in the MQTT client. Topic names are case sensitive and the message's
                                                      topic must match the topic filter in the rule query statement.
                                                   </p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                    
                                                   
                                                   <p class="title"><b>Check the contents of the input message payload</b></p>
                                                   
                                                   <p>For the rule to work, it must find the data field in the message payload
                                                      that is declared in the SELECT statement.
                                                   </p>
                                                    
                                                   
                                                   <p>Check the spelling of the <code class="code">temperature</code> field in the rule query
                                                      statement with that of the message payload in the MQTT client. Field names are
                                                      case sensitive and the <code class="code">temperature</code> field in the rule query statement
                                                      must be identical to the <code class="code">temperature</code> field in the message
                                                      payload.
                                                   </p>
                                                   
                                                   <p>Make sure that the JSON document in the message payload is correctly
                                                      formatted. If the JSON has any errors, such as a missing comma, the rule will not
                                                      be able to read it. 
                                                   </p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                    
                                                   
                                                   <p class="title"><b>Check the republished message topic in the rule action</b></p>
                                                   
                                                   <p>The topic to which the Republish rule action publishes the new message must
                                                      match the topic to which you subscribed in the MQTT client.
                                                   </p>
                                                    
                                                   
                                                   <p>Open the rule you created in the console and check the topic to which the rule
                                                      action will republish the message.
                                                   </p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                    
                                                   
                                                   <p class="title"><b>Check the role being used by the rule</b></p>
                                                   
                                                   <p>The rule action must have permission to receive the original topic and
                                                      publish the new topic. 
                                                   </p>
                                                    
                                                   
                                                   <p>The policies that authorize the rule to receive message data and republish it
                                                      are specific to the topics used. If you change the topic used to republish the
                                                      message data, you must update the rule action's role to update its policy to match
                                                      the current topic.
                                                   </p>
                                                   
                                                   <p>If you suspect this is the problem, edit the Republish rule action and create
                                                      a new role. New roles created by the rule action receive the authorizations
                                                      necessary to perform these actions.
                                                   </p>
                                                   
                                                </li>
                                             </ul>
                                          </div>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                  
                                  
                                 
                                 <h2 id="iot-repub-rule-review">Review the results and next steps</h2>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>In this tutorial</b></p>
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>You used a simple SQL query and a couple of functions in a rule query statement to
                                             produce a new MQTT message.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>You created a rule that republished that new message.</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>You used the MQTT client to test your AWS IoT rule.</p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                  
                                 
                                 <p class="title"><b>Next steps</b></p>
                                 
                                 <p>After you republish a few messages with this rule, try experimenting with it to see
                                    how changing some aspects of the tutorial affect the republished message. Here are
                                    some
                                    ideas to get you started.
                                 </p>
                                  
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>Change the <code class="replaceable">device_id</code> in the input message's topic and
                                             observe the effect in the republished message payload.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Change the fields selected in the rule query statement and observe the effect in the
                                             republished message payload.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Try the next tutorial in this series and learn how to <a href="./iot-sns-rule.html">Send an Amazon SNS notification</a>.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>The Republish rule action used in this tutorial can also help you debug rule query
                                    statements. For example, you can add this action to a rule to see how its rule query
                                    statement is formatting the data used by its rule actions.
                                 </p>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./iot-rules-tutorial.html">AWS IoT rules tutorials</div>
                                    <div id="next" class="next-link" accesskey="n" href="./iot-sns-rule.html">Send an Amazon SNS notification</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-repub-rule.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-repub-rule.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>