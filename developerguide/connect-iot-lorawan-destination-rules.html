<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Create rules to process LoRaWAN device messages - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="connect-iot-lorawan-destination-rules" />
      <meta name="default_state" content="connect-iot-lorawan-destination-rules" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/connect-iot-lorawan-destination-rules.html" />
      <meta name="description" content="AWS IoT rules send device messages to other services. AWS IoT rules can also process the binary messages received from a LoRaWAN device to convert the messages to other formats that can make them easier for other services to use." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Create rules to process LoRaWAN device messages - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#connect-iot-lorawan-destination-rules" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/connect-iot-lorawan-destination-rules.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-destination-rules.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-destination-rules.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-destination-rules.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#connect-iot-lorawan-destination-rules" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/connect-iot-lorawan-destination-rules.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#how-rules-process-message">How AWS IoT rules process device messages</a><a href="#create-lorawan-rules">Create rules for LoRaWAN</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="connect-iot-lorawan-destination-rules">Create rules to process
                                    LoRaWAN device messages
                                 </h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>AWS IoT rules send device messages to other services. AWS IoT rules can also process
                                    the binary messages received from a LoRaWAN device to convert the messages to other
                                    formats that can make them easier for other services to use.
                                 </p>
                                 <p><a href="./connect-iot-lorawan-create-destinations.html">AWS IoT Core for LoRaWAN
                                       destinations</a> associate a wireless device with the rule that processes the
                                    device's message data to send to other services. The rule acts on the device's data
                                    as soon as AWS IoT Core for LoRaWAN receives it. <a href="./connect-iot-lorawan-create-destinations.html">AWS IoT Core for LoRaWAN
                                       destinations</a> can be shared by all devices whose messages have the same
                                    data format and that send their data to the same service.
                                 </p>
                                 
                                 <h2 id="how-rules-process-message">How AWS IoT rules process device messages</h2>
                                 
                                 <p>How an AWS IoT rule processes a device's message data depends on the service that
                                    will receive the data, the format of the device's message data, and the data format
                                    that the service requires. Typically, the rule calls an AWS Lambda function to
                                    convert the device's message data to the format a service requires, and then sends
                                    the result to the service.
                                 </p>
                                 
                                 <p>The following illustration shows how message data is secured and processed as it
                                    moves from the wireless device to an AWS service.
                                 </p>
                                 
                                 <div class="mediaobject">
                                     
                                    <img src="images/iot-lorawan-data-flow.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                            Image showing how AWS IoT Core for LoRaWAN data is passed from a wireless device to&#xA;                                AWS IoT and other services.&#xA;                        " />
                                     
                                     
                                    
                                 </div>
                                 
                                 <div class="orderedlist">
                                     
                                     
                                     
                                     
                                    
                                    <ol>
                                       <li>
                                          
                                          <p>The LoRaWAN wireless device encrypts its binary messages using AES128 CTR
                                             mode before it transmits them.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>AWS IoT Core for LoRaWAN decrypts the binary message and encodes the decrypted binary
                                             message payload as a base64 string.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>The resulting base64-encoded message is sent as a binary message payload
                                             (a message payload that is not formatted as a JSON document) to the AWS IoT
                                             rule described in the destination assigned to the device.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>The AWS IoT rule directs the message data to the service described in the
                                             rule's configuration.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <p>The encrypted binary payload received from the wireless device is not altered or
                                    interpreted by AWS IoT Core for LoRaWAN. The decrypted binary message payload is encoded
                                    only as a base64 string. For services to access the data elements in the binary
                                    message payload, the data elements must be parsed out of the payload by a
                                    function called by the rule. The base64-encoded message payload is an ASCII
                                    string, so it could be stored as such to be parsed later.
                                 </p>
                                  
                                 
                                 <h2 id="create-lorawan-rules">Create rules for LoRaWAN</h2>
                                 
                                 <p>AWS IoT Core for LoRaWAN uses AWS IoT rules to securely send device messages directly
                                    to
                                    other AWS services without the need to use the message broker. By removing the
                                    message broker from the ingestion path, it reduces costs and optimizes the data
                                    flow.
                                 </p>
                                 
                                 <p>For an AWS IoT Core for LoRaWAN rule to send device messages to other AWS services,
                                    it
                                    requires an AWS IoT Core for LoRaWAN destination and an AWS IoT rule assigned to that
                                    destination. The AWS IoT rule must contain a SQL query statement and at least one
                                    rule action. 
                                 </p>
                                 
                                 <p>Typically, the AWS IoT rule query statement consists of:</p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>A SQL SELECT clause that selects and formats the data from the message
                                             payload
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>A topic filter (the FROM object in the rule query statement) that
                                             identifies the messages to use
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>An optional conditional statement (a SQL WHERE clause) that specifies
                                             conditions on which to act
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>Here is an example of a rule query statement:</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT temperature FROM iot/topic' WHERE temperature &gt; 50</code></pre>
                                 <p>When building AWS IoT rules to process payloads from LoRaWAN devices, you do not
                                    have to specify the FROM clause as part of the rule query object. The rule query
                                    statement must have the SQL SELECT clause and can optionally have the WHERE
                                    clause. If the query statement uses the FROM clause, it is ignored.
                                 </p>
                                 
                                 <p>Here is an example of a rule query statement that can process payloads from
                                    LoRaWAN devices:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT WirelessDeviceId, WirelessMetadata.LoRaWAN.FPort as FPort,
       WirelessMetadata.LoRaWAN.DevEui as DevEui, 
       PayloadData               </code></pre>
                                 <p>In this example, the <code class="code">PayloadData</code> is a base64-encoded binary
                                    payload sent by your LoRaWAN device.
                                 </p>
                                 
                                 <p>Here is an example rule query statement that can perform a binary decoding of
                                    the incoming payload and transform it into a different format such as
                                    JSON:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT WirelessDeviceId, WirelessMetadata.LoRaWAN.FPort as FPort,
       WirelessMetadata.LoRaWAN.DevEui as DevEui, 
       aws_lambda("arn:aws:lambda:&lt;region&gt;:&lt;account&gt;:function:&lt;name&gt;",                                       
                  <span>{</span>                                      
                   "PayloadData":PayloadData,                                       
                   "Fport": WirelessMetadata.LoRaWAN.FPort   
                  }) as decodingoutput</code></pre>
                                 <p>For more information on using the SELECT AND WHERE clauses, see <a href="./iot-sql-reference.html">AWS IoT SQL reference</a></p>
                                 
                                 <p>For information about AWS IoT rules and how to create and use them, see <a href="./iot-rules.html">Rules for AWS IoT</a> and <a href="./iot-rules-tutorial.html">AWS IoT rules tutorials</a>.
                                 </p>
                                 
                                 <p>For information about creating and using AWS IoT Core for LoRaWAN destinations, see
                                    <a href="./connect-iot-lorawan-create-destinations.html">Add destinations to
                                       AWS IoT Core for LoRaWAN</a>.
                                 </p>
                                 
                                 <p>For information about using binary message payloads in a rule, see <a href="./binary-payloads.html">Working with binary payloads</a>.
                                 </p>
                                 
                                 <p>For more information about the data security and encryption used to protect
                                    the message payload on its journey, see <a href="./data-protection.html">Data protection in AWS IoT Core</a>.
                                 </p>
                                 
                                 <p>For a reference architecture that shows a binary decoding and implementation example
                                    for IoT rules, see <a href="https://github.com/aws-samples/aws-iot-core-lorawan/tree/main/transform_binary_payload" rel="noopener noreferrer" target="_blank"><span>AWS IoT Core for LoRaWAN Solution Samples on GitHub</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                                 </p>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./connect-iot-lorawan-create-destinations.html">Add destinations to
                                       AWS IoT Core for LoRaWAN
                                    </div>
                                    <div id="next" class="next-link" accesskey="n" href="./connect-iot-lorawan-device-connection-status.html">Connect your
                                       LoRaWAN device and verify its connection status
                                    </div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-destination-rules.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-destination-rules.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>