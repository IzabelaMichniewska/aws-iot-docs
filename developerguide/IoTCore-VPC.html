<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Using AWS IoT Core with Interface VPC endpoints - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="IoTCore-VPC" />
      <meta name="default_state" content="IoTCore-VPC" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/IoTCore-VPC.html" />
      <meta name="description" content="Learn how the AWS IoT Core connects with and is used with Amazon VPC endpoints." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Using AWS IoT Core with Interface VPC endpoints - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#IoTCore-VPC" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/IoTCore-VPC.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/IoTCore-VPC.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/IoTCore-VPC.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/IoTCore-VPC.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#IoTCore-VPC" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/IoTCore-VPC.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#Create-VPC-endpoints">Creating VPC endpoints for AWS IoT Core</a><a href="#Control-VPC-access">Controlling Access to AWS IoT Core over VPC endpoints</a><a href="#VPC-limitations">Limitations of VPC endpoints</a><a href="#Scaling-VPC-endpoints">Scaling VPC endpoints with IoT Core</a><a href="#VPC-custom-domains">Using Custom Domains with VPC endpoints</a><a href="#VPC-availability">Availability of VPC endpoints for AWS IoT Core</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="IoTCore-VPC">Using AWS IoT Core with Interface VPC endpoints</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>AWS IoT Core enables you to create <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-connect-devices.html">IoT data endpoints</a> within your VPC, 
                                    using <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpce-interface.html#create-interface-endpoint">Interface VPC endpoints</a>. Interface VPC endpoints are powered by AWS PrivateLink, 
                                    an AWS technology that enables you to access services running on AWS by using private
                                    IP addresses. 
                                    For more information, see <a href="https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Introduction.html">Amazon Virtual Private Cloud</a>.
                                 </p>
                                 <p>In order to connect devices in the field on remote networks, such as a corporate network
                                    to your AWS VPC, refer to the various options listed in the <a href="https://docs.aws.amazon.com/whitepapers/latest/aws-vpc-connectivity-options/network-to-amazon-vpc-connectivity-options.html">Network-to-Amazon VPC connectivity matrix</a>.
                                 </p>
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>VPC endpoints for IoT Core are currently not supported in AWS China regions.</p>
                                    </div>
                                 </div>
                                 <p><b>Chapter Topics:</b></p>
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          <p><a href="#Create-VPC-endpoints">Creating VPC endpoints for AWS IoT Core</a></p>
                                       </li>
                                       <li class="listitem">
                                          <p><a href="#Control-VPC-access">Controlling Access to AWS IoT Core over VPC endpoints</a></p>
                                       </li>
                                       <li class="listitem">
                                          <p><a href="#VPC-limitations">Limitations of VPC endpoints</a></p>
                                       </li>
                                       <li class="listitem">
                                          <p><a href="#Scaling-VPC-endpoints">Scaling VPC endpoints with IoT Core</a></p>
                                       </li>
                                       <li class="listitem">
                                          <p><a href="#VPC-custom-domains">Using Custom Domains with VPC endpoints</a></p>
                                       </li>
                                       <li class="listitem">
                                          <p><a href="#VPC-availability">Availability of VPC endpoints for AWS IoT Core</a></p>
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <h2 id="Create-VPC-endpoints">Creating VPC endpoints for AWS IoT Core</h2>
                                 
                                 <p>To get started with VPC endpoints, simply <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpce-interface.html#create-interface-endpoint">create an interface VPC endpoint</a>, and select IoT Core as the AWS service. 
                                    If you are using the CLI, make sure to call <a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/describe-vpc-endpoint-services.html">describe-vpc-endpoint-services</a> first to ensure that you are choosing an availability zones where AWS IoT Core is
                                    present in your particular region. 
                                    For example, in us-east-1 this command would look like:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">aws ec2 describe-vpc-endpoint-services --service-name com.amazonaws.us-east-1.iot.data</code></pre>
                                  
                                 <h2 id="Control-VPC-access">Controlling Access to AWS IoT Core over VPC endpoints</h2>  
                                 
                                 <p>You can restrict device access to AWS IoT Core to only be allowed via VPC endpoint
                                    by using VPC <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html">condition context keys</a>. 
                                    AWS IoT Core supports the following VPC related context keys:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          <p><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-sourcevpc">SourceVpc</a></p>
                                       </li>
                                       <li class="listitem">
                                          <p><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-sourcevpce">SourceVpce</a></p>
                                       </li>
                                       <li class="listitem">
                                          <p><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-vpcsourceip">VPCSourceIp</a></p>
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>AWS IoT Core does not support <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-access.html#vpc-endpoint-policies">https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-access.html#vpc-endpoint-policies</a>VPC endpoint policies at this time.
                                       </p>
                                    </div>
                                 </div>
                                 
                                 <p> For example, the following policy grants permission to connect to AWS IoT Core using
                                    a client ID that matches the thing name and to publish to any topic prefixed by the
                                    thing name, 
                                    conditional on the device connecting to a VPC endpoint with a particular VPC Endpoint
                                    ID. 
                                    This policy would deny connection attempts to your public IoT data endpoint.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "iot:Connect"
            ],
            "Resource": [
                "arn:aws:iot:us-east-1:123456789012:client/$<span>{</span>iot:Connection.Thing.ThingName}"
            ],
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:SourceVpce": "vpce-1a2b3c4d"
                }
            }
            
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "iot:Publish"
            ],
            "Resource": [
                "arn:aws:iot:us-east-1:123456789012:topic/$<span>{</span>iot:Connection.Thing.ThingName}/*"
            ]
        }
    ]
}</code></pre>
                                  
                                 <h2 id="VPC-limitations">Limitations of VPC endpoints</h2>
                                 
                                 <p>This section covers the limitations of VPC endpoints compared to public endpoints.</p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                      
                                     
                                      
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          <p>VPC endpoints are currently supported for <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-connect-devices.html">IoT data endpoints</a> only
                                          </p>
                                       </li>
                                       <li class="listitem">
                                          <p>MQTT keep alive periods are limited to 230 seconds. Keep alives longer than that period
                                             will be automatically reduced to 230 seconds
                                          </p>
                                       </li>
                                       <li class="listitem">
                                          <p>Each VPC endpoint supports 100,000 total concurrent connected devices. If you require
                                             more connections see <a href="#Scaling-VPC-endpoints">Scaling VPC endpoints with IoT Core</a>.
                                          </p>
                                       </li>
                                       <li class="listitem">
                                          <p>VPC endpoints support IPv4 traffic only.</p>
                                       </li>
                                       <li class="listitem">
                                          <p>VPC endpoints will serve <a href="https://docs.aws.amazon.com/iot/latest/developerguide/server-authentication.html">ATS certificates</a> only, except for custom domains.
                                          </p>
                                       </li>
                                       <li class="listitem">
                                          <p><a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-access.html">VPC endpoint policies</a> are not supported at this time.
                                          </p>
                                       </li>
                                    </ul>
                                 </div>
                                  
                                 
                                 <h2 id="Scaling-VPC-endpoints">Scaling VPC endpoints with IoT Core</h2>
                                 
                                 <p>AWS IoT Core Interface VPC endpoints are limited to one hundred thousand connected
                                    devices over a single interface endpoint. 
                                    If your use case calls for more concurrent connections to the broker, then we recommend
                                    using multiple VPC endpoints and manually routing your devices across your interface
                                    endpoints.
                                    When creating your VPC endpoints, please specify <code class="code">--no-private-dns-enabled</code> as an argument to disable auto-generated Private DNS records for your interface.
                                    
                                    
                                 </p>
                                 
                                 <p>For routing DNS queries from your devices to the VPC endpoint Interfaces correctly,
                                    you will have to create weighted DNS records in a Private Hosted Zone that is attached
                                    to your VPC. 
                                    to get started see <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/hosted-zone-private-creating.html">Creating A Private Hosted Zone</a>.
                                    Within your Private Hosted Zone, you will have to create an alias record per ENI IP
                                    for the VPC endpoint with equal weights across all the weighted records. 
                                    These IP addresses are available from the <code class="code">DescribeNetworkInterfaces</code> API Call when filtered by the VPC Endpoint ID in the description field.
                                    
                                 </p>
                                  
                                 
                                 <h2 id="VPC-custom-domains">Using Custom Domains with VPC endpoints</h2> 
                                 
                                 <p>The VPC endpoints for AWS IoT Core will only generate a wildcard private DNS entry
                                    that matches AWS managed domains in your AWS account when you enable private DNS option.
                                    
                                    If you want to use custom domains with VPC endpoints, you will have to set up a Private
                                    Hosted Zone attached to the VPC that matches the domain name you wish to use with
                                    AWS IoT Core. 
                                    For more information on setting up your private hosted zone. For more information
                                    see <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/hosted-zone-private-creating.html">Creating A Private Hosted Zone</a>.
                                 </p>
                                 
                                 
                                 <p>We recommend creating multiple weighted records for each ENI that is created as part
                                    of your VPCE to route traffic intended for your custom domain to AWS IoT Core.
                                    You can get the list of IPs for the ENIs created as part of a VPC endpoint by calling
                                    <code class="code">DescribeNetworkInterfaces</code> and filtering by the VPC Endpoint ID in the description field.
                                    
                                 </p>
                                  
                                 
                                 <h2 id="VPC-availability">Availability of VPC endpoints for AWS IoT Core</h2>      
                                 
                                 <p>AWS IoT Core Interface VPC endpoints are available in all <a href="http://aws.amazon.com/about-aws/global-infrastructure/regional-product-services/" rel="noopener noreferrer" target="_blank"><span>AWS IoT Core supported regions</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>, with the exception of AWS China regions.
                                 </p>
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./disaster-recovery-resiliency.html">Resilience</div>
                                    <div id="next" class="next-link" accesskey="n" href="./infrastructure-security.html">Infrastructure security</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/IoTCore-VPC.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/IoTCore-VPC.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>