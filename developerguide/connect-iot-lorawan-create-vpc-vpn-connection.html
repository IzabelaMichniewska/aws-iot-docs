<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Use VPN to connect LoRa gateways to your AWS account - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="connect-iot-lorawan-create-vpc-vpn-connection" />
      <meta name="default_state" content="connect-iot-lorawan-create-vpc-vpn-connection" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/connect-iot-lorawan-create-vpc-vpn-connection.html" />
      <meta name="description" content="To connect your gateways on premises to your AWS account, you can use either a Site-to-Site VPN connection or a Client VPN endpoint." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Use VPN to connect LoRa gateways to your AWS account - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#connect-iot-lorawan-create-vpc-vpn-connection" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/connect-iot-lorawan-create-vpc-vpn-connection.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-create-vpc-vpn-connection.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-create-vpc-vpn-connection.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-create-vpc-vpn-connection.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#connect-iot-lorawan-create-vpc-vpn-connection" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/connect-iot-lorawan-create-vpc-vpn-connection.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#connect-iot-lorawan-vpc-site-vpn">Site-to-Site VPN endpoint</a><a href="#connect-iot-lorawan-vpc-client-vpn">Client VPN endpoint</a><a href="#connect-iot-lorawan-vpc-vpn-connect">Connect to LNS and CUPS VPC endpoints</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="connect-iot-lorawan-create-vpc-vpn-connection">Use VPN to connect LoRa 
                                    gateways to your AWS account
                                 </h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>To connect your gateways on premises to your AWS account, you can use either 
                                    a Site-to-Site VPN connection or a Client VPN endpoint.
                                 </p>
                                 <p>Before you can connect your on premises gateways, 
                                    you must have created the VPC endpoint, and configured a private hosted zone and inbound
                                    
                                    resolver so that traffic from the gateways don't go over the public internet. For
                                    more 
                                    information, see <a href="./connect-iot-lorawan-create-vpc-lns-cups.html">Create VPC interface endpoint
                                       and private hosted zone</a>.
                                 </p>
                                 
                                 <h2 id="connect-iot-lorawan-vpc-site-vpn">Site-to-Site VPN endpoint</h2>
                                 
                                 <p>If you don't have the gateway hardware or want to test the VPN connection
                                    using a different AWS account, you can use a Site-to-Site VPN connection. You can
                                    use
                                    Site-to-Site VPN to connect to the VPC endpoints from the same AWS account or another
                                    AWS account that you might be using in a different AWS Region.
                                 </p>
                                 
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>If you've the gateway hardware with you and want to set up a VPN
                                          connection, we recommend that you use Client VPN instead. For instructions,
                                          see <a href="#connect-iot-lorawan-vpc-client-vpn">Client VPN endpoint</a>.
                                       </p>
                                    </div>
                                 </div>
                                 
                                 <p>To set up a Site-to-Site VPN:</p>
                                 
                                 <div class="orderedlist">
                                                             
                                     
                                     
                                    
                                    <ol>
                                       <li>
                                          
                                          <p>Create another VPC in the site from which you want to set up the
                                             connection. For <code class="code">VPC-A</code>, you can reuse the VPC that you
                                             created previously. To create another VPC (for example,
                                             <code class="code">VPC-B</code>), use a CIDR block that doesn't overlap with
                                             the CIDR block of the VPC you created previously.
                                             .
                                          </p>
                                          
                                          <div class="awsdocs-note">
                                             <div class="awsdocs-note-title">
                                                <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                             <div class="awsdocs-note-text">
                                                <p>The Site-to-Site VPN VPN method described in the document uses OpenSWAN for the VPN
                                                   
                                                   connection, which supports only one VPN tunnel. If you use a different commercial
                                                   
                                                   software for the VPN, you might be able to set up two tunnels bettween the sites.
                                                </p>
                                             </div>
                                          </div>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>After you set up the VPN connection, update the
                                             <code class="code">/etc/resolv.conf</code> file by adding the inbound
                                             resolver's IP address from your AWS account. For information about
                                             how to obtain this IP address, see <a href="./connect-iot-lorawan-create-vpc-lns-cups.html#connect-iot-lorawan-configure-route53-resolver">Configure Route 53 
                                                inbound resolver</a>. For this example, we can use the IP address <code class="code">10.100.0.145</code> 
                                             that was assigned when you created the Route 53 Resolver.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">options timeout:2 attempts:5
; generated by /usr/sbin/dhclient-script
search <code class="replaceable">region</code>.compute.internal
nameserver 10.100.0.145</code></pre>
                                          </li>
                                       <li>
                                          
                                          <p>We can now test whether the VPN connection uses the AWS PrivateLink endpoint 
                                             instead of going over the public internet by using an <code class="code">nslookup</code> 
                                             command. The following shows an example of running the command.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">nslookup <code class="replaceable">account-specific-prefix</code>.lns.lorawan.<code class="replaceable">region</code>.amazonaws.com</code></pre>
                                          <p>The following shows an example output of running the command,
                                             which shows a private IP address indicating that the connection has been 
                                             established to the AWS PrivateLink LNS endpoint.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">Server: 10.100.0.145
Address: 10.100.0.145

Non-authoritative answer:
Name: https://xxxxx.lns.lorawan.region.amazonaws.com
Address: 10.100.0.204</code></pre>
                                          </li>
                                    </ol>
                                 </div>
                                 
                                 <p>For information about using a Site-to-Site VPN connection, see <a href="https://docs.aws.amazon.com/vpn/latest/s2svpn/how_it_works.html">How Site-to-Site VPN works</a>.
                                 </p>                    
                                  
                                 
                                 <h2 id="connect-iot-lorawan-vpc-client-vpn">Client VPN endpoint</h2>
                                 
                                 <p>AWS Client VPN is a managed client-based VPN service that enables you 
                                    to securely access AWS resources and resources in your on-premises network. The 
                                    following shows the architecture for the client VPN service.
                                 </p>
                                 
                                 <div class="mediaobject">
                                     
                                    <img src="images/lorawan-privatelink-client-vpn.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                            Image showing how you can use AWS Client VPN to connect your LoRa gateway &#xA;                            on premises.&#xA;                        " />
                                     
                                     
                                    
                                 </div>
                                 
                                 <p>To establish a VPN connection to a Client VPN endpoint:</p>
                                 
                                 <div class="orderedlist">
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                    
                                    <ol>
                                       <li>
                                          
                                          <p>Create a Client VPN endpoint by following the instructions described 
                                             in <a href="https://docs.aws.amazon.com/vpn/latest/clientvpn-admin/cvpn-getting-started.html">
                                                Getting started with AWS Client VPN</a>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          
                                          <p>Log in to your on-premises network (for example, a Wi-Fi router)
                                             by using the access URL for that router (for example,
                                             <code class="code">192.168.1.1</code>),
                                             and find the root name and password.
                                          </p>
                                          
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Set up your LoRaWAN gateway by following the instructions in the
                                             gateway's documentation and then add your gateway to AWS IoT Core for LoRaWAN.
                                             For information about how to add your gateway, see <a href="./connect-iot-lorawan-onboard-gateways.html">Onboard your gateways to
                                                AWS IoT Core for LoRaWAN</a>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Check whether your gateway's firmware is up to date. If the
                                             firmware is out of date, you can follow the instructions provided in
                                             the on-premises network to update your gateway's firmware. For more
                                             information, see <a href="./connect-iot-lorawan-update-firmware.html">Update gateway firmware 
                                                using CUPS service with AWS IoT Core for LoRaWAN</a>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Check whether OpenVPN has been enabled. If it has been enabled,
                                             skip to the next step to configure the OpenVPN client inside the
                                             
                                             
                                             on-premises network. If it hasn't been enabled, follow the
                                             instructions in <a href="https://www.ovpn.com/en/guides/openwrt" rel="noopener noreferrer" target="_blank"><span>Guide to install OpenVPN for OpenWrt</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                                          </p>
                                          
                                          <div class="awsdocs-note">
                                             <div class="awsdocs-note-title">
                                                <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                             <div class="awsdocs-note-text">
                                                <p>For this example, we use OpenVPN. You can use other VPN clients 
                                                   such as AWS VPN or AWS Direct Connect to set up your Client VPN
                                                   connection.
                                                </p>
                                             </div>
                                          </div>
                                          
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Configure the OpenVPN client based on information from the client
                                             configuration and how you can use <a href="https://openwrt.org/docs/guide-user/services/vpn/openvpn/client-luci" rel="noopener noreferrer" target="_blank"><span>OpenVPN client using LuCi</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          
                                          <p>SSH to your on-premises network and update the
                                             <code class="code">/etc/resolv.conf</code> file by adding the IP address of
                                             the inbound resolver in your AWS account
                                             
                                             (<code class="code">10.100.0.145</code>).
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>For the gateway traffic to use AWS PrivateLink to connect to the endpoint, 
                                             replace the first DNS entry for your gateway to the inbound resolver's 
                                             IP address.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <p>For information about using a Site-to-Site VPN connection, see <a href="https://docs.aws.amazon.com/vpn/latest/clientvpn-user/user-getting-started.html">Getting started with Client VPN</a>.
                                 </p> 
                                  
                                 
                                 <h2 id="connect-iot-lorawan-vpc-vpn-connect">Connect to LNS and CUPS VPC endpoints</h2>
                                 
                                 <p>The following shows how you can test your connection to the LNS and CUPS 
                                    VPC endpoints.
                                 </p>
                                  
                                 
                                 <p class="title"><b>Test CUPS endpoint</b></p>
                                 
                                 <p>To test your AWS PrivateLink connection to the CUPS endpoint from your LoRa gateway,
                                    
                                    run the following command:
                                 </p>
                                  
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">curl -k -v -X POST https://xxxx.cups.region.iotwireless.iot:443/update-info 
     --cacert cups.trust --cert cups.crt --key cups.key --header "Content-Type: application/json" 
     --data '<span>{</span> 
              "router": "xxxxxxxxxxxxx", 
              "cupsUri": "https://xxxx.cups.lorawan.region.amazonaws.com:443",
              "cupsCredCrc":1234, "tcCredCrc":552384314
             }' 
      —output cups.out</code></pre>
                                  
                                 <p class="title"><b>Test LNS endpoint</b></p>
                                 
                                 <p>To test your LNS endpoint, first provision a LoRaWAN device that will
                                    work with your wireless gateway. You can then add your device and
                                    perform the <em>join</em> procedure after which you can
                                    start sending uplink messages.
                                 </p>
                                                                      
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./connect-iot-lorawan-create-vpc-lns-cups.html">Create VPC interface endpoint
                                       and private hosted zone
                                    </div>
                                    <div id="next" class="next-link" accesskey="n" href="./connect-iot-lorawan-manage-gateways.html">Managing gateways with
                                       AWS IoT Core for LoRaWAN
                                    </div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-create-vpc-vpn-connection.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/connect-iot-lorawan-create-vpc-vpn-connection.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>