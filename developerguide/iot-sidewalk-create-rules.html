<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Create rules to process Sidewalk device messages - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="iot-sidewalk-create-rules" />
      <meta name="default_state" content="iot-sidewalk-create-rules" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-sidewalk-create-rules.html" />
      <meta name="description" content="AWS IoT rules can receive the messages from Sidewalk devices and route them to other services. AWS IoT Core for LoRaWAN destinations associate a Sidewalk device with the rule that processes the device's message data to send to other services." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Create rules to process Sidewalk device messages - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#iot-sidewalk-create-rules" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/iot-sidewalk-create-rules.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-sidewalk-create-rules.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-sidewalk-create-rules.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-sidewalk-create-rules.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#iot-sidewalk-create-rules" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/iot-sidewalk-create-rules.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#iot-sidewalk-create-rules-destination">Create a Sidewalk
                                 destination rule</a><a href="#iot-sidewalk-rules-next-steps">Next steps</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="iot-sidewalk-create-rules">Create rules to process Sidewalk device
                                    messages
                                 </h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>AWS IoT rules can receive the messages from Sidewalk devices and route them to other
                                    services. <a href="./connect-iot-lorawan-create-destinations.html">AWS IoT Core for LoRaWAN
                                       destinations</a> associate a Sidewalk device with the rule that processes the
                                    device's message data to send to other services.
                                 </p>
                                 <p>You can use an existing rule for your destination. In this section, we'll create the
                                    rule, <code class="code">SidewalkRule</code>, that you specified when creating the Sidewalk
                                    destination, as described in <a href="./iot-sidewalk-add-destination.html">Add a destination for your Sidewalk
                                       device</a>. When creating the rule, we'll create
                                    an AWS Lambda action to republish the message to an AWS IoT topic.
                                 </p>
                                 
                                 <h2 id="iot-sidewalk-create-rules-destination">Create a Sidewalk
                                    destination rule
                                 </h2>
                                 
                                 <p>Navigate to the <a href="https://console.aws.amazon.com/iot/home#/create/rule" rel="noopener noreferrer" target="_blank"><span>
                                          Rules</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> Hub of the AWS IoT console and perform the following steps.
                                 </p>
                                 
                                 <div class="orderedlist">
                                     
                                     
                                     
                                     
                                     
                                     
                                    
                                    <ol>
                                       <li>
                                          
                                          <p>Choose <b>Create a rule</b> to create a new rule for the
                                             destination. 
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Enter the name <code class="userinput">SidewalkRule</code> for the
                                             <b>Name</b> and specify an optional
                                             <b>Description</b> for the rule (for example,
                                             <code class="userinput">Sidewalk rule for lambda action to republish a
                                                topic</code>).
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Change the default query statement to <code class="userinput">SELECT *</code> so
                                             that any actions associated with the rule will be performed. Keep the SQL
                                             version to <code class="code">2016-03-23</code>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Under <b>Set one or more actions</b>, choose <b>Add
                                                action</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>For the rule action, choose <b>Send a message to a Lambda
                                                function</b> and then choose <b>Configure
                                                action</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>You can choose an existing Lambda function or create a new one. In this
                                             example, we'll create a Lambda function. Choose <b>Create a new Lambda
                                                function</b>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <p class="title"><b>Create your function using AWS Lambda</b></p>
                                 
                                 <p>Choosing <b>Create a new Lambda function</b> opens the 
                                    <a href="https://console.aws.amazon.com/lambda/home#/create/function" rel="noopener noreferrer" target="_blank"><span>Functions</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> page of
                                    the Lambda console. Perform the following steps.
                                 </p>
                                  
                                 
                                 <div class="orderedlist">
                                     
                                     
                                     
                                     
                                     
                                     
                                    
                                    <ol>
                                       <li>
                                          
                                          <p>To create your function, choose <b>Author from
                                                scratch</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>For <b>Function name</b>, enter a name (for example,
                                             <code class="userinput">Sidewalk_Handler</code>), choose <code class="code">Python 3.8</code>
                                             as <b>Runtime</b>, and then choose <b>Create
                                                function</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose the <b>lambda.py</b> function in the <b>Code
                                                source</b> section of the console. 
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>In the function body, delete any code inside the function body, and add a
                                             print statement for your Lambda function. You can also base64 decode the
                                             <code class="code">PayloadData</code> to receive the application data that your
                                             device sends to AWS IoT. The following shows an example Lambda function. 
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python ">import json
import base64

def lambda_handler(event, context):

    message = json.dumps(event)
    print (message)

    payload_data = base64.b64decode(event["PayloadData"])
    print(payload_data)
    print(int(payload_data,16))</code></pre>
                                          </li>
                                       <li>
                                          
                                          <p>To deploy your function code, choose <b>deploy</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Go back to the <a href="https://console.aws.amazon.com/iot/home#/create/rule" rel="noopener noreferrer" target="_blank"><span> Rules</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> Hub of the console and refresh the page. Choose the
                                             Lambda function that you created and choose <b>Add
                                                action</b>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <p class="title"><b>Republish a message to an AWS IoT topic</b></p>
                                 
                                 <p>You can add a second action to republish a message to an AWS IoT topic from the
                                    <a href="https://console.aws.amazon.com/iot/home#/create/rule" rel="noopener noreferrer" target="_blank"><span> Rules</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>
                                    Hub of the console.
                                 </p>
                                  
                                 
                                 <div class="orderedlist">
                                     
                                     
                                     
                                     
                                     
                                     
                                    
                                    <ol>
                                       <li>
                                          
                                          <p>Choose <b>Add action</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Republish a message to an AWS IoT topic</b> and
                                             choose <b>Configure action</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Enter <code class="userinput">project/sensor/observed</code> for the
                                             <b>Topic</b> and make sure the <b>Quality of
                                                Service</b> is set to <b>0 - The message is delivered zero
                                                or more times</b>. 
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Create Role</b>. Enter
                                             <b>SidewalkRepublishRole</b> for the role name and choose
                                             <b>Create Role</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Add action</b>.
                                          </p>
                                          
                                          <p>Both actions appear in the <b>Rules</b> Hub of the AWS IoT
                                             console.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Create rule</b>.
                                          </p>
                                          
                                          <p>The rule appears on the <b>Rules</b> page that shows the
                                             list of rules.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <h2 id="iot-sidewalk-rules-next-steps">Next steps</h2>
                                 
                                 <p>Now that you've created the destination rule for your Sidewalk device, you can
                                    connect your device and observe messages on the topic that you subscribed to. For
                                    more information, see <a href="./iot-sidewalk-connect-uplink-metadata.html">Connect your Sidewalk device and
                                       view uplink metadata format</a>.
                                 </p>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./iot-sidewalk-add-destination.html">Add a destination for your Sidewalk
                                       device
                                    </div>
                                    <div id="next" class="next-link" accesskey="n" href="./iot-sidewalk-connect-uplink-metadata.html">Connect your Sidewalk device and
                                       view uplink metadata format
                                    </div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-sidewalk-create-rules.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/iot-sidewalk-create-rules.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>