<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Interact with Device Shadow using the shadow.py sample app and MQTT test client - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="interact-lights-device-shadows" />
      <meta name="default_state" content="interact-lights-device-shadows" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/interact-lights-device-shadows.html" />
      <meta name="description" content="To interact with the shadow.py sample app, enter a value in the terminal for the desired value. For example, you can specify colors that resemble the traffic lights and AWS IoT responds to the request and updates the reported values." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Interact with Device Shadow using the shadow.py sample app and MQTT test client - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#interact-lights-device-shadows" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/interact-lights-device-shadows.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/interact-lights-device-shadows.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/interact-lights-device-shadows.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/interact-lights-device-shadows.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#interact-lights-device-shadows" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/interact-lights-device-shadows.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#update-desired-shadow-sample">Update desired and reported values using shadow.py sample app</a><a href="#shadow-sample-view-msg">View messages from the shadow.py
                                 sample app in the MQTT test client</a><a href="#shadow-observe-messages-troubleshoot">Troubleshoot errors with Device
                                 Shadow interactions</a><a href="#sample-shadow-review">Review the results and next steps</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="interact-lights-device-shadows">Interact with Device Shadow using the
                                    <code class="code">shadow.py</code> sample app and MQTT test client
                                 </h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>To interact with the <code class="code">shadow.py</code> sample app, enter a value in the terminal for the
                                    <code class="code">desired</code> value. For example, you can specify colors that resemble the traffic
                                    lights and AWS IoT responds to the request and updates the reported values.
                                 </p>
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>In this tutorial, you'll learn how to:</b></p>
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>Use the <code class="code">shadow.py</code> sample app to specify desired states and update the shadow's current
                                             state.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Edit the Shadow document to observe delta events and how the <code class="code">shadow.py</code> sample app responds to
                                             it.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Use the MQTT test client to subscribe to shadow topics and observe updates when you
                                             run the sample program.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p class="title"><b>Before you run this tutorial, you must have:</b></p>
                                 
                                 <p>Set up your AWS account, configured your Raspberry Pi device, and created an AWS IoT
                                    thing and policy. You must have also installed the required software, Device SDK,
                                    certificate files, and run the sample program in the terminal. For more information,
                                    see
                                    the previous tutorials <a href="./create-resources-shadow.html">Create AWS IoT resources and connect Raspberry Pi to
                                       run shadow application</a> and <a href="./lightbulb-shadow-application.html#run-sample-application-shadows"></a>. You must complete these tutorials if you haven't already.
                                 </p>
                                 
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>In this tutorial, you'll:</strong></p>
                                    <ul>
                                       <li><a href="#update-desired-shadow-sample">Update desired and reported values using shadow.py sample app</a></li>
                                       <li><a href="#shadow-sample-view-msg">View messages from the shadow.py
                                             sample app in the MQTT test client</a></li>
                                       <li><a href="#shadow-observe-messages-troubleshoot">Troubleshoot errors with Device
                                             Shadow interactions</a></li>
                                       <li><a href="#sample-shadow-review">Review the results and next steps</a></li>
                                    </ul>
                                 </div>
                                 <p>This tutorial takes about 45 minutes to complete.</p>
                                 
                                 <h2 id="update-desired-shadow-sample">Update desired and reported values using <code class="code">shadow.py</code> sample app
                                 </h2>
                                 
                                 <p>In the previous tutorial <a href="./lightbulb-shadow-application.html#run-sample-application-shadows"></a>, you learnt how to observe a message
                                    published to the Shadow document in the AWS IoT console when you enter a desired value
                                    as
                                    described in the section <a href="./lightbulb-shadow-application.html">Install the Device SDK and run the
                                       shadow.py sample application for Device Shadows</a>.
                                 </p>        
                                 
                                 <p>In the previous example, we set the desired color to <code class="code">yellow</code>. After you
                                    enter each value, the terminal prompts you to enter another <code class="code">desired</code> value. If
                                    you again enter the same value (<code class="code">yellow</code>), the app recognizes this and prompts
                                    you to enter a new <code class="code">desired</code> value.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="bash ">Enter desired value:
yellow
Local value is already 'yellow'.
Enter desired value:</code></pre>
                                 <p>Now, say that you enter the color <code class="code">green</code>. AWS IoT responds to the request
                                    and updates the <code class="code">reported</code> value to <code class="code">green</code>. This is how the update
                                    happens when the <code class="code">desired</code> state is different from the <code class="code">reported</code>
                                    state, causing a delta.
                                 </p>
                                 
                                 <div class="orderedlist">
                                    
                                    <p class="title"><b>How the <code class="code">shadow.py</code> sample app simulates Device Shadow interactions:</b></p>
                                     
                                     
                                     
                                     
                                    
                                    <ol>
                                       <li>
                                          
                                          <p>Enter a <code class="code">desired</code> value (say <code class="code">yellow</code>) in the terminal to
                                             publish the desired state.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>As the <code class="code">desired</code> state is different from the <code class="code">reported</code>
                                             state (say the color <code class="code">green</code>), a delta occurs, and the app that is
                                             subscribed to the delta receives this message.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>The app responds to the message and updates its state to the <code class="code">desired</code>
                                             value, <code class="code">yellow</code>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>The app then publishes an update message with the new reported value of the
                                             device's state, <code class="code">yellow</code>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>        
                                 
                                 <p>Following shows the messages displayed in the terminal that shows how the update
                                    request is published.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="bash ">Enter desired value:
green
Changed local shadow value to 'green'.
Updating reported shadow value to 'green'...
Update request published.
Finished updating reported shadow value to 'green'.</code></pre>
                                 <p>In the AWS IoT console, the Shadow document reflects the updated value to
                                    <code class="code">green</code> for both the <code class="code">reported</code> and <code class="code">desired</code> fields,
                                    and the version number is incremented by 1. For example, if the previous version number
                                    was displayed as 10, the current version number will display as 11.
                                 </p>
                                 
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>Deleting a shadow doesn't reset the version number to 0. You'll see that the
                                          shadow version is incremented by 1 when you publish an update request or create
                                          another shadow with the same name.
                                       </p>
                                    </div>
                                 </div>
                                  
                                 
                                 <p class="title"><b>Edit the Shadow document to observe delta events</b></p>
                                 
                                 <p>The <code class="code">shadow.py</code> sample app is also subscribed to <code class="code">delta</code>
                                    events, and responds when there is a change to the <code class="code">desired</code> value. For
                                    example, you can change the <code class="code">desired</code> value to the color <code class="code">red</code>. To
                                    do this, in the AWS IoT console, edit the Shadow document by clicking
                                    <b>Edit</b> and then set the <code class="code">desired</code> value to
                                    <code class="code">red</code> in the JSON, while keeping the <code class="code">reported</code> value to
                                    <code class="code">green</code>. Before you save the changes, keep the terminal on the Raspberry Pi
                                    open as you'll see messages displayed in the terminal when the change occurs.
                                 </p>
                                  
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "desired": <span>{</span>
    "welcome": "aws-iot",
    "color": "red"
  },
  "reported": <span>{</span>
    "welcome": "aws-iot",
    "color": "green"
  }
}</code></pre>
                                 <p>After you save the new value, the <code class="code">shadow.py</code> sample app responds to this
                                    change and displays messages in the terminal indicating the delta. You should then
                                    see the
                                    following messages appear below the prompt for entering the <code class="code">desired</code>
                                    value.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="bash ">Enter desired value:
Received shadow delta event.
  Delta reports that desired value is 'red'. Changing local value...
Changed local shadow value to 'red'.
Updating reported shadow value to 'red'...
Finished updating reported shadow value to 'red'.
Enter desired value:
Update request published.
Finished updating reported shadow value to 'red'.</code></pre>
                                  
                                 <h2 id="shadow-sample-view-msg">View messages from the <code class="code">shadow.py</code>
                                    sample app in the MQTT test client
                                 </h2>
                                 
                                 <p>You can use the <b>MQTT test client</b> in the <b>AWS IoT
                                       console</b> to monitor MQTT messages that are passed in your AWS account. By
                                    subscribing to reserved MQTT topics used by the Device Shadow service, you can observe
                                    the
                                    messages received by the topics when running the sample app.
                                 </p>
                                 
                                 <p>If you haven't already used the MQTT test client, you can review <a href="./view-mqtt-messages.html">View MQTT messages with the AWS IoT MQTT
                                       client</a>. This helps you learn
                                    how to use the <b>MQTT test client</b> in the <b>AWS IoT
                                       console</b> to view MQTT messages as they pass through the message broker.
                                 </p>
                                 
                                 <div class="procedure">
                                    <ol>
                                       <li>
                                          
                                          <p class="title"><b>Open the MQTT test client</b></p>
                                          
                                          <p>Open the <a href="https://console.aws.amazon.com/iot/home#/test" rel="noopener noreferrer" target="_blank"><span>MQTT test client in the AWS IoT
                                                   console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in a new window so that you can observe the messages received by the
                                             MQTT topics without losing the configuration of your MQTT test client. The MQTT test
                                             client doesn't retain any subscriptions or message logs if you leave it to go to
                                             another page in the console. For this section of the tutorial, you can have the Shadow
                                             document of your AWS IoT thing and the MQTT test client open in separate windows to
                                             more
                                             easily observe the interaction with Device Shadows.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p class="title"><b>Subscribe to the MQTT reserved Shadow topics</b></p>
                                          
                                          <p>You can use the MQTT test client to enter the names of the Device Shadow's MQTT reserved
                                             
                                             topics and subscribe to them to receive updates when running the 
                                             <code class="code">shadow.py</code> sample app. To subscribe to the topics:
                                          </p>
                                          
                                          <ol>
                                             <li>
                                                <p>In the <b>MQTT test client</b> in the <b>AWS IoT
                                                      console</b>, choose <b>Subscribe to a topic</b>.
                                                </p>               
                                                
                                             </li>
                                             <li>
                                                <p> In the <b>Topic filter</b> section, enter: <b>$aws/things/<code class="replaceable">thingname</code>/shadow/update/#</b>.
                                                   Here, <code class="code">thingname</code> is the name of the thing resource that you created
                                                   earlier (for example, <code class="code">My_light_bulb</code>).
                                                </p>
                                                
                                             </li>
                                             <li>
                                                <p>Keep the default values for the additional configuration settings, and then choose
                                                   <b>Subscribe</b>.
                                                </p>
                                                
                                             </li>
                                          </ol>
                                          
                                          <p>By using the <b>#</b> wildcard in the topic subscription, you can
                                             subscribe to multiple MQTT topics at the same time and observe all the messages that
                                             
                                             are exchanged between the device and it's Shadow in a single window. For more information
                                             about the wildcard characters and their use, see <a href="./topics.html">MQTT topics</a>.
                                          </p>            
                                          
                                       </li>
                                       <li>
                                          
                                          <p class="title"><b>Run <code class="code">shadow.py</code> sample program and observe messages</b></p>
                                          
                                          <p>In your command line window of the Raspberry Pi, if you've disconnected the
                                             program, run the sample app again and watch the messages in the <b>MQTT test
                                                client</b> in the <b>AWS IoT console</b>.
                                          </p>
                                          
                                          <ol>
                                             <li>
                                                
                                                <p>Run the following command to restart the sample program. Replace
                                                   <code class="replaceable">your-iot-thing-name</code> and
                                                   <code class="replaceable">your-iot-endpoint</code> with the names of the AWS IoT thing
                                                   that you created earlier (for example, <code class="code">My_light_bulb</code>), and the
                                                   endpoint to interact with the device. 
                                                </p>
                                                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="bash ">cd ~/aws-iot-device-sdk-python-v2/samples
python3 shadow.py --root-ca ~/certs/Amazon-root-CA-1.pem --cert ~/certs/device.pem.crt --key ~/certs/private.pem.key --endpoint <code class="replaceable">your-iot-endpoint</code> --thing-name <code class="replaceable">your-iot-thing-name</code></code></pre>
                                                <p>The <code class="code">shadow.py</code> sample app then runs and retrieves the current
                                                   shadow state. If you've deleted the shadow or cleared the current states, the
                                                   program sets the current value to <code class="code">off</code> and then prompts you to enter a
                                                   <code class="code">desired</code> value.
                                                </p>
                                                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">Connecting to a3qEXAMPLEffp-ats.iot.us-west-2.amazonaws.com with client ID 'test-0c8ae2ff-cc87-49d2-a82a-ae7ba1d0ca5a'...
Connected!
Subscribing to Delta events...
Subscribing to Update responses...
Subscribing to Get responses...
Requesting current shadow state...
Launching thread to read user input...
Finished getting initial shadow state.
  Shadow document lacks 'color' property. Setting defaults...
Changed local shadow value to 'off'.
Updating reported shadow value to 'off'...
Update request published.
Finished updating reported shadow value to 'off'...
Enter desired value:</code></pre>
                                                <p>On the other hand, if the program was running and you restarted it, you'll see
                                                   the latest color value reported in the terminal. In the MQTT test client, you'll
                                                   see an update to the topics <b>$aws/things/<code class="replaceable">thingname</code>/shadow/get</b> and
                                                   <b>$aws/things/<code class="replaceable">thingname</code>/shadow/get/accepted</b>.
                                                </p>
                                                
                                                <p>Suppose the latest color reported was <code class="code">green</code>. Following shows the
                                                   contents of the <b>$aws/things/<code class="replaceable">thingname</code>/shadow/get/accepted</b>
                                                   JSON file.
                                                </p>
                                                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "state": <span>{</span>
    "desired": <span>{</span>
      "welcome": "aws-iot",
      "color": "green"
    },
    "reported": <span>{</span>
      "welcome": "aws-iot",
      "color": "green"
    }
  },
  "metadata": <span>{</span>
    "desired": <span>{</span>
      "welcome": <span>{</span>
        "timestamp": 1620156892
      },
      "color": <span>{</span>
        "timestamp": 1620161643
      }
    },
    "reported": <span>{</span>
      "welcome": <span>{</span>
        "timestamp": 1620156892
      },
      "color": <span>{</span>
        "timestamp": 1620161643
      }
    }
  },
  "version": 10,
  "timestamp": 1620173908
}            
                </code></pre>
                                                </li>
                                             <li>
                                                
                                                <p>Enter a <code class="code">desired</code> value in the terminal, such as
                                                   <code class="code">yellow</code>. The <code class="code">shadow.py</code> sample app responds and displays the following messages
                                                   in the terminal that show the change in the <code class="code">reported</code> value to
                                                   <code class="code">yellow</code>.
                                                </p>
                                                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="bash ">Enter desired value:
yellow
Changed local shadow value to 'yellow'.
Updating reported shadow value to 'yellow'...
Update request published.
Finished updating reported shadow value to 'yellow'.</code></pre>
                                                <p>In the <b>MQTT test client</b> in the <b>AWS IoT
                                                      console</b>, under <b>Subscriptions</b>, you see that the
                                                   following topics received a message:
                                                </p>
                                                
                                                <div class="itemizedlist">
                                                    
                                                    
                                                    
                                                   
                                                   <ul class="itemizedlist" type="disc">
                                                      <li class="listitem">
                                                         
                                                         <p><b>$aws/things/<code class="replaceable">thingname</code>/shadow/update</b>:
                                                            shows that both <code class="code">desired</code> and <code class="code">updated</code> values change
                                                            to the color <code class="code">yellow</code>.
                                                         </p>
                                                         
                                                      </li>
                                                      <li class="listitem">
                                                         
                                                         <p><b>$aws/things/<code class="replaceable">thingname</code>/shadow/update/accepted</b>:
                                                            shows the current values of the <code class="code">desired</code> and
                                                            <code class="code">reported</code> states and their metadata and version
                                                            information.
                                                         </p>
                                                         
                                                      </li>
                                                      <li class="listitem">
                                                         
                                                         <p><b>$aws/things/<code class="replaceable">thingname</code>/shadow/update/documents</b>:
                                                            shows the previous and current values of the <code class="code">desired</code> and
                                                            <code class="code">reported</code> states and their metadata and version
                                                            information.
                                                         </p>
                                                         
                                                      </li>
                                                   </ul>
                                                </div>
                                                
                                                <p>As the document <b>$aws/things/<code class="replaceable">thingname</code>/shadow/update/documents</b>
                                                   also contains information that is contained in the other two topics, we can review
                                                   it to see the state information. The previous state shows the reported value set
                                                   to <code class="code">green</code>, its metadata and version information, and the current state
                                                   that shows the reported value updated to <code class="code">yellow</code>.
                                                </p>
                                                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "previous": <span>{</span>
    "state": <span>{</span>
      "desired": <span>{</span>
        "welcome": "aws-iot",
        "color": "green"
      },
      "reported": <span>{</span>
        "welcome": "aws-iot",
        "color": "green"
      }
    },
    "metadata": <span>{</span>
      "desired": <span>{</span>
        "welcome": <span>{</span>
          "timestamp": 1617297888
        },
        "color": <span>{</span>
          "timestamp": 1617297898
        }
      },
      "reported": <span>{</span>
        "welcome": <span>{</span>
          "timestamp": 1617297888
        },
        "color": <span>{</span>
          "timestamp": 1617297898
        }
      }
    },
    "version": 10
  },
  "current": <span>{</span>
    "state": <span>{</span>
      "desired": <span>{</span>
        "welcome": "aws-iot",
        "color": "yellow"
      },
      "reported": <span>{</span>
        "welcome": "aws-iot",
        "color": "yellow"
      }
    },
    "metadata": <span>{</span>
      "desired": <span>{</span>
        "welcome": <span>{</span>
          "timestamp": 1617297888
        },
        "color": <span>{</span>
          "timestamp": 1617297904
        }
      },
      "reported": <span>{</span>
        "welcome": <span>{</span>
          "timestamp": 1617297888
        },
        "color": <span>{</span>
          "timestamp": 1617297904
        }
      }
    },
    "version": 11
  },
  "timestamp": 1617297904
}</code></pre>
                                                </li>
                                             <li>
                                                
                                                <p>Now, if you enter another <code class="code">desired</code> value, you see further changes
                                                   to the <code class="code">reported</code> values and message updates received by these topics.
                                                   The version number also increments by 1. For example, if you enter the value
                                                   <code class="code">green</code>, the previous state reports the value <code class="code">yellow</code> and
                                                   the current state reports the value <code class="code">green</code>.
                                                </p>
                                                
                                             </li>
                                          </ol>
                                          
                                       </li>
                                       <li>
                                          
                                          <p class="title"><b>Edit Shadow document to observe delta events</b></p>
                                          
                                          <p>To observe changes to the delta topic, edit the Shadow document in the AWS IoT
                                             console. For example, you can change the <code class="code">desired</code> value to the color
                                             <code class="code">red</code>. To do this, in the AWS IoT console, choose
                                             <b>Edit</b> and then set the <code class="code">desired</code> value to red in
                                             the JSON, while keeping the <code class="code">reported</code> value set to <code class="code">green</code>.
                                             Before you save the change, keep the terminal open as you'll see the delta message
                                             reported in the terminal.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "desired": <span>{</span>
    "welcome": "aws-iot",
    "color": "red"
  },
  "reported": <span>{</span>
    "welcome": "aws-iot",
    "color": "green"
  }
}</code></pre>
                                          <p>The <code class="code">shadow.py</code> sample app responds to this change and displays
                                             messages in the terminal indicating the delta. In the MQTT test client, the
                                             <code class="code">update</code> topics will have received a message showing changes to the
                                             <code class="code">desired</code> and <code class="code">reported</code> values.
                                          </p>
                                          
                                          <p>You also see that the topic <b>$aws/things/<code class="replaceable">thingname</code>/shadow/update/delta</b>
                                             received a message. To see the message, choose this topic, which is listed under
                                             <b>Subscriptions</b>.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "version": 13,
  "timestamp": 1617318480,
  "state": <span>{</span>
    "color": "red"
  },
  "metadata": <span>{</span>
    "color": <span>{</span>
      "timestamp": 1617318480
    }
  }
}</code></pre>
                                          </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <h2 id="shadow-observe-messages-troubleshoot">Troubleshoot errors with Device
                                    Shadow interactions
                                 </h2>
                                 
                                 <p>When you run the Shadow sample app, you might encounter issues with observing
                                    interactions with the Device Shadow service. 
                                 </p>
                                 
                                 <p>If the program runs successfully and prompts you to enter a <code class="code">desired</code>
                                    value, you should be able to observe the Device Shadow interactions by using the Shadow
                                    document and the MQTT test client as described previously. However, if you're unable
                                    to
                                    see the interactions, here are some things you can check:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                           
                                          
                                          <p class="title"><b>Check the thing name and its shadow in the AWS IoT console</b></p>
                                          
                                          <p>If you don't see the messages in the Shadow document, review the command and
                                             make sure it matches the thing name in the <b>AWS IoT console</b>. You
                                             can also check whether you have a classic shadow by choosing your thing resource and
                                             then choosing <b>Shadows</b>. This tutorial focuses primarily on
                                             interactions with the classic shadow.
                                          </p>
                                           
                                          
                                          <p> You can also confirm that the device you used is connected to the internet. In
                                             the <b>AWS IoT console</b>, choose the thing you created earlier, and then
                                             choose <b>Interact</b>. On the thing details page, you should see a
                                             message here that says: <code class="code">This thing already appears to be connected.</code>
                                             
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                           
                                          
                                          <p class="title"><b>Check the MQTT reserved topics you subscribed to</b></p>
                                          
                                          <p>If you don't see the messages appear in the MQTT test client, check whether the
                                             topics you subscribed to are formatted correctly. MQTT Device Shadow topics have a
                                             format <b>$aws/things/<code class="replaceable">thingname</code>/shadow/</b> and might
                                             have <code class="code">update</code>, <code class="code">get</code>, or <code class="code">delete</code> following it
                                             depending on actions you want to perform on the shadow. This tutorial uses the topic
                                             <b>$aws/things/<code class="replaceable">thingname</code>/shadow/#</b> so make sure
                                             you entered it correctly when subscribing to the topic in the <b>Topic
                                                filter</b> section of the test client.
                                          </p>
                                           
                                          
                                          <p>As you enter the topic name, make sure that the
                                             <code class="replaceable">thingname</code> is the same as the name of the AWS IoT thing that
                                             you created earlier. You can also subscribe to additional MQTT topics to see if an
                                             update has been successfully performed. For example, you can subscribe to the topic
                                             <b>$aws/things/<code class="replaceable">thingname</code>/shadow/update/rejected</b>
                                             to receive a message whenever an update request failed so that you can debug
                                             connection issues. For more information about the reserved topics, see <a href="./reserved-topics.html#reserved-topics-shadow">Shadow topics</a> and <a href="./device-shadow-mqtt.html">Device Shadow MQTT topics</a>.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                  
                                 
                                 <h2 id="sample-shadow-review">Review the results and next steps</h2>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>In this tutorial, you learned how to:</b></p>
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>Use the <code class="code">shadow.py</code> sample app to specify desired states and update the shadow's current
                                             state.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Edit the Shadow document to observe delta events and how the <code class="code">shadow.py</code> sample app responds
                                             to it.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Use the MQTT test client to subscribe to shadow topics and observe updates when
                                             you run the sample program.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                  
                                 
                                 <p class="title"><b>Next steps</b></p>
                                 
                                 <p>You can subscribe to additional MQTT reserved topics to observe updates to the
                                    shadow application. For example, if you only subscribe to the topic <b>$aws/things/<code class="replaceable">thingname</code>/shadow/update/accepted</b>,
                                    you'll see only the current state information
                                    when
                                    an update is successfully
                                    performed.
                                 </p>
                                  
                                 
                                 <p>You can also subscribe to additional shadow topics to debug issues or learn more about
                                    the Device Shadow interactions and also debug any issues with the Device Shadow
                                    interactions. For more information, see <a href="./reserved-topics.html#reserved-topics-shadow">Shadow topics</a> and <a href="./device-shadow-mqtt.html">Device Shadow MQTT topics</a>.
                                 </p>
                                 
                                 <p>You can also choose to extend your application by using named shadows or by using
                                    additional hardware connected with the Raspberry Pi for the LEDs and observe changes
                                    to
                                    their state using messages sent from the terminal.
                                 </p>
                                 
                                 <p>For more information about the Device Shadow service and using the service in devices,
                                    apps, and services, see <a href="./iot-device-shadows.html">AWS IoT Device Shadow service</a>, <a href="./device-shadow-comms-device.html">Using shadows in devices</a>, and <a href="./device-shadow-comms-app.html">Using shadows in apps and services</a>.
                                 </p>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./lightbulb-shadow-application.html">Install the Device SDK and run the
                                       shadow.py sample application for Device Shadows
                                    </div>
                                    <div id="next" class="next-link" accesskey="n" href="./iot-additional-tutorial.html">Other AWS IoT tutorials</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/interact-lights-device-shadows.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/interact-lights-device-shadows.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>