<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Interacting with shadows - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="device-shadow-data-flow" />
      <meta name="default_state" content="device-shadow-data-flow" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/device-shadow-data-flow.html" />
      <meta name="description" content="This topic describes the messages associated with each of the three methods that AWS IoT provides for working with shadows. These methods include the following:" />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Interacting with shadows - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#device-shadow-data-flow" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/device-shadow-data-flow.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/device-shadow-data-flow.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/device-shadow-data-flow.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/device-shadow-data-flow.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#device-shadow-data-flow" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/device-shadow-data-flow.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#protocol-support">Protocol support</a><a href="#shadow-reporting-state">Requesting and reporting state</a><a href="#update-device-shadow">Updating a shadow</a><a href="#retrieving-device-shadow">Retrieving a shadow document</a><a href="#deleting-thing-data">Deleting shadow data</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="device-shadow-data-flow">Interacting with shadows</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>This topic describes the messages associated with each of the three methods that AWS
                                    IoT
                                    provides for working with shadows. These methods include the following:
                                 </p>
                                 <div class="variablelist">
                                     
                                     
                                     
                                    
                                    <dl>
                                       
                                       <dt><a id="update"></a><span class="term"><code class="code">UPDATE</code></span></dt>
                                       
                                       <dd>
                                          
                                          <p>Creates a shadow if it doesn't exist, or updates the contents of an
                                             existing shadow with the state information provided in the message body. AWS IoT
                                             records a timestamp with each update to indicate when the state was last
                                             updated. When the shadow's state changes, AWS IoT sends <code class="code">/delta</code>
                                             messages to all MQTT subscribers with the difference between the
                                             <code class="code">desired</code> and the <code class="code">reported</code> states. Devices or
                                             apps that receive a <code class="code">/delta</code> message can perform actions based on
                                             the difference. For example, a device can update its state to the desired
                                             state, or an app can update its UI to reflect the device's state
                                             change.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><a id="get"></a><span class="term"><code class="code">GET</code></span></dt>
                                       
                                       <dd>
                                          
                                          <p>Retrieves a current shadow document that contains the complete state of
                                             the shadow, including metadata.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><a id="delete"></a><span class="term"><code class="code">DELETE</code></span></dt>
                                       
                                       <dd>
                                          
                                          <p>Deletes the shadow and all of its content. You can't restore a deleted
                                             shadow, but you can create a new shadow with the same name. Note that
                                             deleting a shadow does not reset its version number to 0.
                                          </p>
                                          
                                       </dd>
                                       
                                    </dl>
                                 </div>
                                 
                                 <h2 id="protocol-support">Protocol support</h2>
                                 
                                 <p>AWS IoT supports <a href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.html" rel="noopener noreferrer" target="_blank"><span>MQTT</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>
                                    and a REST API over HTTPS protocols to interact with shadows. AWS IoT provides a set
                                    of reserved request and response topics for MQTT publish and subscribe actions.
                                    Devices and apps should subscribe to the response topics before publishing a
                                    request topic for information about how AWS IoT handled the request. For more
                                    information, see <a href="./device-shadow-mqtt.html">Device Shadow MQTT topics</a> and <a href="./device-shadow-rest-api.html">Device Shadow REST API</a>.
                                 </p>
                                  
                                 
                                 <h2 id="shadow-reporting-state">Requesting and reporting state</h2>
                                 
                                 <p>When designing your IoT solution using AWS IoT and shadows, you should determine the
                                    apps or devices that will request changes and those that will implement them.
                                    Typically, a device implements and reports changes back to the shadow and apps and
                                    services respond to and request changes in the shadow. Your solution could be
                                    different, but the examples in this topic assume that the client app or service requests
                                    changes in the shadow and the device performs the changes and reports them back to
                                    the shadow.
                                 </p>
                                  
                                 
                                 <h2 id="update-device-shadow">Updating a shadow</h2>
                                 
                                 <p>Your app or service can update a shadow's state by using the <a href="./device-shadow-rest-api.html#API_UpdateThingShadow">UpdateThingShadow</a> API or
                                    by publishing to the <a href="./device-shadow-mqtt.html#update-pub-sub-topic">/update</a> topic. Updates affect only the fields
                                    specified in the request.
                                 </p>
                                  
                                 
                                 <h3 id="update-pub-sub-topic-client">Updating a shadow when a client
                                    requests a state change
                                 </h3>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>When a client requests a state change in a shadow by using the MQTT
                                          protocol</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p>The client should have a current shadow document so that it can 
                                             identify the properties to change. See the /get action for how to 
                                             obtain the current shadow document.
                                          </p>
                                       </li>
                                       <li>
                                          
                                          <p>The client subscribes to these MQTT topics:</p>
                                          
                                          <div class="itemizedlist">
                                              
                                              
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/accepted</code></p>
                                                </li>
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/rejected</code></p>
                                                </li>
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/delta</code></p>
                                                </li>
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/documents</code></p>
                                                </li>
                                             </ul>
                                          </div>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>The client publishes a <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update</code>
                                             request topic with a state document that contains the desired state of the shadow.
                                             Only the 
                                             properties to change need to be included in the document. This is an example
                                             of a document with the desired state.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "state": <span>{</span>
    "desired": <span>{</span>
      "color": <span>{</span>
        "r": 10
      },
      "engine": "ON"
    }
  }
}</code></pre>
                                          </li>
                                       <li>
                                          
                                          <p>If the update request is valid, AWS IoT updates the desired state
                                             in the shadow and publishes messages on these topics:
                                          </p>
                                          
                                          <div class="itemizedlist">
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/accepted</code></p>
                                                </li>
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/delta</code></p>
                                                </li>
                                             </ul>
                                          </div>
                                          
                                          <p>The <code class="code">/update/accepted</code> message contains an <a href="./device-shadow-document.html#device-shadow-example-response-json-accepted">/accepted response state
                                                document</a>
                                             shadow document, and the <code class="code">/update/delta</code> message contains a
                                             <a href="./device-shadow-document.html#device-shadow-example-response-json-delta">/delta response state
                                                document</a> shadow
                                             document. 
                                          </p>
                                          
                                       </li>
                                       <li>
                                          <p>If the update request is not valid, AWS IoT publishes a message with the 
                                             <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/rejected</code> topic
                                             with an <a href="./device-shadow-document.html#device-shadow-example-error-json">Error response
                                                document</a> shadow document
                                             that describes the error.
                                          </p>
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>When a client requests a state change in a shadow by using the
                                          API</b></p>
                                    <ol>
                                       <li>
                                          <p>The client calls the <code class="code"><a href="./device-shadow-rest-api.html#API_UpdateThingShadow">UpdateThingShadow</a></code> API
                                             with a <a href="./device-shadow-document.html#device-shadow-example-request-json">Request state
                                                document</a> state document as
                                             its message body.
                                          </p>
                                       </li>
                                       <li>
                                          <p>If the request was valid, AWS IoT returns an HTTP success response code and an
                                             <a href="./device-shadow-document.html#device-shadow-example-response-json-accepted">/accepted response state
                                                document</a>
                                             shadow document as its response message body.
                                          </p>
                                          
                                          <p>AWS IoT will also publish an MQTT message to the <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/delta</code>
                                             topic with a <a href="./device-shadow-document.html#device-shadow-example-response-json-delta">/delta response state
                                                document</a> shadow document
                                             for any devices or clients that subscribe to it.
                                          </p>
                                       </li>
                                       <li>
                                          <p>If the request was not valid, AWS IoT returns an HTTP error response code an
                                             <a href="./device-shadow-document.html#device-shadow-example-error-json">Error response
                                                document</a>
                                             as its response message body.
                                          </p>
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <p>When the device receives the <code class="code">/desired</code> state on the
                                    <code class="code">/update/delta</code> topic, it makes the desired changes in the
                                    device. It then sends a message to the <code class="code">/update</code> topic to report its
                                    current state to the shadow. 
                                 </p>
                                  
                                  
                                 
                                 <h3 id="update-pub-sub-topic-device">Updating a shadow when a device
                                    reports its current state
                                 </h3>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>When a device reports its current state to the shadow by using the MQTT
                                          protocol</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p>The device should subscribe to these MQTT topics before updating the shadow:</p>
                                          
                                          <div class="itemizedlist">
                                              
                                              
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/accepted</code></p>
                                                </li>
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/rejected</code></p>
                                                </li>
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/delta</code></p>
                                                </li>
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/documents</code></p>
                                                </li>
                                             </ul>
                                          </div>                    
                                          
                                       </li>
                                       <li>
                                          <p>The device reports its current state by publishing a message to the 
                                             <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update</code>
                                             topic that reports the current state, such as in this example.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
    "state": <span>{</span>
        "reported" : <span>{</span>
            "color" : <span>{</span> "r" : 10 },
            "engine" : "ON"
        }
    }
}</code></pre>
                                          </li>
                                       <li>
                                          <p>If AWS IoT accepts the update, it publishes a message to the
                                             <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/accepted</code>
                                             topics with an <a href="./device-shadow-document.html#device-shadow-example-response-json-accepted">/accepted response state
                                                document</a> shadow
                                             document.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          <p>If the update request is not valid, AWS IoT publishes a message with the 
                                             <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/rejected</code> topic
                                             with an <a href="./device-shadow-document.html#device-shadow-example-error-json">Error response
                                                document</a> shadow document
                                             that describes the error.
                                          </p>
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>When a device reports its current state to the shadow by using the
                                          API</b></p>
                                    <ol>
                                       <li>
                                          <p>The device calls the <code class="code"><a href="./device-shadow-rest-api.html#API_UpdateThingShadow">UpdateThingShadow</a></code> API
                                             with a <a href="./device-shadow-document.html#device-shadow-example-request-json">Request state
                                                document</a> state document as
                                             its message body.
                                          </p>
                                       </li>
                                       <li>
                                          <p>If the request was valid, AWS IoT updates the shadow and returns an HTTP success response
                                             code
                                             with an <a href="./device-shadow-document.html#device-shadow-example-response-json-accepted">/accepted response state
                                                document</a>
                                             shadow document as its response message body.
                                          </p>
                                          
                                          <p>AWS IoT will also publish an MQTT message to the <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/delta</code>
                                             topic with a <a href="./device-shadow-document.html#device-shadow-example-response-json-delta">/delta response state
                                                document</a> shadow document
                                             for any devices or clients that subscribe to it.
                                          </p>
                                       </li>
                                       <li>
                                          <p>If the request was not valid, AWS IoT returns an HTTP error response code an
                                             <a href="./device-shadow-document.html#device-shadow-example-error-json">Error response
                                                document</a>
                                             as its response message body.
                                          </p>
                                       </li>
                                    </ol>
                                 </div>
                                  
                                  
                                 
                                 <h3 id="optimistic-locking">Optimistic locking</h3>
                                 
                                 <p>You can use the state document version to ensure you are updating the most
                                    recent version of a device's shadow document. When you supply a version with an
                                    update request, the service rejects the request with an HTTP 409 conflict
                                    response code if the current version of the state document does not match the
                                    version supplied.
                                 </p>
                                 
                                 <p>For example:</p>
                                 
                                 <p>Initial document:</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "state": <span>{</span>
    "desired": <span>{</span>
      "colors": [
        "RED",
        "GREEN",
        "BLUE"
      ]
    }
  },
  "version": 10
}</code></pre>
                                 <p>Update: (version doesn't match; this request will be rejected)</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "state": <span>{</span>
    "desired": <span>{</span>
      "colors": [
        "BLUE"
      ]
    }
  },
  "version": 9
}</code></pre>
                                 <p>Result:</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "code": 409,
  "message": "Version conflict",
  "clientToken": "426bfd96-e720-46d3-95cd-014e3ef12bb6"
}</code></pre>
                                 <p>Update: (version matches; this request will be accepted)</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "state": <span>{</span>
    "desired": <span>{</span>
      "colors": [
        "BLUE"
      ]
    }
  },
  "version": 10
}</code></pre>
                                 <p>Final state:</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "state": <span>{</span>
    "desired": <span>{</span>
      "colors": [
        "BLUE"
      ]
    }
  },
  "version": 11
}</code></pre>
                                  
                                  
                                 <h2 id="retrieving-device-shadow">Retrieving a shadow document</h2>
                                 
                                 <p>You can retrieve a shadow document by using the <a href="./device-shadow-rest-api.html#API_GetThingShadow">GetThingShadow</a> API or by subscribing and publishing to the
                                    <a href="./device-shadow-mqtt.html#get-pub-sub-topic">/get</a> topic.
                                    This retrieves a complete shadow document, including any delta between the
                                    <code class="code">desired</code> and <code class="code">reported</code> states. The procedure for this
                                    task is the same whether the device or a client is making the request.
                                 </p>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To retrieve a shadow document by using the MQTT protocol</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p>The device or client should subscribe to these MQTT topics before updating the shadow:</p>
                                          
                                          <div class="itemizedlist">
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/get/accepted</code></p>
                                                </li>
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/get/rejected</code></p>
                                                </li>
                                             </ul>
                                          </div>                    
                                          
                                       </li>
                                       <li>
                                          <p>The device or client publishes a message to the
                                             <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/get</code>
                                             topic with an empty message body.
                                          </p>
                                       </li>
                                       <li>
                                          <p>If the request is successful, AWS IoT publishes a message to the
                                             <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/get/accepted</code>
                                             topic with a <a href="./device-shadow-document.html#device-shadow-example-response-json-accepted">/accepted response state
                                                document</a> in the
                                             message body.
                                          </p>
                                       </li>
                                       <li>
                                          
                                          <p>If the request was not valid, AWS IoT publishes a message to the
                                             <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/get/rejected</code>
                                             topic with an <a href="./device-shadow-document.html#device-shadow-example-error-json">Error response
                                                document</a> in the message
                                             body.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To retrieve a shadow document by using a REST API</b></p>
                                    <ol>
                                       <li>
                                          <p>The device or client call the <code class="code"><a href="./device-shadow-rest-api.html#API_GetThingShadow">GetThingShadow</a></code> API
                                             with an empty message body.
                                          </p>
                                       </li>
                                       <li>
                                          <p>If the request is valid, AWS IoT returns an HTTP success response code
                                             with an <a href="./device-shadow-document.html#device-shadow-example-response-json-accepted">/accepted response state
                                                document</a>
                                             shadow document as its response message body.
                                          </p>
                                       </li>
                                       <li>
                                          <p>If the request is not valid, AWS IoT returns an HTTP error response code an
                                             <a href="./device-shadow-document.html#device-shadow-example-error-json">Error response
                                                document</a>
                                             as its response message body.
                                          </p>
                                       </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <h2 id="deleting-thing-data">Deleting shadow data</h2>
                                 
                                 
                                 <p>There are two ways to delete shadow data: you can delete specific properties in the
                                    shadow document
                                    and you can delete the shadow completely.
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          <p>To delete specific properties from a shadow,
                                             update the shadow; however set the value of the properties that you want to delete
                                             to <code class="code">null</code>.
                                             Fields with a value of <code class="code">null</code> are removed from the shadow document.
                                          </p>
                                       </li>
                                       <li class="listitem">
                                          <p>To delete the entire shadow, use the <a href="./device-shadow-rest-api.html#API_DeleteThingShadow">DeleteThingShadow</a> API or publish to the <a href="./device-shadow-mqtt.html#delete-pub-sub-topic">/delete</a>
                                             topic.
                                          </p>
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>Note that deleting a shadow does not reset its version number to 0.</p>
                                  
                                 
                                 <h3 id="deleting-shadow-property">Deleting a property from a shadow document</h3>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To delete a property from a shadow by using the MQTT protocol</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p>The device or client should have a current shadow document so that it can 
                                             identify the properties to change. See <a href="#retrieving-device-shadow">Retrieving a shadow document</a> 
                                             for information on how to obtain the current shadow document.
                                          </p>
                                       </li>
                                       <li>
                                          
                                          <p>The device or client subscribes to these MQTT topics:</p>
                                          
                                          <div class="itemizedlist">
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/accepted</code></p>
                                                </li>
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/rejected</code></p>
                                                </li>
                                             </ul>
                                          </div>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>The device or client publishes a <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update</code>
                                             request topic with a state document that assigns <code class="code">null</code> values to the properties
                                             of the shadow to delete. Only the properties to change need to be included in the
                                             document. This is an example
                                             of a document that deletes the <code class="code">engine</code> property.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "state": <span>{</span>
    "desired": <span>{</span>
      "engine": null
    }
  }
}</code></pre></li>
                                       <li>
                                          
                                          <p>If the update request is valid, AWS IoT deletes the specified properties 
                                             in the shadow and publishes a messages with the
                                             <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/accepted</code> topic with an
                                             <a href="./device-shadow-document.html#device-shadow-example-response-json-accepted">/accepted response state
                                                document</a> shadow document
                                             in the message body.
                                             
                                          </p>
                                          
                                       </li>
                                       <li>
                                          <p>If the update request is not valid, AWS IoT publishes a message with the 
                                             <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/update/rejected</code> topic
                                             with an <a href="./device-shadow-document.html#device-shadow-example-error-json">Error response
                                                document</a> shadow document
                                             that describes the error.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To delete a property from a shadow by using the REST API</b></p>
                                    <ol>
                                       <li>
                                          <p>The device or client calls the <code class="code"><a href="./device-shadow-rest-api.html#API_UpdateThingShadow">UpdateThingShadow</a></code> API with a <a href="./device-shadow-document.html#device-shadow-example-request-json">Request state
                                                document</a> that assigns
                                             <code class="code">null</code> values to the properties of the shadow to delete.
                                             Include only the properties that you want to delete in the document.
                                             This is an example of a document that deletes the <code class="code">engine</code>
                                             property.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "state": <span>{</span>
    "desired": <span>{</span>
      "engine": null
    }
  }
}</code></pre>
                                          </li>
                                       <li>
                                          <p>If the request was valid, AWS IoT returns an HTTP success response code and an
                                             <a href="./device-shadow-document.html#device-shadow-example-response-json-accepted">/accepted response state
                                                document</a>
                                             shadow document as its response message body.
                                          </p>
                                       </li>
                                       <li>
                                          <p>If the request was not valid, AWS IoT returns an HTTP error response code an
                                             <a href="./device-shadow-document.html#device-shadow-example-error-json">Error response
                                                document</a>
                                             as its response message body.
                                          </p>
                                       </li>
                                    </ol>
                                 </div>
                                  
                                  
                                 
                                 <h3 id="deleting-device-shadow">Deleting a shadow</h3>
                                 
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>Setting the device's shadow state to <code class="code">null</code> does not delete the shadow. The
                                          shadow version will be incremented on the next update.
                                       </p>
                                       <p>Deleting a device's shadow does not delete the thing object. Deleting a thing object
                                          does
                                          not delete the corresponding device's shadow.
                                       </p>
                                       <p>Deleting a shadow does not reset its version number to 0.</p>
                                    </div>
                                 </div>
                                 
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To delete a shadow by using the MQTT protocol</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p>The device or client subscribes to these MQTT topics:</p>
                                          
                                          <div class="itemizedlist">
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/delete/accepted</code></p>
                                                </li>
                                                <li class="listitem">
                                                   <p><code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/delete/rejected</code></p>
                                                </li>
                                             </ul>
                                          </div>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>The device or client publishes a <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/delete</code>
                                             with an empty message buffer.
                                          </p>
                                       </li>
                                       <li>
                                          <p>If the delete request is valid, AWS IoT deletes the shadow and publishes a messages
                                             with the
                                             <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/delete/accepted</code> topic and an
                                             abbreviated
                                             <a href="./device-shadow-document.html#device-shadow-example-response-json-accepted">/accepted response state
                                                document</a> shadow document
                                             in the message body. This is an example of the accepted delete message:
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "version": 4,
  "timestamp": 1591057529
}</code></pre>
                                          </li>
                                       <li>
                                          <p>If the update request is not valid, AWS IoT publishes a message with the 
                                             <code class="code">$aws/things/<code class="replaceable">thingName</code>/shadow/name/<code class="replaceable">shadowName</code>/delete/rejected</code> topic
                                             with an <a href="./device-shadow-document.html#device-shadow-example-error-json">Error response
                                                document</a> shadow document
                                             that describes the error.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To delete a shadow by using the REST API</b></p>
                                    <ol>
                                       <li>
                                          <p>The device or client calls the <code class="code"><a href="./device-shadow-rest-api.html#API_DeleteThingShadow">DeleteThingShadow</a></code> API
                                             with an empty message buffer.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          <p>If the request was valid, AWS IoT returns an HTTP success response code and an
                                             <a href="./device-shadow-document.html#device-shadow-example-response-json-accepted">/accepted response state
                                                document</a> and an
                                             abbreviated
                                             <a href="./device-shadow-document.html#device-shadow-example-response-json-accepted">/accepted response state
                                                document</a> shadow document
                                             in the message body. This is an example of the accepted delete message:
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "version": 4,
  "timestamp": 1591057529
}</code></pre></li>
                                       <li>
                                          <p>If the request was not valid, AWS IoT returns an HTTP error response code an
                                             <a href="./device-shadow-document.html#device-shadow-example-error-json">Error response
                                                document</a>
                                             as its response message body.
                                          </p>
                                       </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./using-device-shadows.html">Simulating Device Shadow service
                                       communications
                                    </div>
                                    <div id="next" class="next-link" accesskey="n" href="./device-shadow-rest-api.html">Device Shadow REST API</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/device-shadow-data-flow.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/device-shadow-data-flow.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>