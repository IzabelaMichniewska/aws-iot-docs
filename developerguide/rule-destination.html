<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Working with topic rule destinations - AWS IoT Core</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="assets" />
      <meta name="target_state" content="rule-destination" />
      <meta name="default_state" content="rule-destination" />
      <link rel="icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/iot/latest/developerguide/rule-destination.html" />
      <meta name="description" content="Use destinations to specify where the AWS IoT rules engine can route data." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS IoT Core" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="AWS IoT provides secure, bi-directional communication between Internet-connected devices such as sensors, actuators, embedded micro-controllers, or smart appliances and the AWS Cloud. This enables you to collect telemetry data from multiple devices, and store and analyze the data. You can also create applications that enable your users to control these devices from their phones or tablets." />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="IoT Docs" />
      <meta name="this_doc_product" content="AWS IoT Core" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="assets/css/vendor4.css" rel="stylesheet" />
      <link href="assets/css/awsdocs-common.css" rel="stylesheet" /><script type="text/javascript" src="assets/js/vendor3.js" defer=""></script><script type="text/javascript" src="assets/js/vendor4.js" defer=""></script><script type="text/javascript" src="assets/js/vendor1.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-common.js" defer=""></script><script type="text/javascript" src="assets/js/awsdocs-doc-app.js" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Working with topic rule destinations - AWS IoT Core</title>
                        <meta name="pdf" content="iot-dg.pdf#rule-destination" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07JBRCWWZ" />
                        <meta name="github" content="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/rule-destination.md" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=210" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT%20Docs&amp;topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/rule-destination.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/rule-destination.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/iot/latest/developerguide/rule-destination.html" />
                        <meta name="keywords" content="AWS IoT,IoT,Internet of Things" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="iot-dg.pdf#rule-destination" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a target="_blank" rel="noopener noreferrer" href="https://www.amazon.com/dp/B07JBRCWWZ" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-iot-docs/tree/master/developerguide/rule-destination.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iot/index.html">AWS IoT Core</a><a href="what-is-aws-iot.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#create-destination-http">Creating an HTTP topic rule destination</a><a href="#create-destination-vpc">Creating a VPC topic rule destination</a><a href="#confirm-destination">Confirming an HTTP topic rule destination</a><a href="#disable-destination">Disabling a topic rule destination</a><a href="#enable-destination">Enabling a topic rule destination</a><a href="#trigger-confirm">Sending a new confirmation message</a><a href="#delete-destination">Deleting a topic rule destination</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="rule-destination"> Working with topic rule destinations</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>A destination is a resource that defines where rules engine can route data. The AWS
                                    IoT rules engine 
                                    supports two kinds of destinations: HTTP destinations and VPC destinations. Destinations
                                    make it possible for the rules engine to send data
                                    to other services that are not natively integrated with AWS IoT. A destination can
                                    be reused 
                                    across rules.
                                 </p>
                                 <p>HTTP destinations might require confirmation or configuration
                                    before they can be used. The following paragraphs describe how the confirmation flow
                                    for HTTP destinations works.
                                 </p>
                                 <p>Topic rule destinations are used to verify that you own or have access to the endpoint
                                    to which you want to route data. When you create a rule action with an HTTP endpoint
                                    (for
                                    example, an <code class="code">http</code> action) or update an existing rule action's endpoint,
                                    AWS IoT sends a confirmation message to the endpoint that contains a unique token.
                                    To
                                    verify your endpoint, you must call <code class="code">ConfirmTopicRuleDestination</code> with the
                                    token to verify you own or have access to the endpoint. The token is valid for three
                                    days, after which you need to create a new <code class="code">http</code> action or call the
                                    <code class="code">UpdateTopicRuleDestination</code> API to restart the confirmation process. You
                                    can also confirm your topic rule destination by browsing to <code class="code">enableUrl</code> or
                                    provide the token from the <b>Destination</b> page in the AWS IoT
                                    console.
                                 </p>
                                 <p>When AWS IoT receives the token sent to your endpoint, the HTTP destination is confirmed.
                                    You
                                    must enable the destination before it can be used by rules engine. A destination can
                                    be
                                    in one of the following states:
                                 </p>
                                 <div class="variablelist">
                                     
                                     
                                     
                                     
                                    
                                    <dl>
                                       
                                       <dt><span class="term">ENABLED</span></dt>
                                       
                                       <dd>
                                          
                                          <p>The destination is enabled. A destination must be in the
                                             <code class="code">ENABLED</code> state for it to be used in a rule. You can only
                                             enable a destinations in DISABLED status.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">DISABLED</span></dt>
                                       
                                       <dd>
                                          
                                          <p>The destination has been confirmed but disabled. This is useful if you
                                             want to temporarily prevent traffic to your endpoint without having to go
                                             through the confirmation process again. You can only disable a destinations
                                             in ENABLED status.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">IN_PROGRESS</span></dt>
                                       
                                       <dd>
                                          
                                          <p>Confirmation of the destination is in progress.</p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">ERROR</span></dt>
                                       
                                       <dd>
                                          
                                          <p>Destination confirmation timed out.</p>
                                          
                                       </dd>
                                       
                                    </dl>
                                 </div>
                                 <p>After they are confirmed and enabled, destinations can be used with any rule in your
                                    account.
                                 </p>
                                 
                                 <h2 id="create-destination-http">Creating an HTTP topic rule destination</h2>
                                 
                                 <p>A destination is created when you use AWS IoT to create a rule with an
                                    <code class="code">http</code> action. You can also create a destination using the
                                    <code class="code">CreateTopicRuleDestination</code> API or the AWS IoT console.
                                 </p>
                                 
                                 <p>When you create a destination, AWS IoT verifies the endpoint URL is valid. If the
                                    URL is valid, a confirmation message is sent to that URL. The confirmation request
                                    has the following format:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">HTTP POST <span>{</span>confirmationUrl}/?confirmationToken=<span>{</span>confirmationToken}
Headers:
x-amz-rules-engine-message-type: DestinationConfirmation
x-amz-rules-engine-destination-arn:"arn:aws:iot:us-east-1:123456789012:ruledestination/http/7a280e37-b9c6-47a2-a751-0703693f46e4"
Content-Type: application/json
Body:
<span>{</span>
    "arn":"arn:aws:iot:us-east-1:123456789012:ruledestination/http/7a280e37-b9c6-47a2-a751-0703693f46e4",  
    "confirmationToken": "AYADeMXLrPrNY2wqJAKsFNn-…NBJndA",
    "enableUrl": "https://iot.us-east-1.amazonaws.com/confirmdestination/AYADeMXLrPrNY2wqJAKsFNn-…NBJndA",
    "messageType": "DestinationConfirmation"
}</code></pre>
                                 <p>The fields of this message are defined as follows:</p>
                                 
                                 <div class="variablelist">
                                     
                                     
                                     
                                     
                                    
                                    <dl>
                                       
                                       <dt><span class="term">arn</span></dt>
                                       
                                       <dd>
                                          
                                          <p>The Amazon Resource Name (ARN) for the topic rule destination to
                                             confirm.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">confirmationToken</span></dt>
                                       
                                       <dd>
                                          
                                          <p>The confirmation token. The token in the example is truncated. Your
                                             token will be longer.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">enableUrl</span></dt>
                                       
                                       <dd>
                                          
                                          <p>The URL to which you browse to confirm a topic rule
                                             destination.
                                          </p>
                                          
                                       </dd>
                                        
                                       
                                       <dt><span class="term">messageType</span></dt>
                                       
                                       <dd>
                                          
                                          <p>The type of message.</p>
                                          
                                       </dd>
                                       
                                    </dl>
                                 </div>
                                  
                                 
                                 <h2 id="create-destination-vpc">Creating a VPC topic rule destination</h2>
                                 
                                 <p>You create a virtual private cloud (VPC) destination by using the <a href="https://docs.aws.amazon.com/iot/latest/apireference/API_CreateTopicRuleDestination.html">CreateTopicRuleDestination</a> API or the AWS IoT Core console. 
                                 </p>
                                 
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>VPC topic rule destinations that don't receive any traffic for 30 days in a
                                          row will be disabled.
                                       </p>
                                    </div>
                                 </div>
                                 
                                 <p>When you create a VPC destination, you must specify the following
                                    information.
                                 </p>
                                 
                                 <div class="variablelist">
                                     
                                     
                                     
                                     
                                    
                                    <dl>
                                       
                                       <dt><span class="term">vpcId</span></dt>
                                       
                                       <dd>
                                          <p>The unique ID of the VPC destination.</p>
                                       </dd>
                                        
                                       
                                       <dt><span class="term">subnetIds</span></dt>
                                       
                                       <dd>
                                          <p>A list of subnets in which the rules engine creates elastic network interfaces. The
                                             rules
                                             engine allocates a single network interface for each subnet in the
                                             list.
                                          </p>
                                       </dd>
                                        
                                       
                                       <dt><span class="term">securityGroups (optional)</span></dt>
                                       
                                       <dd>
                                          <p>A list of security groups to apply to the network interfaces.</p>
                                       </dd>
                                        
                                       
                                       <dt><span class="term">roleArn</span></dt>
                                       
                                       <dd>
                                          <p>The ARN of a role that has permission to create network interfaces on your behalf.</p>
                                          
                                          <p>This ARN should have a policy attached to it that looks like the following example.</p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">
<span>{</span>
    "Version": "2012-10-17",
    "Statement": [
    <span>{</span>
        "Effect": "Allow",
        "Action": [
            "ec2:CreateNetworkInterface",
            "ec2:DescribeNetworkInterfaces",
            "ec2:CreateNetworkInterfacePermission",
            "ec2:DeleteNetworkInterface",
            "ec2:DescribeSubnets",
            "ec2:DescribeVpcs",
            "ec2:DescribeVpcAttribute"
            ],
            "Resource": "*"
        }
    ]
}
                        </code></pre>
                                          </dd>
                                       
                                    </dl>
                                 </div>
                                  
                                 
                                 <h3 id="create-destination-vpc-cli">Creating a VPC destination by using the AWS CLI</h3>
                                 
                                 <p>The following example shows how to create a VPC destination by using the AWS CLI.</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">
aws --region <code class="replaceable">regions</code> iot create-topic-rule-destination --destination-configuration 'vpcConfiguration=<span>{</span>subnetIds=["subnet-<code class="replaceable">123456789101230456</code>"],securityGroups=[],vpcId="vpc-<code class="replaceable">123456789101230456</code>",roleArn="arn:aws:iam::<code class="replaceable">123456789012</code>:role/<code class="replaceable">role-name</code>"}'
                    </code></pre>
                                 <p>After you run this command, the VPC destination status will be <code class="code">IN PROGRESS</code>. After a few 
                                    minutes, its status will change to either <code class="code">ERROR</code> (if the command isn't successful) or <code class="code">ENABLED</code>. 
                                    When the destination status is <code class="code">ENABLED</code>, it is ready to use.
                                 </p>
                                 
                                 <p>You can use the following command to get the status of your VPC destination.</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">
aws --region <code class="replaceable">region</code> iot get-topic-rule-destination --arn "<code class="replaceable">VPCDestinationARN</code>"
                    </code></pre>
                                  
                                  
                                 <h3 id="create-destination-vpc-console">Creating a VPC destination by using the AWS IoT Core console</h3>
                                 
                                 <p>The following steps describe how to create a VPC destination by using the AWS IoT
                                    Core console.
                                 </p>
                                 
                                 <div class="procedure">
                                    <ol>
                                       <li>
                                          <p>Navigate to the AWS IoT Core console. Choose <b>Destinations</b> under the 
                                             <b>Act</b> tab in the left pane.
                                          </p>
                                       </li>
                                       <li>
                                          <p>Enter values for the following fields.</p>
                                          
                                          <div class="itemizedlist">
                                              
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   <p><b>VPC ID</b></p>
                                                </li>
                                                <li class="listitem">
                                                   <p><b>Subnet IDs</b></p>
                                                </li>
                                                <li class="listitem">
                                                   <p><b>Security Group</b></p>
                                                </li>
                                             </ul>
                                          </div>
                                          
                                       </li>
                                       <li>
                                          <p>Select a role that has the permissions required to create ENIs. The preceding example
                                             role contains 
                                             these permissions.
                                          </p>
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <p>When the VPC destination status is <b>ENABLED</b>, it is ready to use.
                                 </p>
                                  
                                  
                                 
                                 <h2 id="confirm-destination">Confirming an HTTP topic rule destination</h2>
                                 
                                 <p>You can confirm a destination by making an HTTP GET request to the
                                    <code class="code">enableUrl</code> that is included in the confirmation message. You can
                                    call <code class="code">ConfirmTopicRuleDestination</code> with the token from the confirmation
                                    message or you can use the AWS IoT console.
                                 </p>
                                 
                                 <p>The token must be valid for the destination to be put in the <code class="code">ENABLED</code>
                                    state. If the token has expired, you must call
                                    <code class="code">UpdateTopicRuleDestination</code> to restart the confirmation
                                    process.
                                 </p>
                                 
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p> If you confirm the topic rule destination by calling
                                          <code class="code">ConfirmTopicRuleDestination</code>, the destination status will be
                                          <code class="code">DISABLED</code> and you need to explicitly enable your destination by
                                          calling <code class="code">UpdateTopicRuleDestination</code> before using it.
                                       </p>
                                    </div>
                                 </div>
                                  
                                 
                                 <h2 id="disable-destination">Disabling a topic rule destination</h2>
                                 
                                 <p>To disable a destination, call <code class="code">UpdateTopicRuleDestination</code> and set the
                                    topic rule destination's status to <code class="code">DISABLED</code>.
                                 </p>
                                  
                                 
                                 <h2 id="enable-destination">Enabling a topic rule destination</h2>
                                 
                                 <p>To enable a destination, call <code class="code">UpdateTopicRuleDestination</code> and set the
                                    topic rule's status to <code class="code">ENABLED</code>. You do not need to re-validate the
                                    URL.
                                 </p>
                                  
                                 
                                 <h2 id="trigger-confirm">Sending a new confirmation message</h2>
                                 
                                 <p>To trigger a new confirmation message for a destination, call
                                    <code class="code">UpdateTopicRuleDestination</code> and set the topic rule destination's
                                    status to <code class="code">IN_PROGRESS</code>. 
                                 </p>
                                  
                                 
                                 <h2 id="delete-destination">Deleting a topic rule destination</h2>
                                 
                                 <p>To delete a topic rule destination, call
                                    <code class="code">DeleteTopicRuleDestination</code>.
                                 </p>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="./rule-error-handling.html">Error handling (error action)</div>
                                    <div id="next" class="next-link" accesskey="n" href="./topic-rule-destination-ca-list.html">Certificate authorities supported
                                       by HTTPS endpoints in topic rule destinations
                                    </div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/rule-destination.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IoT Docs&amp;topic_url=https://docs.aws.amazon.com/en_us/iot/latest/developerguide/rule-destination.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS IoT Core';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>
</html>